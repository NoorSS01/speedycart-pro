import{u as Z,a as $,r as n,s as u,j as e,S as A,B as d,A as G,Z as v,O as H,C as F,c as T,y as J,h as m,i as K,J as y,_ as Q,$ as W,a0 as Y,a1 as ee,a2 as se,G as c,I as l,a4 as te,a5 as ae,a6 as re,a7 as ce,a8 as L,a9 as le,X as ie,P as ne,a3 as oe,m as o}from"./index-CWmUW0Oc.js";import{A as de}from"./AdminBottomNav-BKUm4YDC.js";import{P as me}from"./pencil-KNg7RG67.js";import"./boxes-b2j2-WXi.js";function ge(){const{user:b,userRole:N,loading:w}=Z(),g=$(),[p,E]=n.useState([]),[P,I]=n.useState(!0),[B,x]=n.useState(!1),[h,C]=n.useState(null),[a,r]=n.useState({name:"",title:"FLASH DEALS",badge_text:"Up To 80% Off",badge_color:"#ec4899",start_time:"",end_time:"",background_color:"#fef3c7",text_color:"#000000",timer_bg_color:"#1e293b",timer_text_color:"#ffffff",filter_type:"manual",min_discount:30,product_ids:[],max_products:8,show_see_all:!0,is_active:!0,display_order:0}),[D,O]=n.useState([]),[S,j]=n.useState(""),k=N==="admin"||N==="super_admin";n.useEffect(()=>{if(!w){if(!b||!k){g("/");return}_(),q()}},[b,w,k,g]);const q=async()=>{const{data:s}=await u.from("products").select("id, name, image_url").eq("is_active",!0).order("name");s&&O(s)},_=async()=>{try{const{data:s}=await u.from("flash_deals").select("*").order("display_order",{ascending:!0});s&&E(s)}catch(s){console.error("Error:",s)}I(!1)},M=()=>{const s=new Date,t=new Date(s.getTime()+24*60*60*1e3);C(null),r({name:"",title:"FLASH DEALS",badge_text:"Up To 80% Off",badge_color:"#ec4899",start_time:m(s,"yyyy-MM-dd'T'HH:mm"),end_time:m(t,"yyyy-MM-dd'T'HH:mm"),background_color:"#fef3c7",text_color:"#000000",timer_bg_color:"#1e293b",timer_text_color:"#ffffff",filter_type:"manual",min_discount:30,product_ids:[],max_products:8,show_see_all:!0,is_active:!0,display_order:p.length}),j(""),x(!0)},z=s=>{C(s);const t=s.filter_config||{};r({name:s.name,title:s.title,badge_text:s.badge_text||"",badge_color:s.badge_color,start_time:m(new Date(s.start_time),"yyyy-MM-dd'T'HH:mm"),end_time:m(new Date(s.end_time),"yyyy-MM-dd'T'HH:mm"),background_color:s.background_color,text_color:s.text_color,timer_bg_color:s.timer_bg_color,timer_text_color:s.timer_text_color,filter_type:s.filter_type,min_discount:t.min_discount||30,product_ids:t.product_ids||[],max_products:s.max_products,show_see_all:s.show_see_all,is_active:s.is_active,display_order:s.display_order}),j(""),x(!0)},U=async()=>{if(!a.name.trim()||!a.title.trim()){o.error("Name and title required");return}if(!a.start_time||!a.end_time){o.error("Start and end times required");return}try{const s={name:a.name,title:a.title,badge_text:a.badge_text||null,badge_color:a.badge_color,start_time:new Date(a.start_time).toISOString(),end_time:new Date(a.end_time).toISOString(),background_color:a.background_color,text_color:a.text_color,timer_bg_color:a.timer_bg_color,timer_text_color:a.timer_text_color,filter_type:a.filter_type,filter_config:a.filter_type==="manual"?{product_ids:a.product_ids}:{min_discount:a.min_discount},max_products:a.max_products,show_see_all:a.show_see_all,is_active:a.is_active,display_order:a.display_order,updated_at:new Date().toISOString()};h?(await u.from("flash_deals").update(s).eq("id",h.id),o.success("Flash deal updated")):(await u.from("flash_deals").insert(s),o.success("Flash deal created")),x(!1),_()}catch{o.error("Failed to save")}},R=async s=>{if(confirm("Delete this flash deal?"))try{await u.from("flash_deals").delete().eq("id",s),o.success("Deleted"),_()}catch{o.error("Failed")}},V=async s=>{try{await u.from("flash_deals").update({is_active:!s.is_active}).eq("id",s.id),_()}catch{o.error("Failed")}},X=s=>{const t=new Date,i=new Date(s.start_time),f=new Date(s.end_time);return s.is_active?t<i?{label:"Scheduled",color:"outline"}:t>f?{label:"Expired",color:"destructive"}:{label:"Live",color:"default"}:{label:"Inactive",color:"secondary"}};return P?e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(A,{className:"h-6 w-40"})})}),e.jsx("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2].map(s=>e.jsx(A,{className:"h-24 rounded-xl"},s))})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>g("/admin"),children:e.jsx(G,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5 text-yellow-500"})," Flash Deals"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Time-limited offers"})]})]}),e.jsxs(d,{onClick:M,size:"sm",children:[e.jsx(H,{className:"h-4 w-4 mr-1"})," Add Deal"]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 space-y-4",children:p.length===0?e.jsx(F,{children:e.jsxs(T,{className:"py-12 text-center",children:[e.jsx(v,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No flash deals yet"}),e.jsxs(d,{onClick:M,className:"mt-4",children:[e.jsx(H,{className:"h-4 w-4 mr-2"})," Create First Deal"]})]})}):p.map(s=>{const t=X(s);return e.jsxs(F,{className:s.is_active?"":"opacity-60",children:[e.jsxs("div",{className:"p-4 rounded-t-lg flex items-center justify-between",style:{backgroundColor:s.background_color,color:s.text_color},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),e.jsx("span",{className:"font-bold",children:s.title}),s.badge_text&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full text-white",style:{backgroundColor:s.badge_color},children:s.badge_text})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:m(new Date(s.end_time),"MMM d, HH:mm")})]})]}),e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{variant:t.color,children:t.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.name})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m(new Date(s.start_time),"MMM d HH:mm")," - ",m(new Date(s.end_time),"MMM d HH:mm")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{checked:s.is_active,onCheckedChange:()=>V(s)}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>z(s),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>R(s.id),children:e.jsx(Q,{className:"h-4 w-4 text-destructive"})})]})]})})]},s.id)})}),e.jsx(W,{open:B,onOpenChange:x,children:e.jsxs(Y,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(ee,{children:e.jsx(se,{children:h?"Edit Flash Deal":"Create Flash Deal"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Internal Name *"}),e.jsx(l,{value:a.name,onChange:s=>r(t=>({...t,name:s.target.value})),placeholder:"new-year-flash"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Display Title *"}),e.jsx(l,{value:a.title,onChange:s=>r(t=>({...t,title:s.target.value})),placeholder:"FLASH DEALS"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Badge Text"}),e.jsx(l,{value:a.badge_text,onChange:s=>r(t=>({...t,badge_text:s.target.value})),placeholder:"Up To 80% Off"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Badge Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:a.badge_color,onChange:s=>r(t=>({...t,badge_color:s.target.value})),className:"h-10 w-14"}),e.jsx(l,{value:a.badge_color,onChange:s=>r(t=>({...t,badge_color:s.target.value}))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Start Time *"}),e.jsx(l,{type:"datetime-local",value:a.start_time,onChange:s=>r(t=>({...t,start_time:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"End Time *"}),e.jsx(l,{type:"datetime-local",value:a.end_time,onChange:s=>r(t=>({...t,end_time:s.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Background Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:a.background_color,onChange:s=>r(t=>({...t,background_color:s.target.value})),className:"h-10 w-14"}),e.jsx(l,{value:a.background_color,onChange:s=>r(t=>({...t,background_color:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Timer Background"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:a.timer_bg_color,onChange:s=>r(t=>({...t,timer_bg_color:s.target.value})),className:"h-10 w-14"}),e.jsx(l,{value:a.timer_bg_color,onChange:s=>r(t=>({...t,timer_bg_color:s.target.value}))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Product Selection"}),e.jsxs(te,{value:a.filter_type,onValueChange:s=>r(t=>({...t,filter_type:s})),children:[e.jsx(ae,{children:e.jsx(re,{})}),e.jsxs(ce,{children:[e.jsx(L,{value:"manual",children:"Select Products"}),e.jsx(L,{value:"discount",children:"By Discount %"})]})]})]}),a.filter_type==="discount"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Min Discount %"}),e.jsx(l,{type:"number",value:a.min_discount,onChange:s=>r(t=>({...t,min_discount:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Max Products"}),e.jsx(l,{type:"number",value:a.max_products,onChange:s=>r(t=>({...t,max_products:parseInt(s.target.value)||8}))})]})]}),a.filter_type==="manual"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Select Products (",a.product_ids.length," selected)"]}),a.product_ids.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 p-2 border rounded bg-muted/30",children:a.product_ids.map(s=>{const t=D.find(i=>i.id===s);return t?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-primary text-white rounded-full",children:[t.name.slice(0,20),t.name.length>20?"...":"",e.jsx("button",{type:"button",onClick:()=>r(i=>({...i,product_ids:i.product_ids.filter(f=>f!==s)})),className:"hover:bg-white/20 rounded-full p-0.5",children:e.jsx(le,{className:"h-3 w-3"})})]},s):null})}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(l,{placeholder:"Search products...",value:S,onChange:s=>j(s.target.value),className:"pl-8"})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded p-2 space-y-1",children:D.filter(s=>s.name.toLowerCase().includes(S.toLowerCase())).slice(0,20).map(s=>e.jsxs("button",{type:"button",className:`w-full flex items-center gap-2 p-2 rounded text-left text-sm hover:bg-muted ${a.product_ids.includes(s.id)?"bg-primary/10 border-primary border":""}`,onClick:()=>{r(t=>({...t,product_ids:t.product_ids.includes(s.id)?t.product_ids.filter(i=>i!==s.id):[...t.product_ids,s.id]}))},children:[s.image_url?e.jsx("img",{src:s.image_url,alt:"",className:"w-8 h-8 rounded object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded bg-muted flex items-center justify-center",children:e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{className:"flex-1 truncate",children:s.name}),a.product_ids.includes(s.id)&&e.jsx("span",{className:"text-primary text-xs",children:"âœ“"})]},s.id))})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"seeall",checked:a.show_see_all,onCheckedChange:s=>r(t=>({...t,show_see_all:s}))}),e.jsx(c,{htmlFor:"seeall",children:'Show "See All"'})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"active",checked:a.is_active,onCheckedChange:s=>r(t=>({...t,is_active:s}))}),e.jsx(c,{htmlFor:"active",children:"Active"})]})]})]}),e.jsxs(oe,{children:[e.jsx(d,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(d,{onClick:U,children:h?"Save":"Create"})]})]})}),e.jsx(de,{})]})}export{ge as default};
