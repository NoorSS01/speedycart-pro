import{u as Y,b as $,r as d,s as t,l as G,j as e,f as h,B as b,A as J,k as m,m as x,ap as V,aq as W,aA as X,ar as Z,as as ee,K as p,N as f,T as se,o as O,al as ae,ay as te,U as re,L as v,I as w,aS as le,av as ne,aw as ce,$ as de,ax as oe,y as L}from"./index-CzqGsn4l.js";import{A as ie}from"./AdminBottomNav-Cj834JeN.js";import"./sheet-u2JDy9wS.js";import"./wallet-VifLp9f-.js";function pe(){var P,_;const{user:r,userRole:u,loading:y,signOut:R}=Y(),o=$(),[T,k]=d.useState(!0),[C,S]=d.useState(!1),[s,g]=d.useState({phone:"",full_name:"",email:"",username:null}),[l,E]=d.useState({totalOrders:0,todayOrders:0,totalRevenue:0,todayRevenue:0,totalProducts:0,activeDeliveryPartners:0,totalCustomers:0}),[F,U]=d.useState(!0);d.useEffect(()=>{if(!y){if(!r){o("/auth");return}if(u!=="admin"&&u!=="super_admin"){o("/");return}q()}},[r,u,y,o]);const q=async()=>{if(r){k(!0);try{const{data:a}=await t.from("profiles").select("phone, full_name, username").eq("id",r.id).single();if(a){const n=a;g({phone:n.phone||"",full_name:n.full_name||"",email:r.email||"",username:n.username||null})}const i=new Date,A=new Date(i);A.setHours(0,0,0,0);const{count:B}=await t.from("orders").select("id",{count:"exact",head:!0}),{data:c}=await t.from("orders").select("id, total_amount").gte("created_at",A.toISOString()),{data:j}=await t.from("orders").select("total_amount").eq("status","delivered"),I=(j==null?void 0:j.reduce((n,N)=>n+(N.total_amount||0),0))||0,H=(c==null?void 0:c.reduce((n,N)=>n+(N.total_amount||0),0))||0,{count:K}=await t.from("products").select("id",{count:"exact",head:!0}),{count:M}=await t.from("user_roles").select("id",{count:"exact",head:!0}).eq("role","delivery"),{count:Q}=await t.from("profiles").select("id",{count:"exact",head:!0});E({totalOrders:B||0,todayOrders:(c==null?void 0:c.length)||0,totalRevenue:I,todayRevenue:H,totalProducts:K||0,activeDeliveryPartners:M||0,totalCustomers:Q||0})}catch(a){G.error("Failed to fetch admin profile data",{error:a})}finally{k(!1)}}},D=async()=>{var a;if(r){S(!0);try{const{error:i}=await t.from("profiles").update({full_name:s.full_name,username:((a=s.username)==null?void 0:a.toLowerCase())||null}).eq("id",r.id);if(i)throw i;L.success("Profile updated!")}catch{L.error("Failed to update profile")}finally{S(!1)}}},z=async()=>{await R(),o("/auth")};return T?e.jsxs("div",{className:"min-h-screen bg-background p-4",children:[e.jsx(h,{className:"h-12 w-full mb-4"}),e.jsx(h,{className:"h-32 w-full mb-4 rounded-xl"}),e.jsx(h,{className:"h-48 w-full mb-4 rounded-xl"}),e.jsx(h,{className:"h-64 w-full rounded-xl"})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-background/80 backdrop-blur-xl border-b",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>o("/admin"),children:e.jsx(J,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"Admin Account"}),e.jsx("div",{className:"ml-auto",children:e.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded-full font-medium capitalize",children:u})})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(m,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{className:"w-16 h-16 border-2 border-primary",children:e.jsx(W,{className:"bg-primary/10 text-primary text-xl",children:((_=(P=s.full_name)==null?void 0:P[0])==null?void 0:_.toUpperCase())||e.jsx(X,{className:"w-6 h-6"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-bold",children:s.full_name||"Admin"}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"})," ",s.phone||"No phone"]}),s.email&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"})," ",s.email]})]})]})})}),e.jsxs(m,{className:"bg-primary/5 border-primary/20",children:[e.jsx(p,{className:"pb-2",children:e.jsxs(f,{className:"text-sm flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Platform Overview"]})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",l.todayRevenue.toFixed(0)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Revenue"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:l.todayOrders}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Orders"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-emerald-600",children:["₹",l.totalRevenue.toFixed(0)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:l.totalOrders}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Orders"})]})]})})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(f,{className:"text-sm flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Quick Stats"]})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(O,{className:"w-6 h-6 text-blue-600"}),e.jsx("p",{className:"text-lg font-bold",children:l.totalProducts}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Products"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg",children:[e.jsx(ae,{className:"w-6 h-6 text-emerald-600"}),e.jsx("p",{className:"text-lg font-bold",children:l.activeDeliveryPartners}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Partners"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx(te,{className:"w-6 h-6 text-purple-600"}),e.jsx("p",{className:"text-lg font-bold",children:l.totalCustomers}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Customers"})]})]})})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(f,{className:"text-sm flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Edit Profile"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Full Name"}),e.jsx(w,{value:s.full_name||"",onChange:a=>g({...s,full_name:a.target.value}),placeholder:"Your name"})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Username"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex items-center justify-center px-3 bg-muted border border-r-0 rounded-l-md text-sm font-medium text-muted-foreground",children:"@"}),e.jsx(w,{value:s.username||"",onChange:a=>g({...s,username:a.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"").slice(0,20)}),placeholder:"your_username",className:"rounded-l-none",maxLength:20})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Letters, numbers, underscores (3-20 chars)"})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Phone Number"}),e.jsx(w,{value:s.phone,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Contact support to change phone number"})]}),e.jsx(b,{onClick:D,disabled:C,className:"w-full",children:C?"Saving...":"Save Changes"})]})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(f,{className:"text-sm flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Settings"]})}),e.jsx(x,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Push Notifications"})]}),e.jsx(ce,{checked:F,onCheckedChange:U})]})})]}),e.jsx(de,{}),e.jsxs(b,{variant:"destructive",className:"w-full",onClick:z,children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]}),e.jsx(ie,{})]})}export{pe as default};
