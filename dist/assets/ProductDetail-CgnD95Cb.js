import{c as pe,r as l,s as f,l as q,z as ts,b as as,u as rs,a as ls,j as e,f as k,i as De,o as se,B as T,I as ue,X as ns,A as is,G as Te,S as cs,C as os,q as Re,p as Ee,H as te,M as ds,n as us,J as $e,k as me,K as xe,N as he,O as ms,m as fe,Q as xs,R as hs,U as fs,P as Le,D as ps,t as gs,v as js,w as ys,L as G,V as Ns,x as bs,Z as vs,y as w}from"./index-CzqGsn4l.js";import{O as ws,R as _s,a as Me}from"./OrderConfirmation-BQuHxUoV.js";import{u as ks}from"./useRecommendations-uglMf1oZ.js";import{C as Cs}from"./chevron-left-2S0FLKrO.js";import{L as Ss}from"./leaf-FmHxWPk-.js";import{S as qs}from"./sparkles-BKN8rhJQ.js";import"./index-Cpbua6Wm.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=pe("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=pe("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=pe("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);let K=null,X=!1;function Os(m,C=[]){const[b,R]=l.useState([]),[M,I]=l.useState(!0),[Q,a]=l.useState(null),N=l.useRef(!0),z=l.useCallback(async()=>{if(!m){I(!1),a(null);return}a(null);try{const{data:_}=await f.from("products").select("id, category_id").eq("id",m).single();if(!_||!N.current){I(!1);return}const d=[],p=new Set([m,...C]),y=4;if(K!==!1)try{const{data:g,error:c}=await f.rpc("get_frequently_bought_together",{p_product_id:m,p_limit:y,p_exclude_ids:Array.from(p)});if(!c&&g&&g.length>0)K=!0,X=!0,g.forEach(h=>{p.has(h.product_id)||(d.push({id:h.product_id,name:h.name,price:h.price,mrp:h.mrp,image_url:h.image_url,unit:h.unit,stock_quantity:h.stock_quantity,category_id:null,discount_percent:null}),p.add(h.product_id))});else if(c){const{data:h,error:v}=await f.from("product_co_purchases").select("co_product_id, co_purchase_count").eq("product_id",m).order("co_purchase_count",{ascending:!1}).limit(y+2);if(v)X||(q.info("product_co_purchases table not available, using fallback strategies"),K=!1,X=!0);else if(h&&h.length>0){K=!0,X=!0;const u=h.map(n=>n.co_product_id).filter(n=>!p.has(n));if(u.length>0){const{data:n}=await f.from("products").select("*").in("id",u).eq("is_active",!0).gt("stock_quantity",0).limit(y);n&&n.forEach(O=>{!p.has(O.id)&&d.length<y&&(d.push(O),p.add(O.id))})}}}}catch{X||(K=!1,X=!0)}if(!N.current)return;if(d.length<y&&_.category_id){const{data:g}=await f.from("products").select("*").eq("category_id",_.category_id).eq("is_active",!0).gt("stock_quantity",0).neq("id",m).order("created_at",{ascending:!1}).limit(y);g&&g.forEach(c=>{!p.has(c.id)&&d.length<y&&(d.push(c),p.add(c.id))})}if(!N.current)return;if(d.length<2){const g=new Date(Date.now()-6048e5).toISOString(),{data:c}=await f.from("order_items").select("product_id").gte("created_at",g);if(c&&c.length>0){const h=c.reduce((u,n)=>(p.has(n.product_id)||(u[n.product_id]=(u[n.product_id]||0)+1),u),{}),v=Object.entries(h).sort((u,n)=>n[1]-u[1]).slice(0,y-d.length).map(([u])=>u);if(v.length>0){const{data:u}=await f.from("products").select("*").in("id",v).eq("is_active",!0).gt("stock_quantity",0);u&&u.forEach(n=>{!p.has(n.id)&&d.length<y&&(d.push(n),p.add(n.id))})}}}if(!N.current)return;if(d.length<2){const{data:g}=await f.from("products").select("*").eq("is_active",!0).gt("stock_quantity",0).order("created_at",{ascending:!1}).limit(y);g&&g.forEach(c=>{!p.has(c.id)&&d.length<y&&(d.push(c),p.add(c.id))})}N.current&&R(d)}catch(_){q.error("Frequently bought together error",{error:_}),N.current&&(a("Failed to load recommendations"),R([]))}finally{N.current&&I(!1)}},[m,C]);return l.useEffect(()=>(N.current=!0,z(),()=>{N.current=!1}),[z]),{products:b,isLoading:M,error:Q,productIds:b.map(_=>_.id)}}let ae=null,J=!1;function Fs(m,C=[]){const[b,R]=l.useState([]),[M,I]=l.useState(!0),[Q,a]=l.useState(null),N=l.useRef(!0),z=l.useCallback(async()=>{if(!m){I(!1),a(null);return}a(null);try{const{data:_}=await f.from("products").select("id, category_id").eq("id",m).single();if(!_||!N.current){I(!1);return}const d=[],p=new Set([m,...C]),y=8;if(ae!==!1)try{const{data:g,error:c}=await f.from("product_co_purchases").select("co_product_id, co_purchase_count").eq("product_id",m).order("co_purchase_count",{ascending:!1}).limit(y+C.length);if(c)J||(q.debug("product_co_purchases not available for PAB"),ae=!1,J=!0);else if(g&&g.length>0){ae=!0,J=!0;const h=g.map(v=>v.co_product_id).filter(v=>!p.has(v));if(h.length>0){const{data:v}=await f.from("products").select("*").in("id",h).eq("is_active",!0).gt("stock_quantity",0).limit(y);if(v){const u=new Map(v.map(n=>[n.id,n]));h.forEach(n=>{const O=u.get(n);O&&!p.has(n)&&d.length<y&&(d.push(O),p.add(n))})}}}}catch{J||(ae=!1,J=!0)}if(!N.current)return;if(d.length<y&&_.category_id){const g=y-d.length,{data:c}=await f.from("products").select("*").eq("category_id",_.category_id).eq("is_active",!0).gt("stock_quantity",0).neq("id",m).order("created_at",{ascending:!1}).limit(g+4);c&&c.forEach(h=>{!p.has(h.id)&&d.length<y&&(d.push(h),p.add(h.id))})}if(!N.current)return;if(d.length<4){const g=new Date(Date.now()-6048e5).toISOString(),{data:c}=await f.from("order_items").select("product_id").gte("created_at",g);if(c&&c.length>0){const h=c.reduce((u,n)=>(p.has(n.product_id)||(u[n.product_id]=(u[n.product_id]||0)+1),u),{}),v=Object.entries(h).sort((u,n)=>n[1]-u[1]).slice(0,y-d.length).map(([u])=>u);if(v.length>0){const{data:u}=await f.from("products").select("*").in("id",v).eq("is_active",!0).gt("stock_quantity",0);u&&u.forEach(n=>{!p.has(n.id)&&d.length<y&&(d.push(n),p.add(n.id))})}}}N.current&&R(d)}catch(_){q.error("People also bought error",{error:_}),N.current&&(a("Failed to load recommendations"),R([]))}finally{N.current&&I(!1)}},[m,C]);return l.useEffect(()=>(N.current=!0,z(),()=>{N.current=!1}),[z]),{products:b,isLoading:M,error:Q}}function Ms(){const{id:m}=ts(),C=as(),{user:b}=rs(),{refreshCart:R,addToCart:M,getItemQuantity:I,updateQuantity:Q}=ls(),[a,N]=l.useState(null),[z,_]=l.useState([]),[d,p]=l.useState([]),[y,g]=l.useState(!0),[c,h]=l.useState(1),[v,u]=l.useState(!1),[n,O]=l.useState("address"),[Qe,W]=l.useState(!1),[E,re]=l.useState(""),[H,ze]=l.useState("saved"),[U,le]=l.useState(""),[S,ge]=l.useState(""),[F,je]=l.useState(""),[B,ye]=l.useState(""),[ne,Ue]=l.useState(!1),[Xe,Y]=l.useState(!1),[D,V]=l.useState(""),[Ne,Z]=l.useState([]),[be,ve]=l.useState([]),[i,ie]=l.useState(null),[ee,we]=l.useState([]),[P,$]=l.useState(0),[He,_e]=l.useState(!1),[Ze,Ge]=l.useState(""),{trackView:ke}=ks(),{products:Ce,isLoading:Ke,productIds:Je}=Os(m),{products:Se,isLoading:We}=Fs(m,Je);l.useEffect(()=>{const t=setTimeout(async()=>{if(D.trim().length<2){Z([]);return}const{data:r}=await f.from("products").select("*").ilike("name",`%${D.trim()}%`).gt("stock_quantity",0).limit(5);r&&Z(r.map(x=>({...x,stock_quantity:x.stock_quantity??0,unit:x.unit||"piece"})))},300);return()=>clearTimeout(t)},[D]);const qe=l.useCallback(async(s,t)=>{const{data:r}=await f.from("products").select("*").eq("category_id",s).neq("id",t).gt("stock_quantity",0).limit(6);r&&_(r.map(x=>({...x,stock_quantity:x.stock_quantity??0,unit:x.unit||"piece"})))},[]),ce=l.useCallback(async()=>{if(!m)return;const{data:s,error:t}=await f.from("products").select("*").eq("id",m).single();!t&&s&&(N({...s,stock_quantity:s.stock_quantity??0,unit:s.unit||"piece"}),ke(s.id),s.category_id&&qe(s.category_id,s.id)),g(!1)},[m,ke,qe]),Ae=l.useCallback(async()=>{if(m)try{const{data:s,error:t}=await f.from("product_reviews").select(`
          id,
          rating,
          review_text,
          created_at,
          user_id,
          profiles:user_id(full_name)
        `).eq("product_id",m).order("created_at",{ascending:!1});s&&!t&&p(s)}catch{q.info("Product reviews table may not exist yet")}},[m]),Pe=l.useCallback(async()=>{if(m)try{const{data:s,error:t}=await f.from("product_images").select("image_url, display_order").eq("product_id",m).order("display_order",{ascending:!0});s&&!t&&we(s.map(r=>r.image_url))}catch{q.info("Product images table may not exist yet")}},[m]),Ie=l.useCallback(async()=>{if(m)try{const{data:s,error:t}=await f.from("product_variants").select("*").eq("product_id",m).order("display_order");if(!t&&s&&s.length>0){ve(s);const r=s.find(x=>x.is_default)||s[0];ie(r)}}catch{q.info("Product variants table may not exist yet")}},[m]),Ye=l.useCallback(async()=>{if(!b)return;const{data:s}=await f.from("profiles").select("address").eq("id",b.id).single();s!=null&&s.address&&re(s.address)},[b]);l.useEffect(()=>{m&&(h(1),ve([]),ie(null),we([]),$(0),N(null),g(!0),ce(),Ae(),Ie(),Pe())},[m,ce,Ae,Ie,Pe]),l.useEffect(()=>{b&&Ye()},[b]);const Ve=async()=>{if(!b||!a){w.error("Please sign in first"),C("/auth");return}if(c>a.stock_quantity){w.error(`Only ${a.stock_quantity} available`);return}u(!0);try{const s=(i==null?void 0:i.id)||null;let t=f.from("cart_items").select("*").eq("user_id",b.id).eq("product_id",a.id);s?t=t.eq("variant_id",s):t=t.is("variant_id",null);const{data:r,error:x}=await t.maybeSingle();if(x){q.error("Cart fetch error",{error:x}),w.error("Failed to check cart. Please try again."),u(!1);return}if(r){const o=r.quantity+c;if(o>a.stock_quantity){w.error(`Only ${a.stock_quantity} available (${r.quantity} already in cart)`),u(!1);return}const{error:j}=await f.from("cart_items").update({quantity:o}).eq("id",r.id);if(j){q.error("Cart update error",{error:j}),w.error("Failed to update cart. Please try again."),u(!1);return}}else{const{error:o}=await f.from("cart_items").insert({user_id:b.id,product_id:a.id,quantity:c,variant_id:s});if(o){q.error("Cart insert error",{error:o}),o.code==="23505"?w.error("This item is already in your cart. Try refreshing the page."):w.error("Failed to add to cart. Please try again."),u(!1);return}}const A=i?` (${i.variant_name})`:"";w.success(`Added ${c}${A} to cart`),R()}catch(s){q.error("Unexpected cart error",{error:s}),w.error("Something went wrong. Please try again.")}finally{u(!1)}},es=async()=>{let s="";if(H==="saved")s=E;else if(S&&S!=="Other"){const t=[];F&&t.push(`Block ${F}`),B&&t.push(`Room ${B}`);const r=t.length>0?t.join(", "):"";s=`${r?r+", ":""}${S}, Chandapura-Anekal Road, Bangalore - 562106`}else s=U.trim();if(!s){w.error("Please provide a delivery address");return}if(b){const{error:t}=await f.from("profiles").update({address:s}).eq("id",b.id);if(t){w.error("Failed to save address");return}}re(s),le(""),ge(""),je(""),ye(""),W(!1),w.success("Delivery address saved")},ss=async()=>{if(!b||!a)return;let s="";if(H==="saved")s=E;else if(S&&S!=="Other"){const x=[];F&&x.push(`Block ${F}`),B&&x.push(`Room ${B}`);const A=x.length>0?x.join(", "):"";s=`${A?A+", ":""}${S}, Chandapura-Anekal Road, Bangalore - 562106`}else s=U.trim();if(!s){w.error("Please provide a delivery address");return}const t=(i==null?void 0:i.price)??a.price,r=[{product_id:a.id,variant_id:(i==null?void 0:i.id)||null,quantity:c,price:t}];try{const{data:x,error:A}=await f.rpc("place_order_atomic",{p_user_id:b.id,p_delivery_address:s,p_cart_items:r,p_coupon_id:null,p_coupon_discount:0});if(A){q.error("RPC error",{error:A}),w.error("Failed to place order. Please try again.");return}const o=x;if(!o.success){w.error(o.error||"Failed to place order"),ce();return}H==="new"&&U.trim()&&(await f.from("profiles").update({address:U.trim()}).eq("id",b.id),re(U.trim())),W(!1),le(""),Ge(o.order_id||""),_e(!0)}catch(x){q.error("Order error",{error:x}),w.error("Failed to place order. Please try again.")}};if(y)return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-background/95 backdrop-blur border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsx(k,{className:"h-9 w-9 rounded-md"}),e.jsx(k,{className:"h-9 w-9 rounded-md"})]})}),e.jsx("div",{className:"w-full aspect-square bg-muted relative",children:e.jsx(k,{className:"w-full h-full"})}),e.jsxs("div",{className:"container mx-auto px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"h-8 w-3/4"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx(k,{className:"h-8 w-24"}),e.jsx(k,{className:"h-4 w-12"})]}),e.jsx(k,{className:"h-6 w-16 rounded-full"})]})]}),e.jsx(k,{className:"h-20 w-full"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"h-4 w-8"}),e.jsx(k,{className:"h-10 w-32 rounded-full"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{className:"h-12 flex-1 rounded-md"}),e.jsx(k,{className:"h-12 flex-1 rounded-md"})]}),e.jsx(k,{className:"h-40 w-full rounded-xl"}),e.jsx(k,{className:"h-14 w-full rounded-xl"}),e.jsx(k,{className:"h-40 w-full rounded-xl"})]}),e.jsx(De,{})]});if(!a)return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center gap-4 p-4",children:[e.jsx(se,{className:"h-16 w-16 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Product not found"}),e.jsx(T,{onClick:()=>C("/shop"),children:"Back to Shop"})]});const oe=a.stock_quantity<=0,Oe=a.stock_quantity>0&&a.stock_quantity<=5,Fe=d.length>0?(d.reduce((s,t)=>s+t.rating,0)/d.length).toFixed(1):null;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20 pb-24",children:[He&&e.jsx(ws,{orderId:Ze,onClose:()=>_e(!1)}),e.jsx("header",{className:"sticky top-0 z-50 bg-background/95 backdrop-blur border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:Xe?e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{placeholder:"Search products...",value:D,onChange:s=>V(s.target.value),className:"flex-1",autoFocus:!0,onKeyDown:s=>{s.key==="Enter"&&D.trim()&&C(`/shop?search=${encodeURIComponent(D.trim())}`)}}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>{Y(!1),V(""),Z([])},children:e.jsx(ns,{className:"h-5 w-5"})})]}),Ne.length>0&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-background border rounded-lg shadow-lg z-50 overflow-hidden",children:[Ne.map(s=>e.jsxs("button",{onClick:()=>{C(`/product/${s.id}`),Y(!1),V(""),Z([])},className:"w-full flex items-center gap-3 p-3 hover:bg-muted transition-colors text-left",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-muted flex-shrink-0",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(se,{className:"h-6 w-6 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-primary font-semibold",children:["â‚¹",s.price]})]})]},s.id)),e.jsxs("button",{onClick:()=>{C(`/shop?search=${encodeURIComponent(D.trim())}`),Y(!1),V(""),Z([])},className:"w-full p-3 border-t text-sm text-primary font-medium hover:bg-muted transition-colors",children:['See all results for "',D,'"']})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",onClick:()=>{O("address"),W(!0)},children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),C(-1)},children:e.jsx(is,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-muted/50 flex-1 min-w-0 cursor-pointer hover:bg-muted transition-colors",children:[e.jsx(Te,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-sm truncate",children:E?E.slice(0,30)+(E.length>30?"...":""):"Add delivery address"})]})]}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>Y(!0),children:e.jsx(cs,{className:"h-5 w-5"})})]})})}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"aspect-square bg-muted relative overflow-hidden",onTouchStart:s=>{const t=s.touches[0];s.currentTarget.touchStartX=t.clientX},onTouchEnd:s=>{const t=s.changedTouches[0].clientX,x=(s.currentTarget.touchStartX||0)-t,A=[a.image_url,...ee].filter(Boolean);Math.abs(x)>50&&(x>0&&P<A.length-1?$(P+1):x<0&&P>0&&$(P-1))},children:[(()=>{const t=[a.image_url,...ee].filter(Boolean)[P]||a.image_url;return t?e.jsx("img",{src:t,alt:a.name,className:"w-full h-full object-cover transition-opacity duration-300"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(se,{className:"h-24 w-24 text-muted-foreground"})})})(),(()=>{const s=[a.image_url,...ee].filter(Boolean);return s.length>1?e.jsxs(e.Fragment,{children:[P>0&&e.jsx("button",{onClick:()=>$(P-1),className:"absolute left-2 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-black/30 text-white flex items-center justify-center hover:bg-black/50 transition-colors",children:e.jsx(Cs,{className:"h-6 w-6"})}),P<s.length-1&&e.jsx("button",{onClick:()=>$(P+1),className:"absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-black/30 text-white flex items-center justify-center hover:bg-black/50 transition-colors",children:e.jsx(os,{className:"h-6 w-6"})}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2",children:s.map((t,r)=>e.jsx("button",{onClick:()=>$(r),className:`w-2.5 h-2.5 rounded-full transition-all ${P===r?"bg-white scale-110":"bg-white/50 hover:bg-white/70"}`},r))})]}):null})(),(()=>{const s=(i==null?void 0:i.mrp)??a.mrp,t=(i==null?void 0:i.price)??a.price,r=s&&s>t?Math.round((s-t)/s*100):0;return r>0?e.jsxs("div",{className:"absolute top-4 left-4 z-10 px-3 py-1.5 rounded-lg bg-gradient-to-r from-green-500 to-emerald-600 text-white text-sm font-bold shadow-lg",children:[r,"% OFF"]}):null})(),Oe&&e.jsxs(Re,{className:"absolute top-4 right-4 bg-red-500 text-white",children:["Only ",a.stock_quantity," left!"]}),oe&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(Re,{variant:"destructive",className:"text-lg px-4 py-2",children:"Out of Stock"})})]}),(()=>{const s=[a.image_url,...ee].filter(Boolean);return s.length>1?e.jsx("div",{className:"flex gap-2 p-3 overflow-x-auto bg-muted/50",children:s.map((t,r)=>e.jsx("button",{onClick:()=>$(r),className:`flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition-all ${P===r?"border-primary ring-2 ring-primary/20":"border-transparent opacity-70 hover:opacity-100"}`,children:e.jsx("img",{src:t,alt:`Product ${r+1}`,className:"w-full h-full object-cover"})},r))}):null})()]}),e.jsxs("div",{className:"container mx-auto px-4 py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.name}),be.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Select Size/Quantity:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:be.map(s=>{const t=(i==null?void 0:i.id)===s.id,r=s.mrp?Math.round((s.mrp-s.price)/s.mrp*100):0;return e.jsxs("button",{onClick:()=>ie(s),className:`relative p-3 rounded-xl border-2 transition-all min-w-[100px] ${t?"border-primary bg-primary/5 shadow-md":"border-border hover:border-primary/50"}`,children:[r>0&&e.jsxs("span",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full",children:[r,"% OFF"]}),e.jsx("p",{className:"font-semibold text-sm",children:Ee(s)}),e.jsxs("p",{className:"text-primary font-bold",children:["â‚¹",s.price]}),s.mrp&&s.mrp>s.price&&e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["â‚¹",s.mrp]})]},s.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex items-baseline gap-2",children:(()=>{const s=(i==null?void 0:i.price)??a.price,t=(i==null?void 0:i.mrp)??a.mrp,r=i?Ee(i):a.unit,x=t?Math.round((t-s)/t*100):0;return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-3xl font-bold text-primary",children:["â‚¹",s]}),t&&t>s&&e.jsxs("span",{className:"text-lg text-muted-foreground line-through",children:["â‚¹",t]}),e.jsxs("span",{className:"text-muted-foreground",children:["/ ",r]}),x>0&&!i&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-sm font-semibold rounded",children:[x,"% OFF"]})]})})()}),(()=>{const s=(i==null?void 0:i.price)??a.price;let t=0,r=null;const x=o=>{if(!o)return null;o=o.toLowerCase().trim();const j=o.match(/(\d+\.?\d*)\s*(kg|g|gm|gram|grams|ltr|l|litre|liter|ml|dozen|pack|pcs|pieces)/);return j?{qty:parseFloat(j[1]),unit:j[2]}:null},A=(o,j)=>(j=j.toLowerCase(),j==="kg"?{base:o*1e3,type:"weight"}:["g","gm","gram","grams"].includes(j)?{base:o,type:"weight"}:["l","ltr","litre","liter"].includes(j)?{base:o*1e3,type:"volume"}:j==="ml"?{base:o,type:"volume"}:["dozen","pack","pcs","pieces"].includes(j)?{base:o,type:"count"}:null);if(i){const o=i.variant_name||"",j=(i.variant_unit||"").toLowerCase(),Be=i.variant_value||0;let L=x(o);if(!L&&/^\d+\.?\d*$/.test(o.trim())&&j&&(L={qty:parseFloat(o.trim()),unit:j}),!L&&Be>0&&j&&(L={qty:Be,unit:j}),L){const de=A(L.qty,L.unit);de&&(t=de.base,r=de.type)}}if(!t&&a.unit){const o=x(a.unit);if(o){const j=A(o.qty,o.unit);j&&(t=j.base,r=j.type)}}if(!t||t<=0||!r)return null;if(r==="weight"){const o=s/t*100;return e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["â‚¹",o.toFixed(2)," per 100g"]})}if(r==="volume"){const o=s/t*100;return e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["â‚¹",o.toFixed(2)," per 100ml"]})}if(r==="count"&&t>1){const o=s/t;return e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["â‚¹",o.toFixed(2)," per piece"]})}return null})()]}),Fe&&e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-100 dark:bg-yellow-900/30 px-2 py-1 rounded-full",children:[e.jsx(te,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"font-bold text-sm",children:Fe}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",d.length,")"]})]})]})]}),a.description&&e.jsx("p",{className:"text-muted-foreground text-sm",children:a.description}),!oe&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Qty:"}),e.jsxs("div",{className:"flex items-center gap-2 bg-muted rounded-full p-1",children:[e.jsx(T,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full",onClick:()=>h(Math.max(1,c-1)),children:e.jsx(ds,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-semibold",children:c}),e.jsx(T,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full",onClick:()=>h(Math.min(a.stock_quantity,c+1)),children:e.jsx(us,{className:"h-4 w-4"})})]}),Oe&&e.jsxs("span",{className:"text-xs text-red-500",children:["Only ",a.stock_quantity," left"]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(T,{className:"flex-1 h-12",onClick:Ve,disabled:oe||v,children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Add to Cart"]})}),e.jsxs(me,{children:[e.jsx(xe,{className:"py-3 px-4",children:e.jsxs(he,{className:"text-base flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4 text-primary"})," Highlights"]})}),e.jsx(fe,{className:"px-4 pb-4 pt-0",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(As,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Brand"}),e.jsx("p",{className:"font-medium",children:"PremasShop"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Type"}),e.jsx("p",{className:"font-medium",children:"Grocery"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ss,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Diet"}),e.jsx("p",{className:"font-medium",children:"Veg"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Is,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Unit"}),e.jsx("p",{className:"font-medium",children:a.unit})]})]})]})})]}),e.jsxs(me,{children:[e.jsx(xe,{className:"py-3 px-4 cursor-pointer",onClick:()=>Ue(!ne),children:e.jsxs(he,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-4 w-4 text-primary"})," Information"]}),ne?e.jsx(xs,{className:"h-4 w-4"}):e.jsx(hs,{className:"h-4 w-4"})]})}),ne&&e.jsxs(fe,{className:"px-4 pb-4 pt-0 space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs mb-1",children:"Disclaimer"}),e.jsx("p",{className:"text-xs leading-relaxed",children:"Images are for representational purposes. Check label for details before consuming."})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs mb-1",children:"Customer Care"}),e.jsx("p",{className:"text-xs",children:"support@premasshop.com"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs mb-1",children:"Seller"}),e.jsx("p",{className:"text-xs font-medium",children:"PremasShop Local Vendors"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs mb-1",children:"Country of Origin"}),e.jsx("p",{className:"text-xs",children:"India"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs mb-1",children:"Shelf Life"}),e.jsx("p",{className:"text-xs",children:"As per product packaging"})]})]})]}),e.jsxs(me,{children:[e.jsx(xe,{className:"py-3 px-4",children:e.jsxs(he,{className:"text-base flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-primary"})," Reviews"]})}),e.jsx(fe,{className:"px-4 pb-4 pt-0",children:d.length>0?e.jsx("div",{className:"space-y-4",children:d.map(s=>{var t;return e.jsxs("div",{className:"border-b last:border-0 pb-3 last:pb-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 rounded-full bg-muted flex items-center justify-center",children:e.jsx(fs,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx("span",{className:"text-sm font-medium",children:((t=s.profiles)==null?void 0:t.full_name)||"Anonymous"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"flex items-center gap-1 mb-1",children:[1,2,3,4,5].map(r=>e.jsx(te,{className:`h-3 w-3 ${r<=s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},r))}),s.review_text&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.review_text})]},s.id)})}):e.jsxs("div",{className:"flex flex-col items-center py-6 text-center",children:[e.jsx("div",{className:"flex gap-1 mb-2",children:[1,2,3,4,5].map(s=>e.jsx(te,{className:"h-5 w-5 text-muted-foreground/30"},s))}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No reviews yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Be the first to review!"})]})})]}),Ke||We?e.jsxs("div",{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"h-5 w-5 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-32 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"flex gap-3 overflow-hidden -mx-4 px-4",children:[1,2,3,4].map(s=>e.jsx("div",{className:"flex-shrink-0 w-[calc((100vw-48px)/3)] min-w-[100px] max-w-[120px]",children:e.jsxs("div",{className:"rounded-2xl border-2 border-border/40 bg-card overflow-hidden",children:[e.jsx("div",{className:"aspect-square bg-muted animate-pulse"}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsx("div",{className:"h-3 w-3/4 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-12 bg-muted rounded animate-pulse"})]})]})},s))})]}):e.jsxs(e.Fragment,{children:[Ce.length>0&&e.jsxs("div",{className:"pt-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5 text-primary"}),"Frequently bought together"]}),e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4",children:e.jsx("div",{className:"flex gap-3 pb-2",children:Ce.map(s=>e.jsx("div",{className:"flex-shrink-0 w-[calc((100vw-48px)/3)] min-w-[100px] max-w-[120px]",children:e.jsx(Le,{product:{id:s.id,name:s.name,price:s.price,image_url:s.image_url||null,unit:s.unit||"unit",mrp:s.mrp??null,discount_percent:s.discount_percent??null,default_variant:null,stock_quantity:s.stock_quantity},onAddToCart:t=>M(t,null),cartQuantity:I(s.id,null),onQuantityChange:(t,r)=>Q(t,null,r)})},s.id))})})]}),Se.length>0&&e.jsxs("div",{className:"pt-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(qs,{className:"h-5 w-5 text-amber-500"}),"People also bought"]}),e.jsx("div",{className:"overflow-x-auto scrollbar-hide -mx-4 px-4",children:e.jsx("div",{className:"flex gap-3 pb-2",children:Se.map(s=>e.jsx("div",{className:"flex-shrink-0 w-[calc((100vw-48px)/3)] min-w-[100px] max-w-[120px]",children:e.jsx(Le,{product:{id:s.id,name:s.name,price:s.price,image_url:s.image_url||null,unit:s.unit||"unit",mrp:s.mrp??null,discount_percent:s.discount_percent??null,default_variant:null,stock_quantity:s.stock_quantity},onAddToCart:t=>M(t,null),cartQuantity:I(s.id,null),onQuantityChange:(t,r)=>Q(t,null,r)})},s.id))})})]})]})]}),e.jsx(ps,{open:Qe,onOpenChange:W,children:e.jsxs(gs,{className:"max-w-sm",children:[e.jsx(js,{children:e.jsxs(ys,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary"}),n==="buynow"?"Confirm Order":"Delivery Address"]})}),e.jsxs("div",{className:"space-y-4",children:[n==="buynow"&&e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:a==null?void 0:a.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",c," Ã— â‚¹",a==null?void 0:a.price," = â‚¹",(c*((a==null?void 0:a.price)||0)).toFixed(0)]})]}),e.jsxs(_s,{value:H,onValueChange:s=>ze(s),children:[E&&e.jsxs("div",{className:"flex items-start gap-2 p-3 border rounded-lg",children:[e.jsx(Me,{value:"saved",id:"saved",className:"mt-1"}),e.jsxs(G,{htmlFor:"saved",className:"flex-1 cursor-pointer",children:[e.jsx("p",{className:"text-sm font-medium",children:"Saved Address"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 text-wrap break-words",children:E})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 border rounded-lg",children:[e.jsx(Me,{value:"new",id:"new",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(G,{htmlFor:"new",className:"cursor-pointer font-medium",children:"New Address"}),H==="new"&&e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-xs",children:"Apartment Complex"}),e.jsxs("select",{value:S,onChange:s=>ge(s.target.value),className:"w-full mt-1.5 p-2.5 border rounded-md bg-background text-sm",children:[e.jsx("option",{value:"",children:"Select your apartment..."}),e.jsx("option",{value:"VBHC Vaibhava",children:"VBHC Vaibhava"}),e.jsx("option",{value:"Symphony",children:"Symphony"}),e.jsx("option",{value:"Other",children:"Other (Enter manually)"})]}),S&&S!=="Other"&&e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:["ðŸ“ ",S,", Chandapura-Anekal Road, Bangalore - 562106"]})]}),S==="Other"?e.jsx(Ns,{placeholder:"Enter full address",value:U,onChange:s=>le(s.target.value),className:"min-h-[80px]"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-xs",children:"Block/Tower"}),e.jsx(ue,{placeholder:"e.g. 51",value:F,onChange:s=>je(s.target.value),className:"mt-1 h-9"})]}),e.jsxs("div",{children:[e.jsx(G,{className:"text-xs",children:"Room No."}),e.jsx(ue,{placeholder:"e.g. 603",value:B,onChange:s=>ye(s.target.value),className:"mt-1 h-9"})]})]}),S&&(F||B)&&e.jsxs("div",{className:"p-2 bg-muted/50 rounded-lg text-xs",children:[e.jsx("p",{className:"font-medium",children:"Delivery to:"}),e.jsxs("p",{className:"text-muted-foreground",children:[F&&`Block ${F}`,B&&`, Room ${B}`,e.jsx("br",{}),S,", Chandapura-Anekal Road..."]})]})]})]})]})]})]})]}),e.jsx(bs,{children:e.jsx(T,{onClick:n==="buynow"?ss:es,className:"w-full h-12",children:n==="buynow"?e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"h-4 w-4 mr-2"})," Confirm Order â€¢ â‚¹",(c*((a==null?void 0:a.price)||0)).toFixed(0)]}):"Save Address"})})]})}),e.jsx(De,{})]})}export{Ms as default};
