import{r as i,j as e,a9 as le,aa as H,e as de,D as ce,t as me,v as ue,w as xe,B as N,aG as M,aj as q,X as pe,u as he,b as fe,l as A,s as j,f as V,A as ge,am as ve,k as $,m as R,_ as W,T as je,al as Ne,y as T}from"./index-CzqGsn4l.js";import{A as B}from"./AdminBottomNav-Cj834JeN.js";import{W as ye}from"./wallet-VifLp9f-.js";import"./sheet-u2JDy9wS.js";var O="Progress",F=100,[be]=le(O),[we,Pe]=be(O),Y=i.forwardRef((s,r)=>{const{__scopeProgress:u,value:n=null,max:t,getValueLabel:w=Ce,...d}=s;(t||t===0)&&!G(t)&&console.error(De(`${t}`,"Progress"));const c=G(t)?t:F;n!==null&&!X(n,c)&&console.error(_e(`${n}`,"Progress"));const l=X(n,c)?n:null,g=I(l)?w(l,c):void 0;return e.jsx(we,{scope:u,value:l,max:c,children:e.jsx(H.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":I(l)?l:void 0,"aria-valuetext":g,role:"progressbar","data-state":Q(l,c),"data-value":l??void 0,"data-max":c,...d,ref:r})})});Y.displayName=O;var J="ProgressIndicator",K=i.forwardRef((s,r)=>{const{__scopeProgress:u,...n}=s,t=Pe(J,u);return e.jsx(H.div,{"data-state":Q(t.value,t.max),"data-value":t.value??void 0,"data-max":t.max,...n,ref:r})});K.displayName=J;function Ce(s,r){return`${Math.round(s/r*100)}%`}function Q(s,r){return s==null?"indeterminate":s===r?"complete":"loading"}function I(s){return typeof s=="number"}function G(s){return I(s)&&!isNaN(s)&&s>0}function X(s,r){return I(s)&&!isNaN(s)&&s<=r&&s>=0}function De(s,r){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${F}\`.`}function _e(s,r){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${F} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Z=Y,ke=K;const ee=i.forwardRef(({className:s,value:r,...u},n)=>e.jsx(Z,{ref:n,className:de("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...u,children:e.jsx(ke,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));ee.displayName=Z.displayName;function Ie({open:s,onOpenChange:r,upiId:u,payeeName:n,amount:t,onPaymentConfirmed:w}){const[d,c]=i.useState("initial"),[l,g]=i.useState(16),[C,P]=i.useState(0);i.useEffect(()=>{s&&(c("initial"),g(16),P(0))},[s]),i.useEffect(()=>{let o;return d==="waiting"&&l>0?o=setInterval(()=>{g(v=>{const y=v-.1;return y<0?0:y}),P(v=>v+100/(16*10))},100):d==="waiting"&&l<=0&&c("confirm"),()=>clearInterval(o)},[d,l]);const E=()=>`upi://pay?pa=${encodeURIComponent(u)}&pn=${encodeURIComponent(n)}&am=${t.toFixed(2)}&cu=INR&tn=${encodeURIComponent("SpeedyCart Payout")}`,D=()=>{const o=E();window.location.href=o,c("waiting")};return e.jsx(ce,{open:s,onOpenChange:o=>{d==="waiting"&&o===!1||r(o)},children:e.jsxs(me,{className:"sm:max-w-md",children:[e.jsx(ue,{children:e.jsxs(xe,{children:["Pay ",n]})}),e.jsxs("div",{className:"py-6 flex flex-col items-center justify-center space-y-6 text-center",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-xl w-full",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Payable"}),e.jsxs("p",{className:"text-4xl font-bold text-primary",children:["₹",t.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 font-mono",children:u})]}),d==="initial"&&e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Click below to open your preferred UPI app. ",e.jsx("br",{}),"Please verify the UPI ID before paying."]}),e.jsxs(N,{size:"lg",className:"w-full text-lg h-12",onClick:D,children:[e.jsx(M,{className:"mr-2 h-5 w-5"})," Pay Now"]})]}),d==="waiting"&&e.jsxs("div",{className:"w-full space-y-4 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"relative w-20 h-20 mx-auto flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-muted rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-t-primary rounded-full animate-spin"}),e.jsxs("span",{className:"font-bold text-xl",children:[Math.ceil(l),"s"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Waiting for Payment..."}),e.jsx("p",{className:"text-sm text-muted-foreground px-4",children:"Complete the payment in your UPI app. Do not verify anything yet. We will ask for confirmation shortly."})]}),e.jsx(ee,{value:Math.min(C,100),className:"h-2 w-full"})]}),d==="confirm"&&e.jsxs("div",{className:"w-full space-y-4 animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(q,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Did you complete the payment?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The amount will be marked as paid and sent for approval."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full",children:[e.jsxs(N,{variant:"outline",size:"lg",onClick:()=>r(!1),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"})," No, I didn't"]}),e.jsxs(N,{size:"lg",className:"bg-green-600 hover:bg-green-700",onClick:w,children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Yes, I Paid"]})]})]})]})]})})}const se="8310807978",Ee=`${se}@ybl`,Te=()=>{const{user:s,userRole:r,loading:u}=he(),n=fe(),[t,w]=i.useState({deliveredOrders:0,totalDeveloperCommission:0,paidDeveloperCommission:0,pendingDeveloper:0}),[d,c]=i.useState([]),[l,g]=i.useState(!0),[C,P]=i.useState(null),[E,D]=i.useState(!1),[o,v]=i.useState({open:!1,upiId:"",payeeName:"",amount:0,payeeId:null,type:"developer_commission"});i.useEffect(()=>{if(!u){if(!s){n("/auth");return}if(r!=="admin"&&r!=="super_admin"){n("/shop");return}y()}},[s,r,u,n]);const y=async()=>{g(!0),P(null);try{await Promise.all([ae(),re()])}catch(a){A.error("Failed to load payment data",{error:a}),P("Failed to load payment data. Please try again.")}finally{g(!1)}},ae=async()=>{const{data:a,error:x}=await j.from("orders").select("id").eq("status","delivered");if(x)throw x;const b=(a==null?void 0:a.length)||0,p=b*4,{data:h,error:m}=await j.from("payouts").select("amount, status").eq("type","developer_commission").eq("status","approved");m&&console.warn("Developer payout error",m);const f=(h==null?void 0:h.reduce((_,k)=>_+(Number(k.amount)||0),0))||0;w({deliveredOrders:b,totalDeveloperCommission:p,paidDeveloperCommission:f,pendingDeveloper:Math.max(0,p-f)})},re=async()=>{const{data:a,error:x}=await j.from("user_roles").select("user_id").eq("role","delivery");if(x||!a)return;const b=a.map(m=>m.user_id),{data:p}=await j.from("profiles").select("id, full_name, phone").in("id",b);if(!p)return;const h=[];for(const m of p)try{const{data:f}=await j.from("delivery_assignments").select("order_id, orders!inner(status)").eq("delivery_person_id",m.id).eq("orders.status","delivered"),_=(f==null?void 0:f.length)||0,k=_*5,{data:S,error:U}=await j.from("payouts").select("amount").eq("payee_id",m.id).eq("type","delivery_commission").eq("status","approved");U&&console.warn("Payout fetch error",U);const z=(S==null?void 0:S.reduce((oe,ie)=>oe+(Number(ie.amount)||0),0))||0,ne=Math.max(0,k-z);h.push({id:m.id,full_name:m.full_name||"Delivery Partner",phone:m.phone||"",deliveredOrders:_,totalCommission:k,paidCommission:z,pendingAmount:ne})}catch(f){A.error(`Failed to calc stats for ${m.id}`,{error:f})}c(h)},L=(a,x,b,p,h)=>{if(p<=0){T.success("No pending payment!");return}const m=a===null?Ee:`${b}@upi`;v({open:!0,upiId:m,payeeName:x,amount:p,payeeId:a,type:h})},te=async()=>{if(!E){D(!0);try{const{error:a}=await j.from("payouts").insert({payer_id:s==null?void 0:s.id,payee_id:o.payeeId,amount:o.amount,status:"pending",type:o.type});if(a)throw a;T.success("Payment recorded! Waiting for approval."),v(x=>({...x,open:!1})),y()}catch(a){T.error("Failed to record payment"),A.error("Payment insert error",{error:a})}finally{D(!1)}}};return u||r===null||l?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(V,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2].map(a=>e.jsx(V,{className:"h-48 rounded-xl"},a))}),e.jsx(B,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>n("/admin"),className:"shrink-0",children:e.jsx(ge,{className:"h-5 w-5"})}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(ye,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"Daily Payouts"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ve(new Date,"MMM dd, yyyy")})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[C&&e.jsx($,{className:"border-red-500/50 bg-red-500/5",children:e.jsxs(R,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-sm text-red-600",children:C})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:y,children:"Retry"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider pl-1",children:"Platform Fees"}),e.jsxs($,{className:"border-indigo-500/20 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-indigo-500 to-purple-600"}),e.jsxs(R,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-500/10 rounded-lg",children:e.jsx(je,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Developer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Commission (₹4/order)"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-indigo-600",children:["₹",t.pendingDeveloper.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-semibold",children:"Pending"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm bg-muted/40 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Earned"}),e.jsxs("p",{className:"font-semibold",children:["₹",t.totalDeveloperCommission]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Paid"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["₹",t.paidDeveloperCommission]})]})]}),e.jsxs(N,{className:"w-full bg-indigo-600 hover:bg-indigo-700",size:"lg",disabled:t.pendingDeveloper<=0,onClick:()=>L(null,"Developer",se,t.pendingDeveloper,"developer_commission"),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Pay Remainder"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pl-1",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Delivery Partners"}),e.jsxs("span",{className:"text-xs bg-muted px-2 py-1 rounded-full",children:[d.length," Active"]})]}),d.map(a=>e.jsxs($,{className:"border-rose-500/20 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-rose-400 to-orange-500"}),e.jsxs(R,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-rose-500/10 rounded-lg",children:e.jsx(Ne,{className:"h-5 w-5 text-rose-600"})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("h3",{className:"font-bold text-lg truncate w-32 md:w-auto",children:a.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.phone})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-rose-600",children:["₹",a.pendingAmount.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-semibold",children:"Due Today"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm bg-muted/40 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Orders"}),e.jsx("p",{className:"font-semibold",children:a.deliveredOrders})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Paid So Far"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["₹",a.paidCommission]})]})]}),e.jsxs(N,{className:"w-full bg-rose-600 hover:bg-rose-700",size:"lg",disabled:a.pendingAmount<=0,onClick:()=>L(a.id,a.full_name,a.phone,a.pendingAmount,"delivery_commission"),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Pay Partner"]})]})]},a.id)),d.length===0&&e.jsxs("div",{className:"text-center py-8 bg-muted/20 rounded-xl",children:[e.jsx(W,{className:"h-10 w-10 text-muted-foreground mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No active delivery partners found."})]})]})]}),e.jsx(B,{}),e.jsx(Ie,{open:o.open,onOpenChange:a=>v(x=>({...x,open:a})),upiId:o.upiId,payeeName:o.payeeName,amount:o.amount,onPaymentConfirmed:te})]})};export{Te as default};
