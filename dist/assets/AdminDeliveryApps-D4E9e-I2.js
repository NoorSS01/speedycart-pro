import{u as E,a as S,r as i,s as m,h as n,j as e,S as u,B as x,A as z,T as b,C as N,c as v,U as B,d as L,f as D,ae as F,a9 as M}from"./index-BHemtGSZ.js";import{A as y}from"./AdminBottomNav-CWbu-ece.js";import"./wallet-C8AlteoV.js";function U(){const{user:h,userRole:a,loading:l}=E(),r=S(),[d,w]=i.useState([]),[k,p]=i.useState(!0),[f,t]=i.useState(null);i.useEffect(()=>{if(!l){if(!h){r("/auth");return}if(a!=="admin"&&a!=="super_admin"){r("/shop");return}j()}},[h,a,l,r]);const j=async()=>{p(!0);const{data:s,error:c}=await m.from("delivery_applications").select("*").order("created_at",{ascending:!1});c?n.error("Failed to load applications"):w(s||[]),p(!1)},g=async(s,c,o)=>{t(s);const{error:_}=await m.from("delivery_applications").update({status:o}).eq("id",s);if(_){n.error("Failed to update application"),t(null);return}if(o==="approved"){const{error:C}=await m.from("user_roles").upsert({user_id:c,role:"delivery"},{onConflict:"user_id,role"});if(C){n.error("Failed to assign delivery role"),t(null);return}}n.success(`Application ${o} successfully`),t(null),j()},A=d.filter(s=>s.status==="pending").length;return l||a===null?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(u,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3].map(s=>e.jsx(u,{className:"h-32 rounded-xl"},s))}),e.jsx(y,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>r("/admin"),children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center shadow-lg",children:e.jsx(b,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"Delivery Applications"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[A," pending review"]})]})]})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:k?[1,2,3].map(s=>e.jsx(u,{className:"h-32 rounded-xl"},s)):d.length===0?e.jsx(N,{children:e.jsxs(v,{className:"py-12 text-center",children:[e.jsx(b,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No delivery applications yet"})]})}):d.map(s=>e.jsx(N,{className:s.status==="pending"?"border-amber-200":"",children:e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900/40 dark:to-cyan-900/40 flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.phone})]})]}),e.jsx(L,{variant:s.status==="pending"?"outline":s.status==="approved"?"default":"destructive",className:s.status==="pending"?"border-amber-500 text-amber-600":s.status==="approved"?"bg-emerald-500":"",children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Vehicle"}),e.jsx("p",{className:"font-medium capitalize",children:s.vehicle_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"License"}),e.jsx("p",{className:"font-medium",children:s.license_number||"N/A"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Applied"}),e.jsx("p",{className:"font-medium",children:D(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{className:"flex-1 bg-emerald-500 hover:bg-emerald-600",onClick:()=>g(s.id,s.user_id,"approved"),disabled:f===s.id,children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(x,{variant:"destructive",className:"flex-1",onClick:()=>g(s.id,s.user_id,"rejected"),disabled:f===s.id,children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Reject"]})]})]})},s.id))}),e.jsx(y,{})]})}export{U as default};
