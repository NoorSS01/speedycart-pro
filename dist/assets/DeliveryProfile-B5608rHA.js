import{q as le,u as ie,a as ce,r as i,s as c,l as v,j as e,S as N,B as h,A as de,C as d,c as o,t as oe,v as me,U as B,w as xe,x as ue,y as he,k as U,z as ge,D as pe,L as fe,i as je,E as b,F as y,G as ve,P as Ne,H as C,I as D,J as H,K as be,N as ye,O as we,n as x}from"./index-Cz072s1P.js";import{P as Y}from"./power-DFZJ-THJ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=le("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);function Ce(){var I,z;const{user:a,loading:A,signOut:G}=ie(),p=ce(),[W,q]=i.useState(!0),[P,R]=i.useState(!1),[l,w]=i.useState({phone:"",full_name:"",email:"",username:null}),[m,$]=i.useState({today:0,week:0,month:0,allTime:0,todayDeliveries:0,totalDeliveries:0,avgRating:0}),[J,K]=i.useState(!0),[r,f]=i.useState("none"),[_,T]=i.useState(!1),[L,X]=i.useState([]);i.useEffect(()=>{if(!A){if(!a){p("/auth");return}Q(),M(),E()}},[a,A,p]);const Q=async()=>{if(a){q(!0);try{const{data:s}=await c.from("profiles").select("phone, full_name, username").eq("id",a.id).single();if(s){const n=s;w({phone:n.phone||"",full_name:n.full_name||"",email:a.email||"",username:n.username||null})}const t=new Date,u=new Date(t);u.setHours(0,0,0,0);const k=new Date(t);k.setDate(k.getDate()-7);const S=new Date(t);S.setMonth(S.getMonth()-1);const{data:se}=await c.from("delivery_assignments").select("id, user_confirmed_at").eq("delivery_person_id",a.id).not("user_confirmed_at","is",null),g=se||[],F=g.filter(n=>n.user_confirmed_at&&new Date(n.user_confirmed_at)>=u),te=g.filter(n=>n.user_confirmed_at&&new Date(n.user_confirmed_at)>=k),ae=g.filter(n=>n.user_confirmed_at&&new Date(n.user_confirmed_at)>=S),{data:j}=await c.from("delivery_ratings").select("rating").eq("delivery_person_id",a.id),re=j&&j.length>0?j.reduce((n,ne)=>n+(ne.rating??0),0)/j.length:0;$({today:F.length*5,week:te.length*5,month:ae.length*5,allTime:g.length*5,todayDeliveries:F.length,totalDeliveries:g.length,avgRating:Math.round(re*10)/10})}catch(s){v.error("Error fetching delivery profile data",{error:s})}finally{q(!1)}}},V=async()=>{var s;if(a){R(!0);try{const{error:t}=await c.from("profiles").update({full_name:l.full_name,username:((s=l.username)==null?void 0:s.toLowerCase())||null}).eq("id",a.id);if(t)throw t;x.success("Profile updated!")}catch{x.error("Failed to update profile")}finally{R(!1)}}},Z=async()=>{await G(),p("/auth")},M=async()=>{if(!a)return;const s=new Date().toISOString().split("T")[0];try{const{data:t}=await c.from("delivery_activations").select("status").eq("delivery_partner_id",a.id).eq("activation_date",s).maybeSingle();t&&t.status?f(t.status):f("none")}catch{v.debug("Activation status not available"),f("none")}},ee=async()=>{if(a){T(!0);try{const s=new Date().toISOString().split("T")[0],{error:t}=await c.from("delivery_activations").insert({delivery_partner_id:a.id,activation_date:s,status:"pending"});if((t==null?void 0:t.code)==="23505")x.info("You already requested activation today"),M();else{if(t)throw t;x.success("Activation request sent! Waiting for admin approval."),f("pending")}}catch(s){x.error("Failed to request activation"),v.error("Activation request failed",{error:s})}T(!1)}},E=async()=>{if(a)try{const{data:s}=await c.from("payouts").select("*").eq("payee_id",a.id).eq("type","delivery_commission").order("created_at",{ascending:!1}).limit(10);s&&X(s)}catch(s){v.debug("Payouts fetch failed",{error:s})}},O=async(s,t)=>{try{const{error:u}=await c.from("payouts").update({status:t}).eq("id",s);if(u)throw u;x.success(`Payout ${t}`),E()}catch{x.error("Failed to update payout")}};return W?e.jsxs("div",{className:"min-h-screen bg-background p-4",children:[e.jsx(N,{className:"h-12 w-full mb-4"}),e.jsx(N,{className:"h-32 w-full mb-4 rounded-xl"}),e.jsx(N,{className:"h-48 w-full mb-4 rounded-xl"}),e.jsx(N,{className:"h-64 w-full rounded-xl"})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5 pb-8",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-background/80 backdrop-blur-xl border-b",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>p("/delivery"),children:e.jsx(de,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"My Account"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(oe,{className:"w-16 h-16 border-2 border-primary",children:e.jsx(me,{className:"bg-primary/10 text-primary text-xl",children:((z=(I=l.full_name)==null?void 0:I[0])==null?void 0:z.toUpperCase())||e.jsx(B,{className:"w-6 h-6"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-bold",children:l.full_name||"Delivery Partner"}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"})," ",l.phone||"No phone"]}),l.email&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"})," ",l.email]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-amber-500",children:[e.jsx(he,{className:"w-5 h-5 fill-current"}),e.jsx("span",{className:"text-lg font-bold",children:m.avgRating||"—"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rating"})]})]})})}),e.jsx(d,{className:r==="approved"?"border-green-500 bg-green-500/5":r==="pending"?"border-amber-500 bg-amber-500/5":"",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${r==="approved"?"bg-green-500":r==="pending"?"bg-amber-500":r==="rejected"?"bg-red-500":"bg-muted"}`,children:r==="approved"?e.jsx(U,{className:"w-6 h-6 text-white"}):r==="pending"?e.jsx(ge,{className:"w-6 h-6 text-white"}):r==="rejected"?e.jsx(pe,{className:"w-6 h-6 text-white"}):e.jsx(Y,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:r==="approved"?"Active Today":r==="pending"?"Awaiting Approval":r==="rejected"?"Request Rejected":"Not Active"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r==="approved"?"You can receive orders":r==="pending"?"Admin will review shortly":r==="rejected"?"Contact admin for details":"Request to go active for today"})]})]}),r==="none"&&e.jsxs(h,{onClick:ee,disabled:_,children:[_?e.jsx(fe,{className:"w-4 h-4 animate-spin"}):e.jsx(Y,{className:"w-4 h-4 mr-2"}),_?"Requesting...":"Go Active"]})]})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Recent Payouts"}),e.jsx("div",{className:"space-y-3",children:L.length===0?e.jsx(d,{children:e.jsx(o,{className:"p-4 text-center text-muted-foreground",children:"No payment history"})}):L.map(s=>e.jsx(d,{className:"overflow-hidden",children:e.jsxs(o,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg",children:["₹",s.amount]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx(je,{variant:s.status==="approved"?"default":s.status==="pending"?"outline":"destructive",children:s.status})]}),s.status==="pending"&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(h,{size:"sm",variant:"outline",className:"w-full border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700",onClick:()=>O(s.id,"rejected"),children:"Reject"}),e.jsx(h,{size:"sm",className:"w-full bg-green-600 hover:bg-green-700",onClick:()=>O(s.id,"approved"),children:"Confirm Receipt"})]})]})},s.id))})]}),e.jsxs(d,{className:"bg-primary/5 border-primary/20",children:[e.jsx(b,{className:"pb-2",children:e.jsxs(y,{className:"text-sm flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Earnings Overview"]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",m.today]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",m.week]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This Week"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",m.month]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This Month"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",m.allTime]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All Time"})]})]})})]}),e.jsxs(d,{children:[e.jsx(b,{className:"pb-2",children:e.jsxs(y,{className:"text-sm flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Delivery Statistics"]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg",children:[e.jsx(Ne,{className:"w-8 h-8 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold",children:m.todayDeliveries}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(U,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold",children:m.totalDeliveries}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]})]})]})})]}),e.jsxs(d,{children:[e.jsx(b,{className:"pb-2",children:e.jsxs(y,{className:"text-sm flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Edit Profile"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Full Name"}),e.jsx(D,{value:l.full_name||"",onChange:s=>w({...l,full_name:s.target.value}),placeholder:"Your name"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Username"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex items-center justify-center px-3 bg-muted border border-r-0 rounded-l-md text-sm font-medium text-muted-foreground",children:"@"}),e.jsx(D,{value:l.username||"",onChange:s=>w({...l,username:s.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"").slice(0,20)}),placeholder:"your_username",className:"rounded-l-none",maxLength:20})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Letters, numbers, underscores (3-20 chars)"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Phone Number"}),e.jsx(D,{value:l.phone,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Contact support to change phone number"})]}),e.jsx(h,{onClick:V,disabled:P,className:"w-full",children:P?"Saving...":"Save Changes"})]})]}),e.jsxs(d,{children:[e.jsx(b,{className:"pb-2",children:e.jsxs(y,{className:"text-sm flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Settings"]})}),e.jsx(o,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Push Notifications"})]}),e.jsx(be,{checked:J,onCheckedChange:K})]})})]}),e.jsx(ye,{}),e.jsxs(h,{variant:"destructive",className:"w-full",onClick:Z,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})]})}export{Ce as default};
