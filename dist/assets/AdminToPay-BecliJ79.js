import{ab as re,r as c,j as e,ac as G,ad as te,a0 as oe,a1 as ne,a2 as ie,a3 as le,B as P,ae as R,af as F,aa as de,u as ce,a as me,l as $,s as j,S as L,h as ue,C as q,c as z,G as xe,T as pe,n as A}from"./index-DBxYQpjy.js";import{A as V}from"./AdminBottomNav-D-AS2cP3.js";import{W as fe}from"./wallet-DCGyff3k.js";import{C as he}from"./circle-alert-CVKt6kt7.js";var T="Progress",M=100,[ge,Ee]=re(T),[ve,je]=ge(T),X=c.forwardRef((s,r)=>{const{__scopeProgress:m,value:o=null,max:t,getValueLabel:w=Ne,...i}=s;(t||t===0)&&!W(t)&&console.error(ye(`${t}`,"Progress"));const l=W(t)?t:M;o!==null&&!B(o,l)&&console.error(be(`${o}`,"Progress"));const n=B(o,l)?o:null,v=k(n)?w(n,l):void 0;return e.jsx(ve,{scope:m,value:n,max:l,children:e.jsx(G.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":k(n)?n:void 0,"aria-valuetext":v,role:"progressbar","data-state":J(n,l),"data-value":n??void 0,"data-max":l,...i,ref:r})})});X.displayName=T;var H="ProgressIndicator",Y=c.forwardRef((s,r)=>{const{__scopeProgress:m,...o}=s,t=je(H,m);return e.jsx(G.div,{"data-state":J(t.value,t.max),"data-value":t.value??void 0,"data-max":t.max,...o,ref:r})});Y.displayName=H;function Ne(s,r){return`${Math.round(s/r*100)}%`}function J(s,r){return s==null?"indeterminate":s===r?"complete":"loading"}function k(s){return typeof s=="number"}function W(s){return k(s)&&!isNaN(s)&&s>0}function B(s,r){return k(s)&&!isNaN(s)&&s<=r&&s>=0}function ye(s,r){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${M}\`.`}function be(s,r){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${M} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var K=X,we=Y;const Q=c.forwardRef(({className:s,value:r,...m},o)=>e.jsx(K,{ref:o,className:te("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...m,children:e.jsx(we,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));Q.displayName=K.displayName;function Pe({open:s,onOpenChange:r,upiId:m,payeeName:o,amount:t,onPaymentConfirmed:w}){const[i,l]=c.useState("initial"),[n,v]=c.useState(16),[x,N]=c.useState(0);c.useEffect(()=>{s&&(l("initial"),v(16),N(0))},[s]),c.useEffect(()=>{let p;return i==="waiting"&&n>0?p=setInterval(()=>{v(y=>{const D=y-.1;return D<0?0:D}),N(y=>y+100/(16*10))},100):i==="waiting"&&n<=0&&l("confirm"),()=>clearInterval(p)},[i,n]);const C=()=>`upi://pay?pa=${encodeURIComponent(m)}&pn=${encodeURIComponent(o)}&am=${t.toFixed(2)}&cu=INR&tn=${encodeURIComponent("SpeedyCart Payout")}`,E=()=>{const p=C();window.location.href=p,l("waiting")};return e.jsx(oe,{open:s,onOpenChange:p=>{i==="waiting"&&p===!1||r(p)},children:e.jsxs(ne,{className:"sm:max-w-md",children:[e.jsx(ie,{children:e.jsxs(le,{children:["Pay ",o]})}),e.jsxs("div",{className:"py-6 flex flex-col items-center justify-center space-y-6 text-center",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-xl w-full",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Payable"}),e.jsxs("p",{className:"text-4xl font-bold text-primary",children:["₹",t.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 font-mono",children:m})]}),i==="initial"&&e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Click below to open your preferred UPI app. ",e.jsx("br",{}),"Please verify the UPI ID before paying."]}),e.jsxs(P,{size:"lg",className:"w-full text-lg h-12",onClick:E,children:[e.jsx(R,{className:"mr-2 h-5 w-5"})," Pay Now"]})]}),i==="waiting"&&e.jsxs("div",{className:"w-full space-y-4 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"relative w-20 h-20 mx-auto flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-muted rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-t-primary rounded-full animate-spin"}),e.jsxs("span",{className:"font-bold text-xl",children:[Math.ceil(n),"s"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Waiting for Payment..."}),e.jsx("p",{className:"text-sm text-muted-foreground px-4",children:"Complete the payment in your UPI app. Do not verify anything yet. We will ask for confirmation shortly."})]}),e.jsx(Q,{value:Math.min(x,100),className:"h-2 w-full"})]}),i==="confirm"&&e.jsxs("div",{className:"w-full space-y-4 animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(F,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Did you complete the payment?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The amount will be marked as paid and sent for approval."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full",children:[e.jsxs(P,{variant:"outline",size:"lg",onClick:()=>r(!1),children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," No, I didn't"]}),e.jsxs(P,{size:"lg",className:"bg-green-600 hover:bg-green-700",onClick:w,children:[e.jsx(F,{className:"mr-2 h-4 w-4"})," Yes, I Paid"]})]})]})]})]})})}const Z="8310807978",Ce=`${Z}@ybl`,Se=()=>{const{user:s,userRole:r,loading:m}=ce(),o=me(),[t,w]=c.useState({deliveredOrders:0,totalDeveloperCommission:0,paidDeveloperCommission:0,pendingDeveloper:0}),[i,l]=c.useState([]),[n,v]=c.useState(!0),[x,N]=c.useState({open:!1,upiId:"",payeeName:"",amount:0,payeeId:null,type:"developer_commission"});c.useEffect(()=>{if(!m){if(!s){o("/auth");return}if(r!=="admin"&&r!=="super_admin"){o("/shop");return}C()}},[s,r,m,o]);const C=async()=>{v(!0);try{await Promise.all([E(),p()])}catch(a){$.error("Failed to load payment data",{error:a})}finally{v(!1)}},E=async()=>{const{data:a,error:u}=await j.from("orders").select("id").eq("status","delivered");if(u)throw u;const b=(a==null?void 0:a.length)||0,f=b*4,{data:h,error:d}=await j.from("payouts").select("amount").eq("type","developer_commission").neq("status","rejected");d&&console.warn("Developer payout error",d);const g=(h==null?void 0:h.reduce((_,I)=>_+(Number(I.amount)||0),0))||0;w({deliveredOrders:b,totalDeveloperCommission:f,paidDeveloperCommission:g,pendingDeveloper:Math.max(0,f-g)})},p=async()=>{const{data:a,error:u}=await j.from("user_roles").select("user_id").eq("role","delivery");if(u||!a)return;const b=a.map(d=>d.user_id),{data:f}=await j.from("profiles").select("id, full_name, phone").in("id",b);if(!f)return;const h=[];for(const d of f)try{const{data:g}=await j.from("delivery_assignments").select("order_id, orders!inner(status)").eq("delivery_person_id",d.id).eq("orders.status","delivered"),_=(g==null?void 0:g.length)||0,I=_*5,{data:S,error:O}=await j.from("payouts").select("amount").eq("payee_id",d.id).eq("type","delivery_commission").neq("status","rejected");O&&console.warn("Payout fetch error",O);const U=(S==null?void 0:S.reduce((se,ae)=>se+(Number(ae.amount)||0),0))||0,ee=Math.max(0,I-U);h.push({id:d.id,full_name:d.full_name||"Delivery Partner",phone:d.phone||"",deliveredOrders:_,totalCommission:I,paidCommission:U,pendingAmount:ee})}catch(g){$.error(`Failed to calc stats for ${d.id}`,{error:g})}l(h)},y=(a,u,b,f,h)=>{if(f<=0){A.success("No pending payment!");return}const d=a===null?Ce:`${b}@upi`;N({open:!0,upiId:d,payeeName:u,amount:f,payeeId:a,type:h})},D=async()=>{try{const{error:a}=await j.from("payouts").insert({payer_id:s==null?void 0:s.id,payee_id:x.payeeId,amount:x.amount,status:"pending",type:x.type});if(a)throw a;A.success("Payment recorded! Waiting for approval."),N(u=>({...u,open:!1})),C()}catch(a){A.error("Failed to record payment"),$.error("Payment insert error",{error:a})}};return m||r===null||n?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(L,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2].map(a=>e.jsx(L,{className:"h-48 rounded-xl"},a))}),e.jsx(V,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(fe,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"Daily Payouts"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ue(new Date,"MMM dd, yyyy")})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider pl-1",children:"Platform Fees"}),e.jsxs(q,{className:"border-indigo-500/20 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-indigo-500 to-purple-600"}),e.jsxs(z,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-500/10 rounded-lg",children:e.jsx(xe,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Developer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Commission (₹4/order)"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-indigo-600",children:["₹",t.pendingDeveloper.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-semibold",children:"Pending"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm bg-muted/40 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Earned"}),e.jsxs("p",{className:"font-semibold",children:["₹",t.totalDeveloperCommission]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Paid"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["₹",t.paidDeveloperCommission]})]})]}),e.jsxs(P,{className:"w-full bg-indigo-600 hover:bg-indigo-700",size:"lg",disabled:t.pendingDeveloper<=0,onClick:()=>y(null,"Developer",Z,t.pendingDeveloper,"developer_commission"),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Pay Remainder"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pl-1",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Delivery Partners"}),e.jsxs("span",{className:"text-xs bg-muted px-2 py-1 rounded-full",children:[i.length," Active"]})]}),i.map(a=>e.jsxs(q,{className:"border-rose-500/20 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-rose-400 to-orange-500"}),e.jsxs(z,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-rose-500/10 rounded-lg",children:e.jsx(pe,{className:"h-5 w-5 text-rose-600"})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("h3",{className:"font-bold text-lg truncate w-32 md:w-auto",children:a.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.phone})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-rose-600",children:["₹",a.pendingAmount.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-semibold",children:"Due Today"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm bg-muted/40 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Orders"}),e.jsx("p",{className:"font-semibold",children:a.deliveredOrders})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Paid So Far"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["₹",a.paidCommission]})]})]}),e.jsxs(P,{className:"w-full bg-rose-600 hover:bg-rose-700",size:"lg",disabled:a.pendingAmount<=0,onClick:()=>y(a.id,a.full_name,a.phone,a.pendingAmount,"delivery_commission"),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Pay Partner"]})]})]},a.id)),i.length===0&&e.jsxs("div",{className:"text-center py-8 bg-muted/20 rounded-xl",children:[e.jsx(he,{className:"h-10 w-10 text-muted-foreground mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No active delivery partners found."})]})]})]}),e.jsx(V,{}),e.jsx(Pe,{open:x.open,onOpenChange:a=>N(u=>({...u,open:a})),upiId:x.upiId,payeeName:x.payeeName,amount:x.amount,onPaymentConfirmed:D})]})};export{Se as default};
