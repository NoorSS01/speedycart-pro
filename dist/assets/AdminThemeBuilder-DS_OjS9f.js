import{m as O,u as se,aq as ae,a as te,r as m,s as h,l as q,h as n,j as e,S as b,B as x,A as re,d as C,ar as le,C as k,x as R,y as E,ag as M,c as V,$ as ie,D as l,I as c,af as ne,V as ce,ap as oe,an as de,as as me,ao as xe,at as ue,a5 as he,a6 as ge,a7 as pe,a8 as ve,a9 as S,a0 as je,a1 as fe,a2 as be,a3 as Ne,ak as ye,a4 as _e,au as we}from"./index-BuXiU4Mk.js";import{T as Ce,a as ke,b as v,c as j}from"./tabs-BPyi7w3T.js";import{A as Se}from"./AdminBottomNav-iLRXUCf9.js";import{P as H}from"./palette-BLvWaJDF.js";import{F as Te}from"./flower-2-CYF09bWT.js";import"./wallet-D60exwU1.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=O("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=O("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),Ae=[{value:"none",label:"None",icon:$,description:"No animation effects"},{value:"snowfall",label:"Snowfall",icon:oe,description:"Gentle falling snow"},{value:"rain",label:"Rain",icon:de,description:"Soft rain streaks"},{value:"petals",label:"Petals",icon:Te,description:"Floating cherry blossoms"},{value:"leaves",label:"Leaves",icon:me,description:"Falling autumn leaves"},{value:"sparkles",label:"Sparkles",icon:xe,description:"Twinkling stars"},{value:"confetti",label:"Confetti",icon:ue,description:"Celebration confetti"}];function Re(){const{user:T,userRole:D,loading:A}=se(),{refreshTheme:N,exitPreviewMode:G,isPreviewMode:U}=ae(),y=te(),[W,Y]=m.useState([]),[t,P]=m.useState(null),[J,F]=m.useState(!0),[u,o]=m.useState(!1),[K,f]=m.useState(!1),[a,z]=m.useState({}),[_,w]=m.useState(!1),B=D==="admin"||D==="super_admin";m.useEffect(()=>{if(!A){if(!T||!B){y("/");return}g()}},[T,A,B,y]);const g=async()=>{try{F(!0);const{data:s,error:r}=await h.from("themes").select("*").order("is_active",{ascending:!1}).order("updated_at",{ascending:!1});if(r)throw r;const d=(s||[]).map(I=>({...I,is_active:I.is_active??!1}));Y(d),d.length>0&&!t&&L(d[0])}catch(s){q.error("Failed to fetch themes",{error:s}),n.error("Failed to load themes")}finally{F(!1)}},L=s=>{_&&!confirm("You have unsaved changes. Discard them?")||(P(s),z({...s}),w(!1),U&&G())},i=(s,r)=>{z(d=>({...d,[s]:r})),w(!0)},Q=async()=>{if(!(!t||!a))try{o(!0);const s={name:a.name,description:a.description,primary_color:a.primary_color,secondary_color:a.secondary_color,accent_color:a.accent_color,background_gradient:a.background_gradient,animation_type:a.animation_type,animation_intensity:a.animation_intensity,promo_badge_text:a.promo_badge_text,promo_badge_color:a.promo_badge_color,updated_at:new Date().toISOString(),version:(t.version||0)+1},{error:r}=await h.from("themes").update(s).eq("id",t.id);if(r)throw r;n.success("Theme saved successfully"),w(!1),await g(),t.is_active&&await N()}catch(s){q.error("Failed to save theme",{error:s}),n.error("Failed to save theme")}finally{o(!1)}},X=async s=>{try{o(!0),await h.from("themes").update({is_active:!1}).neq("id",s);const{error:r}=await h.from("themes").update({is_active:!0}).eq("id",s);if(r)throw r;n.success("Theme activated!"),await g(),await N()}catch{n.error("Failed to activate theme")}finally{o(!1)}},Z=async s=>{try{o(!0);const{error:r}=await h.from("themes").update({is_active:!1}).eq("id",s);if(r)throw r;n.success("Theme deactivated"),await g(),await N()}catch{n.error("Failed to deactivate theme")}finally{o(!1)}},ee=async()=>{if(t)try{o(!0);const{error:s}=await h.from("themes").delete().eq("id",t.id);if(s)throw s;n.success("Theme deleted"),f(!1),P(null),await g()}catch{n.error("Failed to delete theme")}finally{o(!1)}},p=(()=>{if(!a.primary_color)return null;const s=we(a.primary_color,"0 0% 100%"),r=s>=4.5;return{ratio:s.toFixed(2),passes:r}})();return J?e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-3",children:[e.jsx(b,{className:"h-8 w-8"}),e.jsx(b,{className:"h-6 w-48"})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(b,{className:"h-96"}),e.jsx(b,{className:"h-96 lg:col-span-2"})]})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>y("/admin"),children:e.jsx(re,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Theme Builder"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enterprise visual customization"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_&&e.jsx(C,{variant:"outline",className:"text-amber-600 border-amber-600",children:"Unsaved Changes"}),t&&e.jsxs(x,{onClick:Q,disabled:!_||u,size:"sm",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),u?"Saving...":"Save"]})]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(k,{children:[e.jsxs(R,{className:"pb-3",children:[e.jsx(E,{className:"text-sm",children:"Themes"}),e.jsx(M,{className:"text-xs",children:"Select a theme to edit"})]}),e.jsx(V,{className:"space-y-2",children:W.map(s=>e.jsxs("div",{onClick:()=>L(s),className:`
                      p-3 rounded-lg cursor-pointer transition-all
                      ${(t==null?void 0:t.id)===s.id?"bg-primary/10 border-2 border-primary":"bg-muted/50 hover:bg-muted border-2 border-transparent"}
                    `,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm",style:{backgroundColor:s.primary_color||void 0}}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]}),s.is_active&&e.jsx(C,{variant:"default",className:"text-[10px] h-5",children:"Active"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-1",children:[s.type," â€¢ ",s.animation_type||"no animation"]})]},s.id))})]})}),e.jsx("div",{className:"lg:col-span-3",children:t?e.jsxs(k,{children:[e.jsx(R,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(E,{children:a.name||"Untitled Theme"}),e.jsxs(M,{className:"text-xs mt-1",children:[t.type," theme â€¢ v",t.version||1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.is_active?e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>Z(t.id),disabled:u,children:[e.jsx($,{className:"h-4 w-4 mr-1"}),"Deactivate"]}):e.jsxs(x,{variant:"default",size:"sm",onClick:()=>X(t.id),disabled:u,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Activate"]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>f(!0),className:"text-destructive hover:text-destructive",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})}),e.jsx(V,{children:e.jsxs(Ce,{defaultValue:"colors",className:"w-full",children:[e.jsxs(ke,{className:"grid w-full grid-cols-5 mb-6",children:[e.jsx(v,{value:"colors",children:"Colors"}),e.jsx(v,{value:"effects",children:"Effects"}),e.jsx(v,{value:"promo",children:"Promo"}),e.jsx(v,{value:"schedule",children:"Schedule"}),e.jsx(v,{value:"audit",children:"Audit"})]}),e.jsxs(j,{value:"colors",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Theme Name"}),e.jsx(c,{value:a.name||"",onChange:s=>i("name",s.target.value),placeholder:"My Awesome Theme"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm mb-2 block",children:"Primary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:a.primary_color||"#3b82f6",onChange:s=>i("primary_color",s.target.value),className:"h-10 w-14 rounded cursor-pointer"}),e.jsx(c,{value:a.primary_color||"",onChange:s=>i("primary_color",s.target.value),className:"uppercase"})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm mb-2 block",children:"Secondary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:a.secondary_color||"#1e40af",onChange:s=>i("secondary_color",s.target.value),className:"h-10 w-14 rounded cursor-pointer"}),e.jsx(c,{value:a.secondary_color||"",onChange:s=>i("secondary_color",s.target.value),className:"uppercase"})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm mb-2 block",children:"Accent Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:a.accent_color||"#60a5fa",onChange:s=>i("accent_color",s.target.value),className:"h-10 w-14 rounded cursor-pointer"}),e.jsx(c,{value:a.accent_color||"",onChange:s=>i("accent_color",s.target.value),className:"uppercase"})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border",children:[e.jsx(l,{className:"text-sm mb-3 block",children:"Color Preview"}),e.jsxs("div",{className:"flex gap-2 h-16 rounded-lg overflow-hidden shadow-inner",children:[e.jsx("div",{className:"flex-1",style:{backgroundColor:a.primary_color||"#ccc"}}),e.jsx("div",{className:"flex-1",style:{backgroundColor:a.secondary_color||"#aaa"}}),e.jsx("div",{className:"flex-1",style:{backgroundColor:a.accent_color||"#888"}})]})]}),p&&e.jsxs("div",{className:`p-3 rounded-lg ${p.passes?"bg-green-500/10":"bg-amber-500/10"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p.passes?e.jsx(ne,{className:"h-4 w-4 text-green-600"}):e.jsx(ce,{className:"h-4 w-4 text-amber-600"}),e.jsxs("span",{className:"text-sm font-medium",children:["Contrast Ratio: ",p.ratio,":1"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:p.passes?"Passes WCAG AA accessibility standards":"May not meet accessibility requirements (4.5:1 needed)"})]})]}),e.jsxs(j,{value:"effects",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Atmosphere Animation"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Ae.map(s=>{const r=s.icon,d=a.animation_type===s.value;return e.jsxs("div",{onClick:()=>i("animation_type",s.value),className:`
                                  p-3 rounded-lg cursor-pointer transition-all text-center
                                  ${d?"bg-primary/10 border-2 border-primary":"bg-muted/50 hover:bg-muted border-2 border-transparent"}
                                `,children:[e.jsx(r,{className:`h-6 w-6 mx-auto mb-2 ${d?"text-primary":"text-muted-foreground"}`}),e.jsx("p",{className:"text-sm font-medium",children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]},s.value)})})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Animation Intensity"}),e.jsxs(he,{value:a.animation_intensity||"medium",onValueChange:s=>i("animation_intensity",s),children:[e.jsx(ge,{children:e.jsx(pe,{})}),e.jsxs(ve,{children:[e.jsx(S,{value:"low",children:"Low - Subtle, fewer particles"}),e.jsx(S,{value:"medium",children:"Medium - Balanced"}),e.jsx(S,{value:"high",children:"High - Rich atmosphere"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Background Gradient (optional)"}),e.jsx(c,{value:a.background_gradient||"",onChange:s=>i("background_gradient",s.target.value||null),placeholder:"linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%)"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"CSS gradient for background effect"})]})]}),e.jsx(j,{value:"promo",className:"space-y-6",children:e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Promotional Badge"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-1 block",children:"Badge Text"}),e.jsx(c,{value:a.promo_badge_text||"",onChange:s=>i("promo_badge_text",s.target.value||null),placeholder:"ðŸŽ‰ Sale"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-1 block",children:"Badge Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:a.promo_badge_color||"#ef4444",onChange:s=>i("promo_badge_color",s.target.value),className:"h-10 w-14 rounded cursor-pointer"}),e.jsx(c,{value:a.promo_badge_color||"",onChange:s=>i("promo_badge_color",s.target.value),className:"uppercase"})]})]})]}),a.promo_badge_text&&e.jsxs("div",{className:"mt-4 p-4 bg-muted/50 rounded-lg",children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-2 block",children:"Preview"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium text-white",style:{backgroundColor:a.promo_badge_color||"#ef4444"},children:a.promo_badge_text})]})]})}),e.jsx(j,{value:"schedule",className:"space-y-6",children:e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Scheduled Activation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Set a date range for automatic theme activation. The theme will automatically become active at the start date and deactivate at the end date."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-1 block",children:"Start Date"}),e.jsx(c,{type:"datetime-local",value:a.starts_at||a.schedule_starts_at||"",onChange:s=>i("starts_at",s.target.value||null)})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-1 block",children:"End Date"}),e.jsx(c,{type:"datetime-local",value:a.ends_at||a.schedule_ends_at||"",onChange:s=>i("ends_at",s.target.value||null)})]})]}),(a.starts_at||a.schedule_starts_at)&&e.jsx("div",{className:"mt-4 p-3 bg-blue-500/10 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-600",children:"ðŸ“… This theme is scheduled to activate automatically."})})]})}),e.jsx(j,{value:"audit",className:"space-y-6",children:e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Theme History"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Version ",(t==null?void 0:t.version)||1]}),e.jsx(C,{variant:"outline",children:"Current"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Last updated: ",t!=null&&t.updated_at?new Date(t.updated_at).toLocaleDateString():"Unknown"]})]}),((t==null?void 0:t.version)??0)>1&&e.jsxs("div",{className:"p-3 border rounded-lg opacity-60",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm",children:["Version ",((t==null?void 0:t.version)??1)-1]}),e.jsx(x,{variant:"ghost",size:"sm",disabled:!0,children:"Rollback"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Previous version"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Full audit log with rollback capabilities requires database migration. Current implementation tracks version numbers only."})]})})]})})]}):e.jsx(k,{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(H,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Select a theme to start editing"})]})})})]})}),e.jsx(je,{open:K,onOpenChange:f,children:e.jsxs(fe,{children:[e.jsxs(be,{children:[e.jsx(Ne,{children:"Delete Theme?"}),e.jsxs(ye,{children:['This action cannot be undone. The theme "',t==null?void 0:t.name,'" will be permanently deleted.']})]}),e.jsxs(_e,{children:[e.jsx(x,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(x,{variant:"destructive",onClick:ee,disabled:u,children:u?"Deleting...":"Delete Theme"})]})]})}),e.jsx(Se,{})]})}export{Re as default};
