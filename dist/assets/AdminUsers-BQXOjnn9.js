import{u as H,b as V,r,s as p,y as t,j as e,f as g,B as n,A as G,ay as K,k as U,K as A,N as C,m as R,I as Z,aB as $,aC as J,aD as Q,aE as W,aF as j,am as X,q as Y,U as ee,al as se,aA as ae}from"./index-CzqGsn4l.js";import{A as I}from"./AdminBottomNav-Cj834JeN.js";import{U as re}from"./user-plus-D2iYIVQ8.js";import{T as te}from"./trash-2-Gw59I6Fz.js";import"./sheet-u2JDy9wS.js";import"./wallet-VifLp9f-.js";function ue(){const{user:f,userRole:a,loading:m}=H(),d=V(),[l,D]=r.useState([]),[x,b]=r.useState(!0),[h,N]=r.useState(""),[v,M]=r.useState("user"),[z,y]=r.useState(!1),[i,w]=r.useState(0),[E,P]=r.useState(!0),_=50,c=r.useCallback(async()=>{b(!0);const s=i*_,o=s+_-1,{data:L,error:O,count:k}=await p.from("user_roles").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(s,o);if(O)t.error("Failed to load user roles");else{const q=(L||[]).map(u=>({id:u.id,user_id:u.user_id,role:u.role,created_at:u.created_at||new Date().toISOString()}));D(q),k!==null&&P(o<k-1)}b(!1)},[i]);r.useEffect(()=>{if(!m){if(!f){d("/auth");return}if(a!=="admin"&&a!=="super_admin"){d("/shop");return}c()}},[f,a,m,d,c]);const B=async()=>{if(a!=="super_admin"){t.error("Only Super Admins can add roles");return}if(!h.trim()){t.error("Please enter a user ID");return}y(!0);const{error:s}=await p.from("user_roles").insert({user_id:h.trim(),role:v});s?s.code==="23505"?t.error("User already has this role"):t.error("Failed to add role: "+s.message):(t.success("Role added successfully"),N(""),c()),y(!1)},F=async s=>{if(a!=="super_admin"){t.error("Only Super Admins can remove roles");return}const{error:o}=await p.from("user_roles").delete().eq("id",s);o?t.error("Failed to delete role"):(t.success("Role removed"),c())},T=s=>{switch(s){case"admin":case"super_admin":return e.jsx(ae,{className:"w-4 h-4"});case"delivery":return e.jsx(se,{className:"w-4 h-4"});default:return e.jsx(ee,{className:"w-4 h-4"})}},S=s=>{switch(s){case"super_admin":return"bg-purple-500";case"admin":return"bg-blue-500";case"delivery":return"bg-emerald-500";default:return"bg-gray-500"}};return l.length,l.filter(s=>s.role==="admin"||s.role==="super_admin").length,l.filter(s=>s.role==="delivery").length,l.filter(s=>s.role==="user").length,m||a===null?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(g,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3].map(s=>e.jsx(g,{className:"h-20 rounded-xl"},s))}),e.jsx(I,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>d("/admin"),children:e.jsx(G,{className:"h-5 w-5"})}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center shadow-lg",children:e.jsx(K,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a==="super_admin"?"Super Admin Mode":"Read-Only Mode"})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[a==="super_admin"&&e.jsxs(U,{children:[e.jsx(A,{className:"pb-2",children:e.jsxs(C,{className:"text-base flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Add Role"]})}),e.jsxs(R,{className:"space-y-3",children:[e.jsx(Z,{placeholder:"User ID (UUID)",value:h,onChange:s=>N(s.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{value:v,onValueChange:s=>M(s),children:[e.jsx(J,{className:"flex-1",children:e.jsx(Q,{})}),e.jsxs(W,{children:[e.jsx(j,{value:"user",children:"User"}),e.jsx(j,{value:"admin",children:"Admin"}),e.jsx(j,{value:"delivery",children:"Delivery"})]})]}),e.jsx(n,{onClick:B,disabled:z,children:"Add"})]})]})]}),e.jsxs(U,{children:[e.jsxs(A,{className:"pb-2 flex flex-row items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"User List"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Page ",i+1]})]}),e.jsx(R,{className:"space-y-2",children:x?[1,2,3].map(s=>e.jsx(g,{className:"h-14 rounded-lg"},s)):l.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No roles found"}):e.jsxs(e.Fragment,{children:[l.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${S(s.role)} bg-opacity-20`,children:T(s.role)}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-mono",children:[s.user_id.slice(0,8),"..."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:X(new Date(s.created_at),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:S(s.role),children:s.role}),a==="super_admin"&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>F(s.id),children:e.jsx(te,{className:"w-4 h-4"})})]})]},s.id)),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>w(s=>Math.max(0,s-1)),disabled:i===0||x,children:"Previous"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>w(s=>s+1),disabled:!E||x,children:"Next"})]})]})})]})]}),e.jsx(I,{})]})}export{ue as default};
