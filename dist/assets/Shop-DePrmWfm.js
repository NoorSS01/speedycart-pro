import{c as ke,r as a,j as e,B as I,C as z,s as w,l as T,u as Ce,a as G,b as Q,P as Y,Z as Ge,S as Ze,d as Xe,e as ae,f as Je,g as Ke,h as O,i as ge,U as et,k as je,m as ve,M as ye,n as re,o as be,E as tt,p as Ne,q as st,D as at,t as rt,v as nt,w as lt,L,I as we,x as it,F as ot,y as B}from"./index-UMlJGGnY.js";import{S as ct,a as dt,b as ut,c as mt,d as ht}from"./sheet-C2Qfebkd.js";import{H as ne,S as xt}from"./HorizontalScrollContainer-D5KZnxTg.js";import{O as ft,R as pt,a as _e}from"./OrderConfirmation-vHSoUW__.js";import{C as Se}from"./chevron-left-C90EL12Y.js";import{u as gt}from"./useRecommendations-CjsVBZ_s.js";import{P as jt}from"./party-popper-RR4y9G1s.js";import{S as qe}from"./sparkles-43-mRpCR.js";import{T as vt}from"./trash-2-CHpZwTCE.js";import"./index-BJvd_s8C.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=ke("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=ke("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);function Nt(){const[n,c]=a.useState([]),[_,m]=a.useState(0),y=async()=>{try{const{data:d,error:v}=await w.from("promotional_banners").select("*").eq("is_active",!0).order("display_order",{ascending:!0});d&&!v&&c(d)}catch(d){T.debug("Promotional banners not available",{error:d})}},x=a.useCallback(()=>{m(d=>(d+1)%Math.max(n.length,1))},[n.length]),P=a.useCallback(()=>{m(d=>(d-1+n.length)%Math.max(n.length,1))},[n.length]);return a.useEffect(()=>{y()},[]),a.useEffect(()=>{if(n.length<=1)return;const d=setInterval(x,5e3);return()=>clearInterval(d)},[n.length,x]),n.length===0?null:e.jsxs("div",{className:"relative overflow-hidden rounded-xl mx-4 my-4",children:[e.jsx("div",{className:"flex transition-transform duration-500 ease-in-out",style:{transform:`translateX(-${_*100}%)`},children:n.map(d=>e.jsx("div",{className:"min-w-full px-1",children:e.jsxs("div",{className:"rounded-xl p-4 min-h-[80px] flex flex-col justify-center",style:{backgroundColor:d.background_color,color:d.text_color},children:[e.jsx("h3",{className:"font-bold text-lg",children:d.title}),d.subtitle&&e.jsx("p",{className:"text-sm opacity-90",children:d.subtitle})]})},d.id))}),n.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 h-8 w-8 rounded-full bg-white/80 hover:bg-white",onClick:P,children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 rounded-full bg-white/80 hover:bg-white",onClick:x,children:e.jsx(z,{className:"h-4 w-4"})})]}),n.length>1&&e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5",children:n.map((d,v)=>e.jsx("button",{className:`w-2 h-2 rounded-full transition-all ${v===_?"bg-white w-4":"bg-white/50"}`,onClick:()=>m(v)},v))})]})}function wt({onAddToCart:n}){const{user:c}=Ce(),{getItemQuantity:_,updateQuantity:m}=G(),y=Q(),[x,P]=a.useState([]),[d,v]=a.useState(!0),$=a.useCallback(async()=>{if(c){try{const{data:b}=await w.from("orders").select("id").eq("user_id",c.id).order("created_at",{ascending:!1}).limit(10);if(!b||b.length===0){v(!1);return}const A=b.map(h=>h.id),{data:s}=await w.from("order_items").select("product_id").in("order_id",A);if(!s||s.length===0){v(!1);return}const p=[...new Set(s.map(h=>h.product_id))],{data:r}=await w.from("products").select(`
                    id, name, price, mrp, image_url, unit, discount_percent,
                    product_variants!left(id, variant_name, variant_value, variant_unit, price, mrp, is_default)
                `).in("id",p.slice(0,10)).eq("is_active",!0);if(r){const h=r.map(j=>{const k=j.product_variants||[],o=k.find(S=>S.is_default)||k[0]||null;return{...j,default_variant:o}});P(h)}}catch(b){T.error("BuyAgain fetch error",{error:b})}v(!1)}},[c]);return a.useEffect(()=>{c?$():v(!1)},[c,$]),d||!c||x.length===0?null:e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 mb-3",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(bt,{className:"h-5 w-5 text-red-500 fill-red-500"}),"Buy Again"]}),e.jsxs("button",{onClick:()=>y("/orders"),className:"text-primary text-sm font-medium flex items-center gap-1 hover:underline",children:["View Orders ",e.jsx(z,{className:"h-4 w-4"})]})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto px-4 pb-2 scrollbar-hide",style:{scrollbarWidth:"none"},children:x.map(b=>e.jsx("div",{className:"flex-shrink-0 w-[150px]",children:e.jsx(Y,{product:b,onAddToCart:n,cartQuantity:_(b.id,null),onQuantityChange:(A,s)=>m(A,null,s)})},b.id))})]})}function _t({categories:n,onCategorySelect:c}){const _=Q();return n.length===0?null:e.jsxs("div",{className:"py-4 px-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-3",children:"Shop by Category"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 gap-4",children:n.map(m=>e.jsxs("button",{className:"flex flex-col items-center gap-2 group",onClick:()=>{c(m.id),_(`/shop?category=${m.id}`)},children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full overflow-hidden bg-gradient-to-br from-primary/10 to-primary/5 border-2 border-transparent group-hover:border-primary transition-all shadow-sm group-hover:shadow-md",children:m.image_url?e.jsx("img",{src:m.image_url,alt:m.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/10",children:e.jsx("span",{className:"text-2xl",children:"ðŸ›’"})})}),e.jsx("span",{className:"text-xs text-center font-medium text-muted-foreground group-hover:text-primary transition-colors line-clamp-2 max-w-[70px]",children:m.name})]},m.id))})]})}function kt(){const n=Q(),[c,_]=a.useState([]),[m,y]=a.useState(0),[x,P]=a.useState(!0);a.useEffect(()=>{(async()=>{try{const{data:p,error:r}=await w.from("hero_banners").select("*").eq("is_active",!0).order("display_order",{ascending:!0});p&&!r&&_(p)}catch{T.debug("Hero banners not available")}P(!1)})()},[]);const d=a.useCallback(()=>{y(s=>(s+1)%Math.max(c.length,1))},[c.length]),v=a.useCallback(()=>{y(s=>(s-1+c.length)%Math.max(c.length,1))},[c.length]);if(a.useEffect(()=>{if(c.length<=1)return;const s=setInterval(d,5e3);return()=>clearInterval(s)},[c.length,d]),x||c.length===0)return null;const $=s=>{switch(s.background_type){case"gradient":return{background:s.background_value};case"image":return{backgroundImage:`url(${s.background_value})`,backgroundSize:"cover",backgroundPosition:"center"};case"color":return{backgroundColor:s.background_value};default:return{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}},b=(s,p)=>{s.stopPropagation(),p&&(p.startsWith("http")?window.open(p,"_blank"):n(p))},A=s=>{if(!(!s.click_type||s.click_type==="none"||!s.click_target))switch(s.click_type){case"category":n(`/shop?category=${s.click_target}`);break;case"product":n(`/product/${s.click_target}`);break;case"url":s.click_target.startsWith("http")?window.open(s.click_target,"_blank"):n(s.click_target);break}};return e.jsxs("div",{className:"relative mx-4 my-4 overflow-hidden rounded-2xl",children:[e.jsx("div",{className:"flex transition-transform duration-500 ease-out",style:{transform:`translateX(-${m*100}%)`},children:c.map(s=>e.jsxs("div",{className:`min-w-full relative ${s.click_type&&s.click_type!=="none"&&s.click_target?"cursor-pointer":""}`,style:{...$(s),minHeight:s.height||"200px",borderRadius:s.border_radius||"16px",color:s.text_color||"#ffffff"},onClick:()=>A(s),children:[e.jsxs("div",{className:`h-full flex flex-col justify-center p-6 ${s.image_position==="right"?"pr-24 md:pr-48":""}`,style:{textAlign:s.text_align},children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2 leading-tight",children:s.title}),s.subtitle&&e.jsx("p",{className:"text-base md:text-lg opacity-90 mb-2",children:s.subtitle}),s.description&&e.jsx("p",{className:"text-sm opacity-80 mb-4",children:s.description}),s.button_text&&e.jsx("div",{children:e.jsx(I,{onClick:p=>b(p,s.button_link),style:{backgroundColor:s.button_bg_color,color:s.button_text_color},className:"px-6 py-2 rounded-full font-semibold shadow-lg hover:opacity-90 transition-opacity",children:s.button_text})})]}),s.image_url&&s.image_position!=="background"&&e.jsx("img",{src:s.image_url,alt:"",className:`absolute ${s.image_position==="right"?"right-2 top-1/2 -translate-y-1/2 h-4/5 max-w-[40%]":s.image_position==="left"?"left-2 top-1/2 -translate-y-1/2 h-4/5 max-w-[40%]":"left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-4/5"} object-contain`})]},s.id))}),c.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:v,className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/80 hover:bg-white flex items-center justify-center shadow-md transition-colors",children:e.jsx(Se,{className:"h-5 w-5 text-gray-700"})}),e.jsx("button",{onClick:d,className:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/80 hover:bg-white flex items-center justify-center shadow-md transition-colors",children:e.jsx(z,{className:"h-5 w-5 text-gray-700"})})]}),c.length>1&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2",children:c.map((s,p)=>e.jsx("button",{onClick:()=>y(p),className:`h-2 rounded-full transition-all ${p===m?"w-6 bg-white":"w-2 bg-white/50 hover:bg-white/70"}`},p))})]})}function Ct({onAddToCart:n}){const c=Q(),{getItemQuantity:_,updateQuantity:m}=G(),[y,x]=a.useState([]),[P,d]=a.useState({}),[v,$]=a.useState({}),[b,A]=a.useState(!0),s=a.useCallback(async r=>{var h,j,k;try{let o=w.from("products").select(`
                    id, name, price, mrp, image_url, unit, discount_percent,
                    product_variants!left(price, mrp, variant_name, variant_value, variant_unit, is_default)
                `).eq("is_active",!0);switch(r.filter_type){case"discount":{const q=((h=r.filter_config)==null?void 0:h.min_discount)||0;o=o.gte("discount_percent",q);break}case"category":{const q=((j=r.filter_config)==null?void 0:j.category_ids)||[];q.length>0&&(o=o.in("category_id",q));break}case"manual":{const q=((k=r.filter_config)==null?void 0:k.product_ids)||[];q.length>0&&(o=o.in("id",q));break}}const{data:S}=await o.limit(r.max_products).order("discount_percent",{ascending:!1});if(S)return S.map(q=>{var g,E;return{...q,default_variant:((g=q.product_variants)==null?void 0:g.find(V=>V.is_default))||((E=q.product_variants)==null?void 0:E[0])||null}})}catch(o){T.error("Error fetching deal products",{error:o})}return[]},[]),p=a.useCallback(async()=>{try{const{data:r}=await w.from("flash_deals").select("*").eq("is_active",!0).lte("start_time",new Date().toISOString()).gte("end_time",new Date().toISOString()).order("display_order",{ascending:!0});if(r){const h=r;x(h);const j={};for(const k of h){const o=await s(k);j[k.id]=o}d(j)}}catch{T.debug("Flash deals not available")}A(!1)},[s]);return a.useEffect(()=>{p()},[p]),a.useEffect(()=>{const r=setInterval(()=>{const h={};y.forEach(j=>{const k=new Date(j.end_time).getTime(),o=Date.now(),S=k-o;if(S>0){const q=Math.floor(S/36e5),g=Math.floor(S%(1e3*60*60)/(1e3*60)),E=Math.floor(S%(1e3*60)/1e3);h[j.id]={h:q,m:g,s:E}}else h[j.id]={h:0,m:0,s:0}}),$(h)},1e3);return()=>clearInterval(r)},[y]),b||y.length===0?null:e.jsx("div",{className:"space-y-6",children:y.map(r=>{const h=P[r.id]||[],j=v[r.id]||{h:0,m:0,s:0};return h.length===0?null:e.jsxs("div",{className:"mx-4",children:[e.jsxs("div",{className:"rounded-t-2xl p-4",style:{backgroundColor:r.background_color,color:r.text_color},children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5 fill-current"}),e.jsx("span",{className:"font-bold text-lg",children:r.title}),r.badge_text&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-semibold",style:{backgroundColor:r.badge_color||void 0,color:"#ffffff"},children:r.badge_text})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:"Offer ends at"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"px-2 py-1 rounded font-mono font-bold text-sm",style:{backgroundColor:r.timer_bg_color,color:r.timer_text_color},children:String(j.h).padStart(2,"0")}),e.jsx("span",{className:"font-bold",children:":"}),e.jsx("span",{className:"px-2 py-1 rounded font-mono font-bold text-sm",style:{backgroundColor:r.timer_bg_color,color:r.timer_text_color},children:String(j.m).padStart(2,"0")}),e.jsx("span",{className:"font-bold",children:":"}),e.jsx("span",{className:"px-2 py-1 rounded font-mono font-bold text-sm",style:{backgroundColor:r.timer_bg_color,color:r.timer_text_color},children:String(j.s).padStart(2,"0")})]}),e.jsx("span",{className:"text-xs opacity-70",children:"HH : MM : SS"})]})]}),e.jsxs("div",{className:"bg-background rounded-b-2xl border border-t-0 p-3",children:[e.jsx(ne,{className:"gap-3 pb-2",children:h.map(k=>e.jsx("div",{className:"flex-shrink-0 w-[calc((100vw-48px)/3)] min-w-[100px] max-w-[120px]",children:e.jsx(Y,{product:k,onAddToCart:n,cartQuantity:_(k.id,null),onQuantityChange:(o,S)=>m(o,null,S)})},k.id))}),r.show_see_all&&e.jsxs("button",{onClick:()=>c(`/flash-deals/${r.id}`),className:"w-full text-center text-primary font-semibold text-sm py-2 mt-2 flex items-center justify-center gap-1 hover:underline",children:["See all ",e.jsx(z,{className:"h-4 w-4"})]})]})]},r.id)})})}function St({value:n,onChange:c,onFocus:_,onBlur:m,className:y=""}){const[x,P]=a.useState(["Milk","Bread","Eggs","Fruits","Vegetables"]),[d,v]=a.useState(0),[$,b]=a.useState(!1),[A,s]=a.useState(!1);a.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:o}=await w.from("products").select("name").eq("is_active",!0).limit(20);if(o&&o.length>0){const q=o.map(g=>g.name).sort(()=>Math.random()-.5).slice(0,8);P(q)}}catch{T.debug("Could not fetch product names for animation")}};a.useEffect(()=>{if(A||n.length>0||x.length<=1)return;const o=setInterval(()=>{b(!0),setTimeout(()=>{v(S=>(S+1)%x.length),b(!1)},300)},3e3);return()=>clearInterval(o)},[A,n,x.length]);const r=a.useCallback(()=>{s(!0),_==null||_()},[_]),h=a.useCallback(()=>{s(!1),m==null||m()},[m]),j=x[d]||"products",k=!A&&n.length===0;return e.jsx("div",{className:`relative ${y}`,children:e.jsxs("div",{className:"relative flex items-center bg-muted/60 rounded-xl border border-border/50 overflow-hidden hover:border-primary/30 transition-colors",children:[e.jsx("div",{className:"pl-4 pr-2 flex items-center",children:e.jsx(Ze,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("input",{type:"text",value:n,onChange:o=>c(o.target.value),onFocus:r,onBlur:h,className:"w-full py-3 pr-4 bg-transparent outline-none text-foreground placeholder-transparent",placeholder:"Search..."}),k&&e.jsxs("div",{className:"absolute left-12 top-1/2 -translate-y-1/2 pointer-events-none flex items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Search for "}),e.jsx("div",{className:"overflow-hidden h-6 flex items-center",children:e.jsx("div",{className:`transition-all duration-300 ease-in-out ${$?"transform -translate-y-full opacity-0":"transform translate-y-0 opacity-100"}`,children:e.jsxs("span",{className:"text-foreground font-medium",children:['"',j,'"']})})})]})]})})}function qt({threshold:n=499,className:c}){const{freeDeliveryThreshold:_}=Xe(),{cartTotal:m}=G(),y=_||n,x=m>=y,P=Math.max(y-m,0),d=Math.min(m/y*100,100);return m===0?null:e.jsx("div",{className:ae("fixed bottom-20 left-1/2 -translate-x-1/2 z-40 transition-all duration-300 animate-in slide-in-from-bottom-4",c),children:e.jsxs("div",{className:ae("flex items-center gap-3 px-4 py-2.5 rounded-full shadow-lg backdrop-blur-sm",x?"bg-gradient-to-r from-green-600 to-emerald-500 text-white":"bg-gray-900/95 text-white"),children:[e.jsx("div",{className:ae("flex items-center justify-center w-8 h-8 rounded-full",x?"bg-white/20":"bg-primary/20"),children:x?e.jsx(jt,{className:"h-4 w-4 text-white"}):e.jsx(yt,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"flex items-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-sm",children:"Free delivery unlocked!"}),e.jsx(qe,{className:"h-4 w-4 text-yellow-300 animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm",children:["Add ",e.jsxs("span",{className:"font-bold text-primary",children:["â‚¹",P.toFixed(0)]})," more for"]}),e.jsx("span",{className:"font-semibold text-sm text-green-400",children:"FREE delivery"})]})}),!x&&e.jsx("div",{className:"w-12 h-1.5 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-green-400 rounded-full transition-all duration-500",style:{width:`${d}%`}})})]})})}function Vt(){const{user:n,loading:c,signOut:_}=Ce(),{refreshCart:m,addToCart:y,getItemQuantity:x,updateQuantity:P,guestCartItems:d}=G(),v=Q(),[$,b]=Je(),[A,s]=a.useState([]),p=$.get("category"),[r,h]=a.useState(p),[j,k]=a.useState([]),[o,S]=a.useState([]),q=$.get("search")||"",[g,E]=a.useState(q),[V,Z]=a.useState([]),[Pe,D]=a.useState(!1),[Ae,Ie]=a.useState(!0),[Fe,R]=a.useState(!1),[X,le]=a.useState(""),[U,J]=a.useState("saved"),[W,$e]=a.useState(""),[K,Be]=a.useState(""),[Oe,Te]=a.useState(""),[De,Ee]=a.useState(""),[Pt,At]=a.useState(""),[Me,ee]=a.useState(!1),[te,ie]=a.useState(null),[ze,oe]=a.useState(!1),[ce,Ve]=a.useState(null),{recommendedProducts:de,trackView:He}=gt(),{isAtTop:Le}=Ke();a.useEffect(()=>{const i=setTimeout(async()=>{if(g.trim().length<1){Z([]),D(!1);return}const{data:l}=await w.from("products").select("id, name, price, mrp, image_url, unit, discount_percent, stock_quantity").ilike("name",`%${g.trim()}%`).eq("is_active",!0).gt("stock_quantity",0).limit(8);l&&l.length>0?(Z(l.map(C=>({...C,stock_quantity:C.stock_quantity??0,unit:C.unit||"piece"}))),D(!0)):(Z([]),D(!1))},100);return()=>clearTimeout(i)},[g]);const ue=a.useCallback(async()=>{const{data:t,error:i}=await w.from("categories").select("*").eq("is_active",!0).order("display_order");!i&&t&&s(t),Ie(!1)},[]),se=a.useCallback(async()=>{let t=w.from("products").select("*").eq("is_active",!0);r&&(t=t.eq("category_id",r));const{data:i,error:l}=await t;if(!l&&i){const C=i.map(f=>f.id),{data:u}=await w.from("product_variants").select("*").in("product_id",C).eq("is_default",!0),N=i.map(f=>{const F=(u==null?void 0:u.find(Ye=>Ye.product_id===f.id))||null;return{...f,default_variant:F}});k(N.map(f=>({...f,stock_quantity:f.stock_quantity??0,unit:f.unit||"piece"})))}},[r]),M=a.useCallback(async()=>{if(!n)return;const{data:t,error:i}=await w.from("cart_items").select("*, products(*), product_variants(*)").eq("user_id",n.id);!i&&t&&S(t)},[n]),me=a.useCallback(async()=>{if(!n)return;const{data:t}=await w.from("profiles").select("address").eq("id",n.id).single();t!=null&&t.address?(le(t.address),J("saved")):J("new")},[n]);a.useEffect(()=>{const t=$.get("category");h(t)},[$]),a.useEffect(()=>{c||se()},[r,c,se]),a.useEffect(()=>{if(c)return;ue(),n&&(M(),me());const t=()=>ee(!0);return window.addEventListener("openCart",t),()=>window.removeEventListener("openCart",t)},[n,c,ue,M,me]);const H=async t=>{await y(t,null)?(B.success("Added to cart"),n&&M()):B.error("Failed to add to cart")},he=async(t,i)=>{if(i<=0){await xe(t);return}const l=o.find(F=>F.id===t);if(!l)return;const{data:C,error:u}=await w.from("products").select("stock_quantity, name").eq("id",l.product_id).single();if(u||!C){B.error("Failed to check stock availability");return}const N=C.stock_quantity??0;if(i>N){if(B.error(`Only ${N} ${C.name} available`),N>0&&N!==l.quantity){const{error:F}=await w.from("cart_items").update({quantity:N}).eq("id",t);F||(M(),B.info(`Cart updated to maximum available (${N})`))}return}const{error:f}=await w.from("cart_items").update({quantity:i}).eq("id",t);f||M()},xe=async t=>{const{error:i}=await w.from("cart_items").delete().eq("id",t);i||(M(),B.success("Removed from cart"))},Qe=()=>{!n||o.length===0||(ie(null),R(!0))},Re=async()=>{if(!n)return;const t=te!==null;if(!t&&o.length===0){B.error("Your cart is empty");return}const i=U==="saved"?X:W.trim();if(!i){B.error("Please provide a delivery address");return}try{U==="new"&&W.trim()&&(await w.from("profiles").update({address:W.trim()}).eq("id",n.id),le(W.trim()));const l=t?[{product_id:te.id,quantity:1,variant_id:null,price:te.price}]:o.map(f=>{var F;return{product_id:f.product_id,quantity:f.quantity,variant_id:f.variant_id,price:((F=f.product_variants)==null?void 0:F.price)??f.products.price}}),{data:C,error:u}=await w.rpc("place_order_atomic",{p_user_id:n.id,p_delivery_address:i,p_cart_items:l,p_coupon_id:void 0,p_coupon_discount:0});if(u){T.error("Order placement error",{error:u}),B.error("Failed to place order. Please try again.");return}const N=C;if(!N.success){B.error(N.error||"Failed to place order");return}t||(S([]),m()),se(),R(!1),ee(!1),ie(null),$e(""),N.order_id&&(Ve(N.order_id),oe(!0))}catch(l){T.error("Unexpected order placement error",{error:l}),B.error("An unexpected error occurred. Please try again.")}},fe=j.filter(t=>t.name.toLowerCase().includes(g.toLowerCase())),Ue=o.reduce((t,i)=>t+i.products.price*i.quantity,0),We=d.reduce((t,i)=>{const l=j.find(C=>C.id===i.productId);return t+((l==null?void 0:l.price)||0)*i.quantity},0),pe=n?Ue:We;return Ae?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl supports-[backdrop-filter]:bg-background/20 shadow-[0_10px_40px_rgba(15,23,42,0.35)]",children:e.jsx("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-6 w-6 rounded-md"}),e.jsx(O,{className:"h-6 w-32 rounded-md"})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx(O,{className:"h-10 w-full max-w-md mx-auto rounded-md"})}),e.jsx("div",{className:"container mx-auto px-4 pb-4",children:e.jsx("div",{className:"flex gap-2 overflow-hidden",children:[1,2,3,4,5].map(t=>e.jsx(O,{className:"h-9 w-24 rounded-full shrink-0"},t))})}),e.jsx("div",{className:"container mx-auto px-4 pb-8",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[1,2,3,4,5,6,7,8,9,10].map(t=>e.jsxs("div",{className:"rounded-2xl border-2 border-border/40 bg-card overflow-hidden",children:[e.jsx(O,{className:"aspect-square w-full"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx(O,{className:"h-4 w-3/4"}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{className:"h-5 w-16"}),e.jsx(O,{className:"h-3 w-10"})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(O,{className:"h-8 w-16 rounded-full"}),e.jsx(O,{className:"h-8 w-8 rounded-full"})]})]})]})]},t))})}),e.jsx(ge,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-20",children:[ze&&ce&&e.jsx(ft,{orderId:ce,onClose:()=>oe(!1)}),e.jsx("header",{className:`sticky top-0 z-40 border-b border-border/40 bg-background/95 backdrop-blur-xl supports-[backdrop-filter]:bg-background/80 shadow-sm transition-transform duration-300 ${Le?"translate-y-0":"-translate-y-full"}`,children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/dist/logo.svg",alt:"PremaShop",className:"h-8 w-auto"}),e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"PremaShop"})]}),e.jsx("p",{className:"text-xs text-muted-foreground font-medium ml-8",children:"âš¡ Rapid Delivery in 14 mins"})]}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full bg-primary/10 hover:bg-primary/20",onClick:()=>v(n?"/profile":"/auth"),"aria-label":"View Profile",children:e.jsx(et,{className:"h-5 w-5 text-primary"})})]})})}),e.jsxs(ct,{open:Me,onOpenChange:ee,children:[e.jsx(dt,{asChild:!0,children:e.jsx("button",{id:"cart-trigger",className:"hidden"})}),e.jsxs(ut,{children:[e.jsx(mt,{children:e.jsx(ht,{children:"Your Cart"})}),e.jsx(xt,{className:"h-[calc(100vh-200px)] mt-4",children:o.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Your cart is empty"}):e.jsx("div",{className:"space-y-4",children:o.map(t=>e.jsx(je,{children:e.jsx(ve,{className:"p-4",children:e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:t.products.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["$",t.products.price," / ",t.products.unit]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(I,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:()=>he(t.id,t.quantity-1),children:e.jsx(ye,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center",children:t.quantity}),e.jsx(I,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:()=>he(t.id,t.quantity+1),children:e.jsx(re,{className:"h-3 w-3"})}),e.jsx(I,{size:"icon",variant:"ghost",className:"h-7 w-7 ml-auto",onClick:()=>xe(t.id),children:e.jsx(vt,{className:"h-3 w-3"})})]})]})})})},t.id))})}),o.length>0&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-background border-t",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"font-bold text-lg",children:["$",pe.toFixed(2)]})]}),e.jsx(I,{className:"w-full",onClick:Qe,children:"Place Order"})]})]})]}),e.jsx("div",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur-xl py-4",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"relative max-w-md mx-auto",children:[e.jsx(St,{value:g,onChange:t=>{E(t),t.trim().length>=2&&D(!0)},onFocus:()=>{g.trim().length>=2&&V.length>0&&D(!0)},onBlur:()=>{setTimeout(()=>D(!1),200)}}),Pe&&V.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-card border rounded-lg shadow-lg z-50 max-h-[300px] overflow-y-auto",children:V.map(t=>e.jsxs("button",{className:"w-full flex items-center gap-3 p-3 hover:bg-muted transition-colors text-left",onClick:()=>{v(`/product/${t.id}`),D(!1)},children:[t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-10 h-10 rounded object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded bg-muted flex items-center justify-center",children:e.jsx(be,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-primary font-semibold",children:["â‚¹",t.price]})]}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground shrink-0"})]},t.id))})]})})}),e.jsx("div",{className:"container mx-auto px-4 pb-4",children:e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:[e.jsx(I,{variant:r===null?"default":"outline",onClick:()=>{h(null),b({})},className:"rounded-full flex-shrink-0",children:"All"}),A.map(t=>e.jsx(I,{variant:r===t.id?"default":"outline",onClick:()=>{h(t.id),b({category:t.id})},className:"rounded-full flex-shrink-0 whitespace-nowrap",children:t.name},t.id))]})}),!g&&!r&&e.jsx(kt,{}),!g&&!r&&e.jsx(Ct,{onAddToCart:H}),!g&&!r&&e.jsx(Nt,{}),n&&de.length>0&&!g&&!r&&e.jsxs("div",{className:"container mx-auto px-4 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg",children:e.jsx(qe,{className:"h-4 w-4 text-white"})}),e.jsx("h2",{className:"text-lg font-bold",children:"For You"})]}),e.jsx(ne,{className:"gap-3",children:de.slice(0,8).map(t=>e.jsx("div",{className:"flex-shrink-0 w-[150px]",children:e.jsx(Y,{product:{...t,mrp:t.mrp??null,stock_quantity:t.stock_quantity??void 0},onAddToCart:()=>{He(t.id),H(t.id)},cartQuantity:x(t.id,null),onQuantityChange:(i,l)=>P(i,null,l)})},t.id))})]}),!g&&!r&&A.filter(t=>t.shop_section_visible!==!1).map(t=>{const i=j.filter(l=>l.category_id===t.id);return i.length===0?null:e.jsxs("div",{className:"container mx-auto px-4 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:t.name}),e.jsxs("button",{onClick:()=>{h(t.id),b({category:t.id})},className:"text-sm text-primary font-medium hover:underline flex items-center gap-1",children:["See all",e.jsx(z,{className:"h-4 w-4"})]})]}),e.jsx(ne,{className:"gap-3",children:i.slice(0,8).map(l=>e.jsx("div",{className:"flex-shrink-0 w-[calc((100vw-48px)/3)] min-w-[100px] max-w-[120px]",children:e.jsx(Y,{product:{id:l.id,name:l.name,price:l.price,mrp:l.mrp??null,image_url:l.image_url,unit:l.unit,discount_percent:l.discount_percent,default_variant:l.default_variant,stock_quantity:l.stock_quantity},onAddToCart:()=>H(l.id),cartQuantity:x(l.id,null),onQuantityChange:(C,u)=>P(C,null,u)})},l.id))})]},t.id)}),e.jsx("div",{className:"container mx-auto px-4 pb-8",children:fe.length===0?e.jsx(tt,{title:g?"No products found":"No products in this category",description:g?`No results for "${g}"`:"Try selecting a different category"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:fe.map(t=>{const i=t.stock_quantity<=0,l=t.stock_quantity>0&&t.stock_quantity<=5,C=t.stock_quantity>5&&t.stock_quantity<=10;return e.jsxs(je,{className:`overflow-hidden rounded-2xl border-2 bg-card/90 hover:shadow-xl transition-all relative ${i?"border-destructive/60 bg-destructive/5":l?"border-red-500/60 bg-red-50/50 dark:bg-red-950/20":C?"border-orange-400/60 bg-orange-50/50 dark:bg-orange-950/20":"border-border/40 hover:border-primary/40"}`,children:[(l||C)&&!i&&e.jsx("div",{className:`absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-bold ${l?"bg-red-500 text-white animate-pulse":"bg-orange-500 text-white"}`,children:l?`Only ${t.stock_quantity} left!`:`${t.stock_quantity} left`}),(()=>{const u=t.default_variant,N=(u==null?void 0:u.price)??t.price,f=(u==null?void 0:u.mrp)??t.mrp,F=f&&f>N?Math.round((f-N)/f*100):t.discount_percent||0;return F>0?e.jsxs("div",{className:"absolute top-2 left-2 z-10 px-2 py-1 rounded-md bg-gradient-to-r from-green-500 to-emerald-600 text-white text-xs font-bold shadow-lg",children:[F,"% OFF"]}):null})(),e.jsxs(ve,{className:"p-0",children:[e.jsx("div",{className:`aspect-square bg-muted flex items-center justify-center cursor-pointer ${i?"opacity-50":""}`,onClick:()=>v(`/product/${t.id}`),children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"}):e.jsx(be,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm line-clamp-2 mb-1 cursor-pointer hover:text-primary transition-colors",onClick:()=>v(`/product/${t.id}`),children:t.name}),t.default_variant&&e.jsx("span",{className:"text-[10px] text-muted-foreground block mb-1",children:Ne(t.default_variant)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:(()=>{const u=t.default_variant,N=(u==null?void 0:u.price)??t.price,f=(u==null?void 0:u.mrp)??t.mrp,F=u?Ne(u):t.unit;return f&&f>N?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["â‚¹",N]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["â‚¹",f]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["/ ",F]})]})]}):t.discount_percent&&t.discount_percent>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["â‚¹",Math.round(t.price*(100-t.discount_percent)/100)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["â‚¹",t.price]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["/ ",t.unit]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["â‚¹",N]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["/ ",F]})]})})()}),(()=>{const u=x(t.id,null);return u>0?e.jsxs("div",{className:"flex items-center gap-0 rounded-full overflow-hidden border border-primary",children:[e.jsx(I,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none",onClick:()=>P(t.id,null,u-1),children:e.jsx(ye,{className:"h-3 w-3"})}),e.jsx("span",{className:"px-2 font-bold text-sm min-w-[24px] text-center",children:u}),e.jsx(I,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none",onClick:()=>P(t.id,null,u+1),disabled:i,children:e.jsx(re,{className:"h-3 w-3"})})]}):e.jsx(I,{size:"icon",className:`h-9 w-9 rounded-full ${i?"opacity-50":""}`,onClick:()=>H(t.id),disabled:i,children:e.jsx(re,{className:"h-4 w-4"})})})()]}),i&&e.jsx(st,{variant:"destructive",className:"w-full mt-2 justify-center",children:"Out of Stock"}),l&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 font-medium mt-2 text-center",children:"ðŸ”¥ Hurry! Almost sold out"})]})]})]},t.id)})})}),!g&&!r&&e.jsx(wt,{onAddToCart:H}),!g&&!r&&e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx(_t,{categories:A,onCategorySelect:h})}),e.jsx(at,{open:Fe,onOpenChange:R,children:e.jsxs(rt,{className:"max-w-md",children:[e.jsx(nt,{children:e.jsx(lt,{children:"Select Delivery Address"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs(pt,{value:U,onValueChange:t=>J(t),children:[X&&e.jsxs("div",{className:"flex items-start space-x-3 p-4 border rounded-lg",children:[e.jsx(_e,{value:"saved",id:"saved"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(L,{htmlFor:"saved",className:"font-medium cursor-pointer",children:"Use Saved Address"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:X})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-4 border rounded-lg",children:[e.jsx(_e,{value:"new",id:"new"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(L,{htmlFor:"new",className:"font-medium cursor-pointer",children:"Enter New Address"}),U==="new"&&e.jsxs("div",{className:"space-y-4 mt-3",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-sm",children:"Apartment Complex"}),e.jsxs("select",{value:K,onChange:t=>Be(t.target.value),className:"w-full mt-1.5 p-2 border rounded-md bg-background text-sm",children:[e.jsx("option",{value:"",children:"Select your apartment..."}),e.jsx("option",{value:"VBHC Vaibhava",title:"VBHC Vaibhava, Chandapura-Anekal Road, Bangalore - 562106",children:"VBHC Vaibhava"}),e.jsx("option",{value:"Symphony",title:"Symphony, Chandapura-Anekal Road, Bangalore - 562106",children:"Symphony"})]}),K&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["ðŸ“ ",K,", Chandapura-Anekal Road, Bangalore - 562106"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-sm",children:"Block/Tower"}),e.jsx(we,{placeholder:"e.g., 51",value:Oe,onChange:t=>Te(t.target.value),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(L,{className:"text-sm",children:"Room Number"}),e.jsx(we,{placeholder:"e.g., 603",value:De,onChange:t=>Ee(t.target.value),className:"mt-1.5"})]})]})]})]})]})]})}),e.jsxs(it,{children:[e.jsx(I,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),e.jsx(I,{onClick:Re,children:"Confirm Order"})]})]})}),e.jsx(ot,{}),e.jsx(qt,{threshold:499,cartTotal:pe}),e.jsx(ge,{})]})}export{Vt as default};
