import{a as S,r as o,s as f,n as d,j as e,L as u,B as l,A as E,au as L,C as g,c as v,E as z,F as A,aj as O,aH as B,aI as D,aJ as F,aK as G,K as H,aL as U}from"./index-Cz072s1P.js";import{L as j}from"./layout-grid-DKiTrYuc.js";import{G as I}from"./grip-vertical-7KAxxBql.js";function V(){const b=S(),[t,c]=o.useState([]),[N,m]=o.useState(!0),[h,x]=o.useState(!1),[_,n]=o.useState(!1),p=o.useCallback(async()=>{m(!0);const{data:s,error:a}=await f.from("categories").select("*").order("display_order",{ascending:!0});if(a)d.error("Failed to load categories"),console.error("Error:",a);else if(s){const i=s.map(r=>({...r,shop_section_visible:r.shop_section_visible??!0}));c(i)}m(!1)},[]);o.useEffect(()=>{p()},[p]);const w=s=>{c(a=>a.map(i=>i.id===s?{...i,shop_section_visible:!i.shop_section_visible}:i)),n(!0)},C=s=>{if(s===0)return;const a=[...t];[a[s-1],a[s]]=[a[s],a[s-1]],a.forEach((i,r)=>i.display_order=r+1),c(a),n(!0)},y=s=>{if(s===t.length-1)return;const a=[...t];[a[s],a[s+1]]=[a[s+1],a[s]],a.forEach((i,r)=>i.display_order=r+1),c(a),n(!0)},k=async()=>{x(!0);try{const s=t.map((a,i)=>f.from("categories").update({display_order:i+1,shop_section_visible:a.shop_section_visible}).eq("id",a.id));await Promise.all(s),d.success("Category sections updated successfully!"),n(!1)}catch(s){console.error("Error saving:",s),d.error("Failed to save changes")}x(!1)};return N?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5 flex items-center justify-center",children:e.jsx(u,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/80 backdrop-blur-xl",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>b("/admin"),children:e.jsx(E,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"Shop Category Sections"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage visibility and order"})]})]}),e.jsxs(l,{onClick:k,disabled:!_||h,size:"sm",children:[h?e.jsx(u,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(L,{className:"h-4 w-4 mr-2"}),"Save"]})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[e.jsx(g,{className:"mb-6 border-primary/20 bg-primary/5",children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Category Sections in Shop Page"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Toggle which categories appear as horizontal sections on the shop page. Use the arrows to change the order. Categories appear in the order shown below."})]})]})})}),e.jsxs(g,{children:[e.jsxs(z,{className:"pb-2",children:[e.jsx(A,{className:"text-base",children:"Categories"}),e.jsxs(O,{children:[t.filter(s=>s.shop_section_visible&&s.is_active).length," of ",t.filter(s=>s.is_active).length," visible on shop page"]})]}),e.jsx(v,{className:"p-0",children:e.jsx("div",{className:"divide-y",children:t.filter(s=>s.is_active).map((s,a)=>e.jsxs("div",{className:`flex items-center gap-3 p-4 ${s.shop_section_visible?"":"opacity-50 bg-muted/30"}`,children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(l,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>C(t.filter(i=>i.is_active).indexOf(s)),disabled:a===0,children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(l,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>y(t.filter(i=>i.is_active).indexOf(s)),disabled:a===t.filter(i=>i.is_active).length-1,children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted overflow-hidden flex-shrink-0",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:e.jsx(j,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Order: ",a+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.shop_section_visible?e.jsx(F,{className:"h-4 w-4 text-green-500"}):e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(H,{checked:s.shop_section_visible,onCheckedChange:()=>w(s.id)})]})]},s.id))})})]}),t.some(s=>!s.is_active)&&e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-4",children:"Note: Inactive categories are hidden from this list. Activate them first to manage their shop section visibility."})]}),e.jsx(U,{})]})}export{V as default};
