import{u as J,a as Q,r as l,s as n,l as U,j as e,S as F,B as o,A as W,R as A,C as P,c as I,i as E,K as _,a2 as Y,a3 as ee,a4 as se,a5 as ae,a6 as te,H as i,I as d,a8 as re,a9 as ie,aa as ce,ab as le,ac as j,ad as de,$ as ne,P as oe,a7 as ue,n as u}from"./index-Cz072s1P.js";import{A as me}from"./AdminBottomNav-BKFUrCDc.js";import{L as xe}from"./layers-BKvkq3ty.js";import{P as he}from"./pencil-BK-kXoKK.js";import"./wallet-cnpIPmyq.js";const y=["linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];function ye(){const{user:v,userRole:b,loading:N}=J(),p=Q(),[g,O]=l.useState([]),[L,z]=l.useState([]),[B,T]=l.useState(!0),[q,m]=l.useState(!1),[x,w]=l.useState(null),[t,r]=l.useState({name:"",title:"",subtitle:"",background_type:"gradient",background_value:y[0],text_color:"#ffffff",filter_type:"manual",min_discount:40,max_discount:60,category_ids:[],product_ids:[],max_products:10,show_see_all:!0,is_active:!0,display_order:0}),[k,R]=l.useState([]),[C,f]=l.useState(""),S=b==="admin"||b==="super_admin";l.useEffect(()=>{if(!N){if(!v||!S){p("/");return}h(),$(),H()}},[v,N,S,p]);const h=async()=>{try{const{data:s}=await n.from("offer_sections").select("*").order("display_order",{ascending:!0});s&&O(s)}catch(s){U.error("Failed to fetch offer sections",{error:s})}T(!1)},$=async()=>{const{data:s}=await n.from("categories").select("id, name").order("name");s&&z(s)},H=async()=>{const{data:s}=await n.from("products").select("id, name, image_url").eq("is_active",!0).order("name");s&&R(s)},D=()=>{w(null),r({name:"",title:"",subtitle:"",background_type:"gradient",background_value:y[0],text_color:"#ffffff",filter_type:"manual",min_discount:40,max_discount:60,category_ids:[],product_ids:[],max_products:10,show_see_all:!0,is_active:!0,display_order:g.length}),f(""),m(!0)},M=s=>{w(s);const a=s.filter_config||{};r({name:s.name,title:s.title,subtitle:s.subtitle||"",background_type:s.background_type,background_value:s.background_value,text_color:s.text_color,filter_type:s.filter_type,min_discount:a.min_discount||0,max_discount:a.max_discount||100,category_ids:a.category_ids||[],product_ids:a.product_ids||[],max_products:s.max_products,show_see_all:s.show_see_all,is_active:s.is_active,display_order:s.display_order}),f(""),m(!0)},G=()=>{switch(t.filter_type){case"discount":return{min_discount:t.min_discount,max_discount:t.max_discount};case"category":return{category_ids:t.category_ids};case"manual":return{product_ids:t.product_ids};default:return{}}},V=async()=>{if(!t.name.trim()||!t.title.trim()){u.error("Name and title are required");return}try{const s={name:t.name,title:t.title,subtitle:t.subtitle||null,background_type:t.background_type,background_value:t.background_value,text_color:t.text_color,filter_type:t.filter_type,filter_config:G(),max_products:t.max_products,show_see_all:t.show_see_all,is_active:t.is_active,display_order:t.display_order,updated_at:new Date().toISOString()};x?(await n.from("offer_sections").update(s).eq("id",x.id),u.success("Section updated")):(await n.from("offer_sections").insert(s),u.success("Section created")),m(!1),h()}catch{u.error("Failed to save")}},Z=async s=>{if(confirm("Delete this offer section?"))try{await n.from("offer_sections").delete().eq("id",s),u.success("Deleted"),h()}catch{u.error("Failed to delete")}},K=async s=>{try{await n.from("offer_sections").update({is_active:!s.is_active}).eq("id",s.id),h()}catch{u.error("Failed")}};return B?e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(F,{className:"h-6 w-40"})})}),e.jsx("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3].map(s=>e.jsx(F,{className:"h-24 rounded-xl"},s))})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>p("/admin"),children:e.jsx(W,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"Offer Sections"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"50% OFF Zone, etc."})]})]}),e.jsxs(o,{onClick:D,size:"sm",children:[e.jsx(A,{className:"h-4 w-4 mr-1"})," Add Section"]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 space-y-4",children:g.length===0?e.jsx(P,{children:e.jsxs(I,{className:"py-12 text-center",children:[e.jsx(xe,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No offer sections yet"}),e.jsxs(o,{onClick:D,className:"mt-4",children:[e.jsx(A,{className:"h-4 w-4 mr-2"})," Create First Section"]})]})}):g.map(s=>e.jsxs(P,{className:s.is_active?"":"opacity-60",children:[e.jsx("div",{className:"h-16 rounded-t-lg flex items-center p-4",style:{background:s.background_value,color:s.text_color},children:e.jsx("h3",{className:"font-bold",children:s.title})}),e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"}),e.jsx(E,{variant:"outline",children:s.filter_type})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{checked:s.is_active,onCheckedChange:()=>K(s)}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>M(s),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>Z(s.id),children:e.jsx(Y,{className:"h-4 w-4 text-destructive"})})]})]})})]},s.id))}),e.jsx(ee,{open:q,onOpenChange:m,children:e.jsxs(se,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(ae,{children:e.jsx(te,{children:x?"Edit Offer Section":"Create Offer Section"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Internal Name *"}),e.jsx(d,{value:t.name,onChange:s=>r(a=>({...a,name:s.target.value})),placeholder:"50-off-zone"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Display Title *"}),e.jsx(d,{value:t.title,onChange:s=>r(a=>({...a,title:s.target.value})),placeholder:"50% OFF Zone"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Subtitle"}),e.jsx(d,{value:t.subtitle,onChange:s=>r(a=>({...a,subtitle:s.target.value})),placeholder:"Half the price, double the joy!"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Background Gradient"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:y.map((s,a)=>e.jsx("button",{className:`h-10 rounded-lg border-2 ${t.background_value===s?"border-primary":"border-transparent"}`,style:{background:s},onClick:()=>r(c=>({...c,background_value:s}))},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Filter Type"}),e.jsxs(re,{value:t.filter_type,onValueChange:s=>r(a=>({...a,filter_type:s})),children:[e.jsx(ie,{children:e.jsx(ce,{})}),e.jsxs(le,{children:[e.jsx(j,{value:"manual",children:"Select Products"}),e.jsx(j,{value:"discount",children:"By Discount %"}),e.jsx(j,{value:"category",children:"By Category"})]})]})]}),t.filter_type==="discount"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Min Discount %"}),e.jsx(d,{type:"number",value:t.min_discount,onChange:s=>r(a=>({...a,min_discount:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Max Discount %"}),e.jsx(d,{type:"number",value:t.max_discount,onChange:s=>r(a=>({...a,max_discount:parseInt(s.target.value)||100}))})]})]}),t.filter_type==="category"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto p-2 border rounded",children:L.map(s=>e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded-full border ${t.category_ids.includes(s.id)?"bg-primary text-white":"bg-muted"}`,onClick:()=>{r(a=>({...a,category_ids:a.category_ids.includes(s.id)?a.category_ids.filter(c=>c!==s.id):[...a.category_ids,s.id]}))},children:s.name},s.id))})]}),t.filter_type==="manual"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{children:["Select Products (",t.product_ids.length," selected)"]}),t.product_ids.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 p-2 border rounded bg-muted/30",children:t.product_ids.map(s=>{const a=k.find(c=>c.id===s);return a?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-primary text-white rounded-full",children:[a.name.slice(0,20),a.name.length>20?"...":"",e.jsx("button",{type:"button",onClick:()=>r(c=>({...c,product_ids:c.product_ids.filter(X=>X!==s)})),className:"hover:bg-white/20 rounded-full p-0.5",children:e.jsx(de,{className:"h-3 w-3"})})]},s):null})}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Search products...",value:C,onChange:s=>f(s.target.value),className:"pl-8"})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded p-2 space-y-1",children:k.filter(s=>s.name.toLowerCase().includes(C.toLowerCase())).slice(0,20).map(s=>e.jsxs("button",{type:"button",className:`w-full flex items-center gap-2 p-2 rounded text-left text-sm hover:bg-muted ${t.product_ids.includes(s.id)?"bg-primary/10 border-primary border":""}`,onClick:()=>{r(a=>({...a,product_ids:a.product_ids.includes(s.id)?a.product_ids.filter(c=>c!==s.id):[...a.product_ids,s.id]}))},children:[s.image_url?e.jsx("img",{src:s.image_url,alt:"",className:"w-8 h-8 rounded object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded bg-muted flex items-center justify-center",children:e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{className:"flex-1 truncate",children:s.name}),t.product_ids.includes(s.id)&&e.jsx("span",{className:"text-primary text-xs",children:"âœ“"})]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Max Products"}),e.jsx(d,{type:"number",value:t.max_products,onChange:s=>r(a=>({...a,max_products:parseInt(s.target.value)||10}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Display Order"}),e.jsx(d,{type:"number",value:t.display_order,onChange:s=>r(a=>({...a,display_order:parseInt(s.target.value)||0}))})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"seeall",checked:t.show_see_all,onCheckedChange:s=>r(a=>({...a,show_see_all:s}))}),e.jsx(i,{htmlFor:"seeall",children:'Show "See All"'})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"active",checked:t.is_active,onCheckedChange:s=>r(a=>({...a,is_active:s}))}),e.jsx(i,{htmlFor:"active",children:"Active"})]})]})]}),e.jsxs(ue,{children:[e.jsx(o,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(o,{onClick:V,children:x?"Save":"Create"})]})]})}),e.jsx(me,{})]})}export{ye as default};
