import{q as te,u as ae,a as re,r as i,s as m,l as k,j as e,S as j,B as x,A as ne,C as c,c as d,t as le,v as ie,U as I,w as ce,x as de,y as oe,k as z,z as me,D as xe,L as ue,E as v,F as N,G as he,P as ge,H as S,I as C,J as B,K as pe,N as fe,O as je,n as h}from"./index-BASgNFzI.js";import{P as F}from"./power-B24QauRN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=te("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);function we(){var L,M;const{user:n,loading:D,signOut:U}=ae(),g=re(),[H,A]=i.useState(!0),[q,P]=i.useState(!1),[l,b]=i.useState({phone:"",full_name:"",email:"",username:null}),[o,Y]=i.useState({today:0,week:0,month:0,allTime:0,todayDeliveries:0,totalDeliveries:0,avgRating:0}),[G,W]=i.useState(!0),[a,p]=i.useState("none"),[w,R]=i.useState(!1);i.useEffect(()=>{if(!D){if(!n){g("/auth");return}J(),T()}},[n,D,g]);const J=async()=>{if(n){A(!0);try{const{data:s}=await m.from("profiles").select("phone, full_name, username").eq("id",n.id).single();if(s){const r=s;b({phone:r.phone||"",full_name:r.full_name||"",email:n.email||"",username:r.username||null})}const t=new Date,E=new Date(t);E.setHours(0,0,0,0);const y=new Date(t);y.setDate(y.getDate()-7);const _=new Date(t);_.setMonth(_.getMonth()-1);const{data:Q}=await m.from("delivery_assignments").select("id, user_confirmed_at").eq("delivery_person_id",n.id).not("user_confirmed_at","is",null),u=Q||[],O=u.filter(r=>r.user_confirmed_at&&new Date(r.user_confirmed_at)>=E),V=u.filter(r=>r.user_confirmed_at&&new Date(r.user_confirmed_at)>=y),Z=u.filter(r=>r.user_confirmed_at&&new Date(r.user_confirmed_at)>=_),{data:f}=await m.from("delivery_ratings").select("rating").eq("delivery_person_id",n.id),ee=f&&f.length>0?f.reduce((r,se)=>r+se.rating,0)/f.length:0;Y({today:O.length*5,week:V.length*5,month:Z.length*5,allTime:u.length*5,todayDeliveries:O.length,totalDeliveries:u.length,avgRating:Math.round(ee*10)/10})}catch(s){k.error("Error fetching delivery profile data",{error:s})}finally{A(!1)}}},K=async()=>{var s;if(n){P(!0);try{const{error:t}=await m.from("profiles").update({full_name:l.full_name,username:((s=l.username)==null?void 0:s.toLowerCase())||null}).eq("id",n.id);if(t)throw t;h.success("Profile updated!")}catch{h.error("Failed to update profile")}finally{P(!1)}}},X=async()=>{await U(),g("/auth")},T=async()=>{if(!n)return;const s=new Date().toISOString().split("T")[0];try{const{data:t}=await m.from("delivery_activations").select("status").eq("delivery_partner_id",n.id).eq("activation_date",s).maybeSingle();p(t?t.status:"none")}catch{k.debug("Activation status not available"),p("none")}},$=async()=>{if(n){R(!0);try{const s=new Date().toISOString().split("T")[0],{error:t}=await m.from("delivery_activations").insert({delivery_partner_id:n.id,activation_date:s,status:"pending"});if((t==null?void 0:t.code)==="23505")h.info("You already requested activation today"),T();else{if(t)throw t;h.success("Activation request sent! Waiting for admin approval."),p("pending")}}catch(s){h.error("Failed to request activation"),k.error("Activation request failed",{error:s})}R(!1)}};return H?e.jsxs("div",{className:"min-h-screen bg-background p-4",children:[e.jsx(j,{className:"h-12 w-full mb-4"}),e.jsx(j,{className:"h-32 w-full mb-4 rounded-xl"}),e.jsx(j,{className:"h-48 w-full mb-4 rounded-xl"}),e.jsx(j,{className:"h-64 w-full rounded-xl"})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5 pb-8",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-background/80 backdrop-blur-xl border-b",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>g("/delivery"),children:e.jsx(ne,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"My Account"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(c,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(le,{className:"w-16 h-16 border-2 border-primary",children:e.jsx(ie,{className:"bg-primary/10 text-primary text-xl",children:((M=(L=l.full_name)==null?void 0:L[0])==null?void 0:M.toUpperCase())||e.jsx(I,{className:"w-6 h-6"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-bold",children:l.full_name||"Delivery Partner"}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"})," ",l.phone||"No phone"]}),l.email&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"})," ",l.email]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-amber-500",children:[e.jsx(oe,{className:"w-5 h-5 fill-current"}),e.jsx("span",{className:"text-lg font-bold",children:o.avgRating||"—"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rating"})]})]})})}),e.jsx(c,{className:a==="approved"?"border-green-500 bg-green-500/5":a==="pending"?"border-amber-500 bg-amber-500/5":"",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${a==="approved"?"bg-green-500":a==="pending"?"bg-amber-500":a==="rejected"?"bg-red-500":"bg-muted"}`,children:a==="approved"?e.jsx(z,{className:"w-6 h-6 text-white"}):a==="pending"?e.jsx(me,{className:"w-6 h-6 text-white"}):a==="rejected"?e.jsx(xe,{className:"w-6 h-6 text-white"}):e.jsx(F,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a==="approved"?"Active Today":a==="pending"?"Awaiting Approval":a==="rejected"?"Request Rejected":"Not Active"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a==="approved"?"You can receive orders":a==="pending"?"Admin will review shortly":a==="rejected"?"Contact admin for details":"Request to go active for today"})]})]}),a==="none"&&e.jsxs(x,{onClick:$,disabled:w,children:[w?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):e.jsx(F,{className:"w-4 h-4 mr-2"}),w?"Requesting...":"Go Active"]})]})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Recent Payouts"}),e.jsx("div",{className:"space-y-3",children:payouts.length===0?e.jsx(c,{children:e.jsx(d,{className:"p-4 text-center text-muted-foreground",children:"No payment history"})}):payouts.map(s=>e.jsx(c,{className:"overflow-hidden",children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg",children:["₹",s.amount]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx(Badge,{variant:s.status==="approved"?"default":s.status==="pending"?"outline":"destructive",children:s.status})]}),s.status==="pending"&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(x,{size:"sm",variant:"outline",className:"w-full border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700",onClick:()=>handlePayoutAction(s.id,"rejected"),children:"Reject"}),e.jsx(x,{size:"sm",className:"w-full bg-green-600 hover:bg-green-700",onClick:()=>handlePayoutAction(s.id,"approved"),children:"Confirm Receipt"})]})]})},s.id))})]}),e.jsxs(c,{className:"bg-primary/5 border-primary/20",children:[e.jsx(v,{className:"pb-2",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Earnings Overview"]})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",o.today]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",o.week]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This Week"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",o.month]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This Month"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",o.allTime]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All Time"})]})]})})]}),e.jsxs(c,{children:[e.jsx(v,{className:"pb-2",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Delivery Statistics"]})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg",children:[e.jsx(ge,{className:"w-8 h-8 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold",children:o.todayDeliveries}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(z,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold",children:o.totalDeliveries}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]})]})]})})]}),e.jsxs(c,{children:[e.jsx(v,{className:"pb-2",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Edit Profile"]})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Full Name"}),e.jsx(C,{value:l.full_name||"",onChange:s=>b({...l,full_name:s.target.value}),placeholder:"Your name"})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Username"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex items-center justify-center px-3 bg-muted border border-r-0 rounded-l-md text-sm font-medium text-muted-foreground",children:"@"}),e.jsx(C,{value:l.username||"",onChange:s=>b({...l,username:s.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"").slice(0,20)}),placeholder:"your_username",className:"rounded-l-none",maxLength:20})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Letters, numbers, underscores (3-20 chars)"})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Phone Number"}),e.jsx(C,{value:l.phone,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Contact support to change phone number"})]}),e.jsx(x,{onClick:K,disabled:q,className:"w-full",children:q?"Saving...":"Save Changes"})]})]}),e.jsxs(c,{children:[e.jsx(v,{className:"pb-2",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Settings"]})}),e.jsx(d,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Push Notifications"})]}),e.jsx(pe,{checked:G,onCheckedChange:W})]})})]}),e.jsx(fe,{}),e.jsxs(x,{variant:"destructive",className:"w-full",onClick:X,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})]})}export{we as default};
