import{u as E,a as I,r as l,s as o,l as w,j as e,S as m,B as x,A as q,h as F,i as _,z as L,C as p,c as h,U as O,aa as k,af as S,n as A}from"./index-BPlST4q7.js";import{A as T}from"./AdminBottomNav-W8yJ9IUt.js";import{P as D}from"./power-DJioiyfg.js";import"./wallet-BwAtZGem.js";function G(){const{user:i,userRole:u,loading:f}=E(),c=I(),[j,v]=l.useState([]),[C,d]=l.useState(!0),g=u==="admin"||u==="super_admin";l.useEffect(()=>{if(!f){if(!i||!g){c("/");return}N()}},[i,f,g,c]);const N=async()=>{try{const s=new Date().toISOString().split("T")[0],{data:a,error:r}=await o.from("delivery_activations").select("id, delivery_partner_id, activation_date, status, created_at").eq("activation_date",s).order("created_at",{ascending:!1});if(r){w.error("Failed to fetch activations",{error:r}),d(!1);return}if(!a||a.length===0){v([]),d(!1);return}const P=[...new Set(a.map(t=>t.delivery_partner_id))],{data:R}=await o.from("profiles").select("id, full_name, phone").in("id",P),z=new Map((R||[]).map(t=>[t.id,{full_name:t.full_name,phone:t.phone}])),B=a.map(t=>({id:t.id,delivery_partner_id:t.delivery_partner_id,activation_date:t.activation_date,status:t.status||"pending",created_at:t.created_at||new Date().toISOString(),profiles:z.get(t.delivery_partner_id)||null}));v(B)}catch(s){w.error("Failed to fetch delivery activation requests",{error:s})}d(!1)},b=async(s,a)=>{try{await o.from("delivery_activations").update({status:a,admin_id:i==null?void 0:i.id,updated_at:new Date().toISOString()}).eq("id",s),A.success(`Request ${a}`),N()}catch{A.error("Failed to update request")}};if(C)return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-3",children:[e.jsx(m,{className:"h-8 w-8"}),e.jsx(m,{className:"h-6 w-48"})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3].map(s=>e.jsx(m,{className:"h-24 rounded-xl"},s))})]});const n=j.filter(s=>s.status==="pending"),y=j.filter(s=>s.status!=="pending");return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>c("/admin"),children:e.jsx(q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"Delivery Activations"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Today - ",F(new Date,"PPP")]})]})]}),e.jsxs(_,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),n.length," pending"]})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[n.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-amber-500"}),"Pending Requests"]}),e.jsx("div",{className:"space-y-3",children:n.map(s=>{var a,r;return e.jsx(p,{className:"border-amber-500/50",children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-500/10 flex items-center justify-center",children:e.jsx(O,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:((a=s.profiles)==null?void 0:a.full_name)||"Delivery Partner"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((r=s.profiles)==null?void 0:r.phone)||"No phone"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{size:"sm",variant:"outline",className:"text-red-500 border-red-500 hover:bg-red-500 hover:text-white",onClick:()=>b(s.id,"rejected"),children:e.jsx(k,{className:"h-4 w-4"})}),e.jsxs(x,{size:"sm",className:"bg-green-500 hover:bg-green-600",onClick:()=>b(s.id,"approved"),children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Approve"]})]})]})})},s.id)})})]}),n.length===0&&e.jsx(p,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending activation requests"})]})}),y.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold mb-3 text-sm text-muted-foreground",children:"Processed Today"}),e.jsx("div",{className:"space-y-2",children:y.map(s=>{var a;return e.jsx(p,{className:"opacity-75",children:e.jsx(h,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s.status==="approved"?"bg-green-500":"bg-red-500"}`,children:s.status==="approved"?e.jsx(S,{className:"h-4 w-4 text-white"}):e.jsx(k,{className:"h-4 w-4 text-white"})}),e.jsx("span",{className:"text-sm",children:((a=s.profiles)==null?void 0:a.full_name)||"Partner"})]}),e.jsx(_,{variant:s.status==="approved"?"default":"destructive",children:s.status})]})})},s.id)})})]})]}),e.jsx(T,{})]})}export{G as default};
