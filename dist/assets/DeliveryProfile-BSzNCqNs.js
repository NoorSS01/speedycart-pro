import{p as se,u as te,a as ae,r as i,s as d,j as e,S as f,B as j,A as re,C as o,c as m,q as ne,t as le,U as I,v as ie,w as ce,x as de,k as O,y as oe,z as me,L as xe,D as v,E as N,F as ue,P as he,G as k,I as S,H as F,J as ge,K as pe,N as fe,m as u}from"./index-CWmUW0Oc.js";import{P as U}from"./power-BmAvBKYD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=se("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);function be(){var R,L;const{user:n,loading:C,signOut:z}=te(),h=ae(),[B,D]=i.useState(!0),[A,q]=i.useState(!1),[l,b]=i.useState({phone:"",full_name:"",email:"",username:null}),[c,H]=i.useState({today:0,week:0,month:0,allTime:0,todayDeliveries:0,totalDeliveries:0,avgRating:0}),[Y,G]=i.useState(!0),[a,g]=i.useState("none"),[y,T]=i.useState(!1);i.useEffect(()=>{if(!C){if(!n){h("/auth");return}W(),P()}},[n,C,h]);const W=async()=>{if(n){D(!0);try{const{data:s}=await d.from("profiles").select("phone, full_name, username").eq("id",n.id).single();if(s){const r=s;b({phone:r.phone||"",full_name:r.full_name||"",email:n.email||"",username:r.username||null})}const t=new Date,M=new Date(t);M.setHours(0,0,0,0);const w=new Date(t);w.setDate(w.getDate()-7);const _=new Date(t);_.setMonth(_.getMonth()-1);const{data:$}=await d.from("delivery_assignments").select("id, user_confirmed_at").eq("delivery_person_id",n.id).not("user_confirmed_at","is",null),x=$||[],E=x.filter(r=>r.user_confirmed_at&&new Date(r.user_confirmed_at)>=M),Q=x.filter(r=>r.user_confirmed_at&&new Date(r.user_confirmed_at)>=w),V=x.filter(r=>r.user_confirmed_at&&new Date(r.user_confirmed_at)>=_),{data:p}=await d.from("delivery_ratings").select("rating").eq("delivery_person_id",n.id),Z=p&&p.length>0?p.reduce((r,ee)=>r+ee.rating,0)/p.length:0;H({today:E.length*5,week:Q.length*5,month:V.length*5,allTime:x.length*5,todayDeliveries:E.length,totalDeliveries:x.length,avgRating:Math.round(Z*10)/10})}catch(s){console.error("Error fetching data:",s)}finally{D(!1)}}},J=async()=>{var s;if(n){q(!0);try{const{error:t}=await d.from("profiles").update({full_name:l.full_name,username:((s=l.username)==null?void 0:s.toLowerCase())||null}).eq("id",n.id);if(t)throw t;u.success("Profile updated!")}catch{u.error("Failed to update profile")}finally{q(!1)}}},K=async()=>{await z(),h("/auth")},P=async()=>{if(!n)return;const s=new Date().toISOString().split("T")[0];try{const{data:t}=await d.from("delivery_activations").select("status").eq("delivery_partner_id",n.id).eq("activation_date",s).maybeSingle();g(t?t.status:"none")}catch{console.log("Activation status not available"),g("none")}},X=async()=>{if(n){T(!0);try{const s=new Date().toISOString().split("T")[0],{error:t}=await d.from("delivery_activations").insert({delivery_partner_id:n.id,activation_date:s,status:"pending"});if((t==null?void 0:t.code)==="23505")u.info("You already requested activation today"),P();else{if(t)throw t;u.success("Activation request sent! Waiting for admin approval."),g("pending")}}catch(s){u.error("Failed to request activation"),console.error(s)}T(!1)}};return B?e.jsxs("div",{className:"min-h-screen bg-background p-4",children:[e.jsx(f,{className:"h-12 w-full mb-4"}),e.jsx(f,{className:"h-32 w-full mb-4 rounded-xl"}),e.jsx(f,{className:"h-48 w-full mb-4 rounded-xl"}),e.jsx(f,{className:"h-64 w-full rounded-xl"})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5 pb-8",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-background/80 backdrop-blur-xl border-b",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>h("/delivery"),children:e.jsx(re,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:"My Account"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(o,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ne,{className:"w-16 h-16 border-2 border-primary",children:e.jsx(le,{className:"bg-primary/10 text-primary text-xl",children:((L=(R=l.full_name)==null?void 0:R[0])==null?void 0:L.toUpperCase())||e.jsx(I,{className:"w-6 h-6"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-bold",children:l.full_name||"Delivery Partner"}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"})," ",l.phone||"No phone"]}),l.email&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"})," ",l.email]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-amber-500",children:[e.jsx(de,{className:"w-5 h-5 fill-current"}),e.jsx("span",{className:"text-lg font-bold",children:c.avgRating||"—"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rating"})]})]})})}),e.jsx(o,{className:a==="approved"?"border-green-500 bg-green-500/5":a==="pending"?"border-amber-500 bg-amber-500/5":"",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${a==="approved"?"bg-green-500":a==="pending"?"bg-amber-500":a==="rejected"?"bg-red-500":"bg-muted"}`,children:a==="approved"?e.jsx(O,{className:"w-6 h-6 text-white"}):a==="pending"?e.jsx(oe,{className:"w-6 h-6 text-white"}):a==="rejected"?e.jsx(me,{className:"w-6 h-6 text-white"}):e.jsx(U,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a==="approved"?"Active Today":a==="pending"?"Awaiting Approval":a==="rejected"?"Request Rejected":"Not Active"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a==="approved"?"You can receive orders":a==="pending"?"Admin will review shortly":a==="rejected"?"Contact admin for details":"Request to go active for today"})]})]}),a==="none"&&e.jsxs(j,{onClick:X,disabled:y,children:[y?e.jsx(xe,{className:"w-4 h-4 animate-spin"}):e.jsx(U,{className:"w-4 h-4 mr-2"}),y?"Requesting...":"Go Active"]})]})})}),e.jsxs(o,{className:"bg-primary/5 border-primary/20",children:[e.jsx(v,{className:"pb-2",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Earnings Overview"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",c.today]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",c.week]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This Week"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",c.month]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This Month"})]}),e.jsxs("div",{className:"bg-background rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["₹",c.allTime]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All Time"})]})]})})]}),e.jsxs(o,{children:[e.jsx(v,{className:"pb-2",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Delivery Statistics"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg",children:[e.jsx(he,{className:"w-8 h-8 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold",children:c.todayDeliveries}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Today"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(O,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold",children:c.totalDeliveries}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]})]})]})})]}),e.jsxs(o,{children:[e.jsx(v,{className:"pb-2",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Edit Profile"]})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Full Name"}),e.jsx(S,{value:l.full_name||"",onChange:s=>b({...l,full_name:s.target.value}),placeholder:"Your name"})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Username"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex items-center justify-center px-3 bg-muted border border-r-0 rounded-l-md text-sm font-medium text-muted-foreground",children:"@"}),e.jsx(S,{value:l.username||"",onChange:s=>b({...l,username:s.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"").slice(0,20)}),placeholder:"your_username",className:"rounded-l-none",maxLength:20})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Letters, numbers, underscores (3-20 chars)"})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Phone Number"}),e.jsx(S,{value:l.phone,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Contact support to change phone number"})]}),e.jsx(j,{onClick:J,disabled:A,className:"w-full",children:A?"Saving...":"Save Changes"})]})]}),e.jsxs(o,{children:[e.jsx(v,{className:"pb-2",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Settings"]})}),e.jsx(m,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Push Notifications"})]}),e.jsx(ge,{checked:Y,onCheckedChange:G})]})})]}),e.jsx(pe,{}),e.jsxs(j,{variant:"destructive",className:"w-full",onClick:K,children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})]})}export{be as default};
