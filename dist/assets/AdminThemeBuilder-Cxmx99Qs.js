import{m as T,u as ae,ap as se,a as te,r as m,s as h,l as I,h as c,j as e,S as b,B as x,A as re,d as k,aq as le,C,x as R,y as E,af as V,c as H,_ as ie,D as l,I as n,ae as ce,V as ne,ao as oe,am as de,ar as me,an as xe,a4 as ue,a5 as he,a6 as pe,a7 as ge,a8 as S,$ as ve,a0 as je,a1 as fe,a2 as be,aj as Ne,a3 as ye,as as _e}from"./index-BYO-trAT.js";import{T as we,a as ke,b as v,c as j}from"./tabs-CGOlFJLA.js";import{A as Ce}from"./AdminBottomNav-CXj_2t4k.js";import{P as O}from"./palette-CWx2x6Vz.js";import{F as Se}from"./flower-2-hG2dEXxU.js";import"./wallet-CZ5H2XR4.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=T("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=T("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=T("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),Ae=[{value:"none",label:"None",icon:$,description:"No animation effects"},{value:"snowfall",label:"Snowfall",icon:oe,description:"Gentle falling snow"},{value:"rain",label:"Rain",icon:de,description:"Soft rain streaks"},{value:"petals",label:"Petals",icon:Se,description:"Floating cherry blossoms"},{value:"leaves",label:"Leaves",icon:me,description:"Falling autumn leaves"},{value:"sparkles",label:"Sparkles",icon:xe,description:"Twinkling stars"},{value:"confetti",label:"Confetti",icon:Te,description:"Celebration confetti"}];function Ie(){const{user:D,userRole:A,loading:P}=ae(),{refreshTheme:N,exitPreviewMode:G,isPreviewMode:U}=se(),y=te(),[W,Y]=m.useState([]),[t,F]=m.useState(null),[Z,L]=m.useState(!0),[u,o]=m.useState(!1),[J,f]=m.useState(!1),[s,M]=m.useState({}),[_,w]=m.useState(!1),z=A==="admin"||A==="super_admin";m.useEffect(()=>{if(!P){if(!D||!z){y("/");return}p()}},[D,P,z,y]);const p=async()=>{try{L(!0);const{data:a,error:r}=await h.from("themes").select("*").order("is_active",{ascending:!1}).order("updated_at",{ascending:!1});if(r)throw r;const d=(a||[]).map(q=>({...q,is_active:q.is_active??!1}));Y(d),d.length>0&&!t&&B(d[0])}catch(a){I.error("Failed to fetch themes",{error:a}),c.error("Failed to load themes")}finally{L(!1)}},B=a=>{_&&!confirm("You have unsaved changes. Discard them?")||(F(a),M({...a}),w(!1),U&&G())},i=(a,r)=>{M(d=>({...d,[a]:r})),w(!0)},K=async()=>{if(!(!t||!s))try{o(!0);const a={name:s.name,description:s.description,primary_color:s.primary_color,secondary_color:s.secondary_color,accent_color:s.accent_color,background_gradient:s.background_gradient,animation_type:s.animation_type,animation_intensity:s.animation_intensity,promo_badge_text:s.promo_badge_text,promo_badge_color:s.promo_badge_color,updated_at:new Date().toISOString(),version:(t.version||0)+1},{error:r}=await h.from("themes").update(a).eq("id",t.id);if(r)throw r;c.success("Theme saved successfully"),w(!1),await p(),t.is_active&&await N()}catch(a){I.error("Failed to save theme",{error:a}),c.error("Failed to save theme")}finally{o(!1)}},Q=async a=>{try{o(!0),await h.from("themes").update({is_active:!1}).neq("id",a);const{error:r}=await h.from("themes").update({is_active:!0}).eq("id",a);if(r)throw r;c.success("Theme activated!"),await p(),await N()}catch{c.error("Failed to activate theme")}finally{o(!1)}},X=async a=>{try{o(!0);const{error:r}=await h.from("themes").update({is_active:!1}).eq("id",a);if(r)throw r;c.success("Theme deactivated"),await p(),await N()}catch{c.error("Failed to deactivate theme")}finally{o(!1)}},ee=async()=>{if(t)try{o(!0);const{error:a}=await h.from("themes").delete().eq("id",t.id);if(a)throw a;c.success("Theme deleted"),f(!1),F(null),await p()}catch{c.error("Failed to delete theme")}finally{o(!1)}},g=(()=>{if(!s.primary_color)return null;const a=_e(s.primary_color,"0 0% 100%"),r=a>=4.5;return{ratio:a.toFixed(2),passes:r}})();return Z?e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-3",children:[e.jsx(b,{className:"h-8 w-8"}),e.jsx(b,{className:"h-6 w-48"})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(b,{className:"h-96"}),e.jsx(b,{className:"h-96 lg:col-span-2"})]})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>y("/admin"),children:e.jsx(re,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Theme Builder"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enterprise visual customization"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_&&e.jsx(k,{variant:"outline",className:"text-amber-600 border-amber-600",children:"Unsaved Changes"}),t&&e.jsxs(x,{onClick:K,disabled:!_||u,size:"sm",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),u?"Saving...":"Save"]})]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(C,{children:[e.jsxs(R,{className:"pb-3",children:[e.jsx(E,{className:"text-sm",children:"Themes"}),e.jsx(V,{className:"text-xs",children:"Select a theme to edit"})]}),e.jsx(H,{className:"space-y-2",children:W.map(a=>e.jsxs("div",{onClick:()=>B(a),className:`
                      p-3 rounded-lg cursor-pointer transition-all
                      ${(t==null?void 0:t.id)===a.id?"bg-primary/10 border-2 border-primary":"bg-muted/50 hover:bg-muted border-2 border-transparent"}
                    `,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm",style:{backgroundColor:a.primary_color||void 0}}),e.jsx("span",{className:"text-sm font-medium",children:a.name})]}),a.is_active&&e.jsx(k,{variant:"default",className:"text-[10px] h-5",children:"Active"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-1",children:[a.type," â€¢ ",a.animation_type||"no animation"]})]},a.id))})]})}),e.jsx("div",{className:"lg:col-span-3",children:t?e.jsxs(C,{children:[e.jsx(R,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(E,{children:s.name||"Untitled Theme"}),e.jsxs(V,{className:"text-xs mt-1",children:[t.type," theme â€¢ v",t.version||1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.is_active?e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>X(t.id),disabled:u,children:[e.jsx($,{className:"h-4 w-4 mr-1"}),"Deactivate"]}):e.jsxs(x,{variant:"default",size:"sm",onClick:()=>Q(t.id),disabled:u,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Activate"]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>f(!0),className:"text-destructive hover:text-destructive",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})}),e.jsx(H,{children:e.jsxs(we,{defaultValue:"colors",className:"w-full",children:[e.jsxs(ke,{className:"grid w-full grid-cols-5 mb-6",children:[e.jsx(v,{value:"colors",children:"Colors"}),e.jsx(v,{value:"effects",children:"Effects"}),e.jsx(v,{value:"promo",children:"Promo"}),e.jsx(v,{value:"schedule",children:"Schedule"}),e.jsx(v,{value:"audit",children:"Audit"})]}),e.jsxs(j,{value:"colors",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Theme Name"}),e.jsx(n,{value:s.name||"",onChange:a=>i("name",a.target.value),placeholder:"My Awesome Theme"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm mb-2 block",children:"Primary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:s.primary_color||"#3b82f6",onChange:a=>i("primary_color",a.target.value),className:"h-10 w-14 rounded cursor-pointer"}),e.jsx(n,{value:s.primary_color||"",onChange:a=>i("primary_color",a.target.value),className:"uppercase"})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm mb-2 block",children:"Secondary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:s.secondary_color||"#1e40af",onChange:a=>i("secondary_color",a.target.value),className:"h-10 w-14 rounded cursor-pointer"}),e.jsx(n,{value:s.secondary_color||"",onChange:a=>i("secondary_color",a.target.value),className:"uppercase"})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm mb-2 block",children:"Accent Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:s.accent_color||"#60a5fa",onChange:a=>i("accent_color",a.target.value),className:"h-10 w-14 rounded cursor-pointer"}),e.jsx(n,{value:s.accent_color||"",onChange:a=>i("accent_color",a.target.value),className:"uppercase"})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border",children:[e.jsx(l,{className:"text-sm mb-3 block",children:"Color Preview"}),e.jsxs("div",{className:"flex gap-2 h-16 rounded-lg overflow-hidden shadow-inner",children:[e.jsx("div",{className:"flex-1",style:{backgroundColor:s.primary_color||"#ccc"}}),e.jsx("div",{className:"flex-1",style:{backgroundColor:s.secondary_color||"#aaa"}}),e.jsx("div",{className:"flex-1",style:{backgroundColor:s.accent_color||"#888"}})]})]}),g&&e.jsxs("div",{className:`p-3 rounded-lg ${g.passes?"bg-green-500/10":"bg-amber-500/10"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g.passes?e.jsx(ce,{className:"h-4 w-4 text-green-600"}):e.jsx(ne,{className:"h-4 w-4 text-amber-600"}),e.jsxs("span",{className:"text-sm font-medium",children:["Contrast Ratio: ",g.ratio,":1"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.passes?"Passes WCAG AA accessibility standards":"May not meet accessibility requirements (4.5:1 needed)"})]})]}),e.jsxs(j,{value:"effects",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Atmosphere Animation"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Ae.map(a=>{const r=a.icon,d=s.animation_type===a.value;return e.jsxs("div",{onClick:()=>i("animation_type",a.value),className:`
                                  p-3 rounded-lg cursor-pointer transition-all text-center
                                  ${d?"bg-primary/10 border-2 border-primary":"bg-muted/50 hover:bg-muted border-2 border-transparent"}
                                `,children:[e.jsx(r,{className:`h-6 w-6 mx-auto mb-2 ${d?"text-primary":"text-muted-foreground"}`}),e.jsx("p",{className:"text-sm font-medium",children:a.label}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]},a.value)})})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Animation Intensity"}),e.jsxs(ue,{value:s.animation_intensity||"medium",onValueChange:a=>i("animation_intensity",a),children:[e.jsx(he,{children:e.jsx(pe,{})}),e.jsxs(ge,{children:[e.jsx(S,{value:"low",children:"Low - Subtle, fewer particles"}),e.jsx(S,{value:"medium",children:"Medium - Balanced"}),e.jsx(S,{value:"high",children:"High - Rich atmosphere"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Background Gradient (optional)"}),e.jsx(n,{value:s.background_gradient||"",onChange:a=>i("background_gradient",a.target.value||null),placeholder:"linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%)"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"CSS gradient for background effect"})]})]}),e.jsx(j,{value:"promo",className:"space-y-6",children:e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Promotional Badge"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-1 block",children:"Badge Text"}),e.jsx(n,{value:s.promo_badge_text||"",onChange:a=>i("promo_badge_text",a.target.value||null),placeholder:"ðŸŽ‰ Sale"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-1 block",children:"Badge Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:s.promo_badge_color||"#ef4444",onChange:a=>i("promo_badge_color",a.target.value),className:"h-10 w-14 rounded cursor-pointer"}),e.jsx(n,{value:s.promo_badge_color||"",onChange:a=>i("promo_badge_color",a.target.value),className:"uppercase"})]})]})]}),s.promo_badge_text&&e.jsxs("div",{className:"mt-4 p-4 bg-muted/50 rounded-lg",children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-2 block",children:"Preview"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium text-white",style:{backgroundColor:s.promo_badge_color||"#ef4444"},children:s.promo_badge_text})]})]})}),e.jsx(j,{value:"schedule",className:"space-y-6",children:e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Scheduled Activation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Set a date range for automatic theme activation. The theme will automatically become active at the start date and deactivate at the end date."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-1 block",children:"Start Date"}),e.jsx(n,{type:"datetime-local",value:s.starts_at||s.schedule_starts_at||"",onChange:a=>i("starts_at",a.target.value||null)})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground mb-1 block",children:"End Date"}),e.jsx(n,{type:"datetime-local",value:s.ends_at||s.schedule_ends_at||"",onChange:a=>i("ends_at",a.target.value||null)})]})]}),(s.starts_at||s.schedule_starts_at)&&e.jsx("div",{className:"mt-4 p-3 bg-blue-500/10 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-600",children:"ðŸ“… This theme is scheduled to activate automatically."})})]})}),e.jsx(j,{value:"audit",className:"space-y-6",children:e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium mb-3 block",children:"Theme History"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Version ",(t==null?void 0:t.version)||1]}),e.jsx(k,{variant:"outline",children:"Current"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Last updated: ",t!=null&&t.updated_at?new Date(t.updated_at).toLocaleDateString():"Unknown"]})]}),((t==null?void 0:t.version)??0)>1&&e.jsxs("div",{className:"p-3 border rounded-lg opacity-60",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm",children:["Version ",((t==null?void 0:t.version)??1)-1]}),e.jsx(x,{variant:"ghost",size:"sm",disabled:!0,children:"Rollback"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Previous version"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Full audit log with rollback capabilities requires database migration. Current implementation tracks version numbers only."})]})})]})})]}):e.jsx(C,{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(O,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Select a theme to start editing"})]})})})]})}),e.jsx(ve,{open:J,onOpenChange:f,children:e.jsxs(je,{children:[e.jsxs(fe,{children:[e.jsx(be,{children:"Delete Theme?"}),e.jsxs(Ne,{children:['This action cannot be undone. The theme "',t==null?void 0:t.name,'" will be permanently deleted.']})]}),e.jsxs(ye,{children:[e.jsx(x,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(x,{variant:"destructive",onClick:ee,disabled:u,children:u?"Deleting...":"Delete Theme"})]})]})}),e.jsx(Ce,{})]})}export{Ie as default};
