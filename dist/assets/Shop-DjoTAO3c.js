import{c as ue,r,j as e,B as F,C as W,s as k,l as V,u as Ie,a as K,b as G,P as J,Z as Xe,S as Je,d as Ke,e as oe,f as O,T as et,g as tt,h as st,i as _e,U as rt,k as Ne,m as ke,M as Ce,n as de,o as Se,E as at,p as qe,q as nt,D as it,t as lt,v as ct,w as ot,L as Z,I as Pe,x as dt,F as ut,y as R}from"./index-CzqGsn4l.js";import{S as mt,a as ht,b as xt,c as ft,d as pt}from"./sheet-u2JDy9wS.js";import{H as De,S as gt}from"./HorizontalScrollContainer-BX43HbnN.js";import{O as jt,R as yt,a as Ae}from"./OrderConfirmation-BQuHxUoV.js";import{C as Te}from"./chevron-left-2S0FLKrO.js";import{u as vt}from"./useRecommendations-uglMf1oZ.js";import{P as wt}from"./party-popper-nBZljNdO.js";import{S as Ee}from"./sparkles-BKN8rhJQ.js";import{T as bt}from"./trash-2-Gw59I6Fz.js";import"./index-Cpbua6Wm.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=ue("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=ue("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=ue("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);function Ct(){const[a,c]=r.useState([]),[p,m]=r.useState(0),f=async()=>{try{const{data:i,error:g}=await k.from("promotional_banners").select("*").eq("is_active",!0).order("display_order",{ascending:!0});i&&!g&&c(i)}catch(i){V.debug("Promotional banners not available",{error:i})}},v=r.useCallback(()=>{m(i=>(i+1)%Math.max(a.length,1))},[a.length]),C=r.useCallback(()=>{m(i=>(i-1+a.length)%Math.max(a.length,1))},[a.length]);return r.useEffect(()=>{f()},[]),r.useEffect(()=>{if(a.length<=1)return;const i=setInterval(v,5e3);return()=>clearInterval(i)},[a.length,v]),a.length===0?null:e.jsxs("div",{className:"relative overflow-hidden rounded-xl mx-4 my-4",children:[e.jsx("div",{className:"flex transition-transform duration-500 ease-in-out",style:{transform:`translateX(-${p*100}%)`},children:a.map(i=>e.jsx("div",{className:"min-w-full px-1",children:e.jsxs("div",{className:"rounded-xl p-4 min-h-[80px] flex flex-col justify-center",style:{backgroundColor:i.background_color,color:i.text_color},children:[e.jsx("h3",{className:"font-bold text-lg",children:i.title}),i.subtitle&&e.jsx("p",{className:"text-sm opacity-90",children:i.subtitle})]})},i.id))}),a.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 h-8 w-8 rounded-full bg-white/80 hover:bg-white",onClick:C,children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(F,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 rounded-full bg-white/80 hover:bg-white",onClick:v,children:e.jsx(W,{className:"h-4 w-4"})})]}),a.length>1&&e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5",children:a.map((i,g)=>e.jsx("button",{className:`w-2 h-2 rounded-full transition-all ${g===p?"bg-white w-4":"bg-white/50"}`,onClick:()=>m(g)},g))})]})}function St({onAddToCart:a}){const{user:c}=Ie(),{getItemQuantity:p,updateQuantity:m}=K(),f=G(),[v,C]=r.useState([]),[i,g]=r.useState(!0),S=r.useRef(!0),E=r.useCallback(async()=>{if(!c){g(!1);return}try{const{data:q,error:s}=await k.rpc("get_buy_again_products",{p_user_id:c.id,p_limit:12});if(!s&&q&&q.length>0){const y=q.map(I=>({id:I.product_id,name:I.name,price:I.price,mrp:I.mrp,image_url:I.image_url,unit:I.unit,discount_percent:null,default_variant:null,purchaseCount:I.purchase_count,lastPurchasedAt:new Date(I.last_purchased_at),buyAgainScore:I.buy_again_score})),N=y.map(I=>I.id),{data:$}=await k.from("product_variants").select("*").in("product_id",N).eq("is_default",!0);$&&y.forEach(I=>{const L=$.find(H=>H.product_id===I.id);L&&(I.default_variant=L)}),S.current&&(C(y),g(!1));return}const{data:o}=await k.from("orders").select("id, created_at").eq("user_id",c.id).eq("status","delivered").order("created_at",{ascending:!1}).limit(50);if(!o||o.length===0){S.current&&(C([]),g(!1));return}const n=o.map(y=>y.id),j=new Map(o.map(y=>[y.id,new Date(y.created_at||Date.now())])),{data:b}=await k.from("order_items").select("product_id, order_id, quantity").in("order_id",n);if(!b||b.length===0){S.current&&(C([]),g(!1));return}const w=new Map,l=Date.now();b.forEach(y=>{const N=j.get(y.order_id)||new Date,$=w.get(y.product_id);$?w.set(y.product_id,{purchaseCount:$.purchaseCount+1,totalQuantity:$.totalQuantity+y.quantity,lastPurchased:N>$.lastPurchased?N:$.lastPurchased}):w.set(y.product_id,{purchaseCount:1,totalQuantity:y.quantity,lastPurchased:N})});const A=Math.max(...Array.from(w.values()).map(y=>y.purchaseCount),1),h=Array.from(w.entries()).map(([y,N])=>{const $=(l-N.lastPurchased.getTime())/864e5,I=Math.exp(-$/30),L=Math.min(N.purchaseCount/A,1),H=I*.6+L*.4;return{productId:y,...N,recencyScore:I,frequencyScore:L,finalScore:H}});h.sort((y,N)=>N.finalScore-y.finalScore);const u=h.slice(0,12).map(y=>y.productId);if(u.length===0){S.current&&(C([]),g(!1));return}const{data:T}=await k.from("products").select(`
                    id, name, price, mrp, image_url, unit, discount_percent,
                    product_variants!left(id, variant_name, variant_value, variant_unit, price, mrp, is_default)
                `).in("id",u).eq("is_active",!0).gt("stock_quantity",0);if(!T||T.length===0){S.current&&(C([]),g(!1));return}const Q=new Map(T.map(y=>[y.id,y])),z=[];h.forEach(y=>{const N=Q.get(y.productId);if(N&&z.length<10){const $=N.product_variants||[],I=$.find(L=>L.is_default)||$[0]||null;z.push({id:N.id,name:N.name,price:N.price,mrp:N.mrp,image_url:N.image_url,unit:N.unit||"piece",discount_percent:N.discount_percent,default_variant:I,purchaseCount:y.purchaseCount,lastPurchasedAt:y.lastPurchased,buyAgainScore:y.finalScore})}}),S.current&&C(z)}catch(q){V.error("BuyAgain fetch error",{error:q}),S.current&&C([])}finally{S.current&&g(!1)}},[c]);return r.useEffect(()=>(S.current=!0,c?E():g(!1),()=>{S.current=!1}),[c,E]),i||!c||v.length===0?null:e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 mb-3",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(kt,{className:"h-5 w-5 text-red-500 fill-red-500"}),"Buy Again"]}),e.jsxs("button",{onClick:()=>f("/orders"),className:"text-primary text-sm font-medium flex items-center gap-1 hover:underline",children:["View Orders ",e.jsx(W,{className:"h-4 w-4"})]})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto px-4 pb-2 scrollbar-hide",style:{scrollbarWidth:"none"},children:v.map(q=>e.jsx("div",{className:"flex-shrink-0 w-[150px]",children:e.jsx(J,{product:q,onAddToCart:a,cartQuantity:p(q.id,null),onQuantityChange:(s,o)=>m(s,null,o)})},q.id))})]})}function qt({categories:a,onCategorySelect:c}){const p=G();return a.length===0?null:e.jsxs("div",{className:"py-4 px-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-3",children:"Shop by Category"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 gap-4",children:a.map(m=>e.jsxs("button",{className:"flex flex-col items-center gap-2 group",onClick:()=>{c(m.id),p(`/shop?category=${m.id}`)},children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full overflow-hidden bg-gradient-to-br from-primary/10 to-primary/5 border-2 border-transparent group-hover:border-primary transition-all shadow-sm group-hover:shadow-md",children:m.image_url?e.jsx("img",{src:m.image_url,alt:m.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/10",children:e.jsx("span",{className:"text-2xl",children:"ðŸ›’"})})}),e.jsx("span",{className:"text-xs text-center font-medium text-muted-foreground group-hover:text-primary transition-colors line-clamp-2 max-w-[70px]",children:m.name})]},m.id))})]})}function Pt(){const a=G(),[c,p]=r.useState([]),[m,f]=r.useState(0),[v,C]=r.useState(!0);r.useEffect(()=>{(async()=>{try{const{data:o,error:n}=await k.from("hero_banners").select("*").eq("is_active",!0).order("display_order",{ascending:!0});o&&!n&&p(o)}catch{V.debug("Hero banners not available")}C(!1)})()},[]);const i=r.useCallback(()=>{f(s=>(s+1)%Math.max(c.length,1))},[c.length]),g=r.useCallback(()=>{f(s=>(s-1+c.length)%Math.max(c.length,1))},[c.length]);if(r.useEffect(()=>{if(c.length<=1)return;const s=setInterval(i,5e3);return()=>clearInterval(s)},[c.length,i]),v||c.length===0)return null;const S=s=>{switch(s.background_type){case"gradient":return{background:s.background_value};case"image":return{backgroundImage:`url(${s.background_value})`,backgroundSize:"cover",backgroundPosition:"center"};case"color":return{backgroundColor:s.background_value};default:return{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}},E=(s,o)=>{s.stopPropagation(),o&&(o.startsWith("http")?window.open(o,"_blank"):a(o))},q=s=>{if(!(!s.click_type||s.click_type==="none"||!s.click_target))switch(s.click_type){case"category":a(`/shop?category=${s.click_target}`);break;case"product":a(`/product/${s.click_target}`);break;case"url":s.click_target.startsWith("http")?window.open(s.click_target,"_blank"):a(s.click_target);break}};return e.jsxs("div",{className:"relative mx-4 my-4 overflow-hidden rounded-2xl",children:[e.jsx("div",{className:"flex transition-transform duration-500 ease-out",style:{transform:`translateX(-${m*100}%)`},children:c.map(s=>e.jsxs("div",{className:`min-w-full relative ${s.click_type&&s.click_type!=="none"&&s.click_target?"cursor-pointer":""}`,style:{...S(s),minHeight:s.height||"200px",borderRadius:s.border_radius||"16px",color:s.text_color||"#ffffff"},onClick:()=>q(s),children:[e.jsxs("div",{className:`h-full flex flex-col justify-center p-6 ${s.image_position==="right"?"pr-24 md:pr-48":""}`,style:{textAlign:s.text_align},children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2 leading-tight",children:s.title}),s.subtitle&&e.jsx("p",{className:"text-base md:text-lg opacity-90 mb-2",children:s.subtitle}),s.description&&e.jsx("p",{className:"text-sm opacity-80 mb-4",children:s.description}),s.button_text&&e.jsx("div",{children:e.jsx(F,{onClick:o=>E(o,s.button_link),style:{backgroundColor:s.button_bg_color,color:s.button_text_color},className:"px-6 py-2 rounded-full font-semibold shadow-lg hover:opacity-90 transition-opacity",children:s.button_text})})]}),s.image_url&&s.image_position!=="background"&&e.jsx("img",{src:s.image_url,alt:"",className:`absolute ${s.image_position==="right"?"right-2 top-1/2 -translate-y-1/2 h-4/5 max-w-[40%]":s.image_position==="left"?"left-2 top-1/2 -translate-y-1/2 h-4/5 max-w-[40%]":"left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-4/5"} object-contain`})]},s.id))}),c.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:g,className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/80 hover:bg-white flex items-center justify-center shadow-md transition-colors",children:e.jsx(Te,{className:"h-5 w-5 text-gray-700"})}),e.jsx("button",{onClick:i,className:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/80 hover:bg-white flex items-center justify-center shadow-md transition-colors",children:e.jsx(W,{className:"h-5 w-5 text-gray-700"})})]}),c.length>1&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2",children:c.map((s,o)=>e.jsx("button",{onClick:()=>f(o),className:`h-2 rounded-full transition-all ${o===m?"w-6 bg-white":"w-2 bg-white/50 hover:bg-white/70"}`},o))})]})}function At({onAddToCart:a}){const c=G(),{getItemQuantity:p,updateQuantity:m}=K(),[f,v]=r.useState([]),[C,i]=r.useState({}),[g,S]=r.useState({}),[E,q]=r.useState(!0),s=r.useCallback(async n=>{var j,b,w;try{let l=k.from("products").select(`
                    id, name, price, mrp, image_url, unit, discount_percent,
                    product_variants!left(price, mrp, variant_name, variant_value, variant_unit, is_default)
                `).eq("is_active",!0);switch(n.filter_type){case"discount":{const h=((j=n.filter_config)==null?void 0:j.min_discount)||0;l=l.gte("discount_percent",h);break}case"category":{const h=((b=n.filter_config)==null?void 0:b.category_ids)||[];h.length>0&&(l=l.in("category_id",h));break}case"manual":{const h=((w=n.filter_config)==null?void 0:w.product_ids)||[];h.length>0&&(l=l.in("id",h));break}}const{data:A}=await l.limit(n.max_products).order("discount_percent",{ascending:!1});if(A)return A.map(h=>{var u,T;return{...h,default_variant:((u=h.product_variants)==null?void 0:u.find(Q=>Q.is_default))||((T=h.product_variants)==null?void 0:T[0])||null}})}catch(l){V.error("Error fetching deal products",{error:l})}return[]},[]),o=r.useCallback(async()=>{try{const{data:n}=await k.from("flash_deals").select("*").eq("is_active",!0).lte("start_time",new Date().toISOString()).gte("end_time",new Date().toISOString()).order("display_order",{ascending:!0});if(n){const j=n;v(j);const b={};for(const w of j){const l=await s(w);b[w.id]=l}i(b)}}catch{V.debug("Flash deals not available")}q(!1)},[s]);return r.useEffect(()=>{o()},[o]),r.useEffect(()=>{const n=setInterval(()=>{const j={};f.forEach(b=>{const w=new Date(b.end_time).getTime(),l=Date.now(),A=w-l;if(A>0){const h=Math.floor(A/36e5),u=Math.floor(A%(1e3*60*60)/(1e3*60)),T=Math.floor(A%(1e3*60)/1e3);j[b.id]={h,m:u,s:T}}else j[b.id]={h:0,m:0,s:0}}),S(j)},1e3);return()=>clearInterval(n)},[f]),E||f.length===0?null:e.jsx("div",{className:"space-y-6",children:f.map(n=>{const j=C[n.id]||[],b=g[n.id]||{h:0,m:0,s:0};return j.length===0?null:e.jsxs("div",{className:"mx-4",children:[e.jsxs("div",{className:"rounded-t-2xl p-4",style:{backgroundColor:n.background_color,color:n.text_color},children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5 fill-current"}),e.jsx("span",{className:"font-bold text-lg",children:n.title}),n.badge_text&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-semibold",style:{backgroundColor:n.badge_color||void 0,color:"#ffffff"},children:n.badge_text})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:"Offer ends at"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"px-2 py-1 rounded font-mono font-bold text-sm",style:{backgroundColor:n.timer_bg_color,color:n.timer_text_color},children:String(b.h).padStart(2,"0")}),e.jsx("span",{className:"font-bold",children:":"}),e.jsx("span",{className:"px-2 py-1 rounded font-mono font-bold text-sm",style:{backgroundColor:n.timer_bg_color,color:n.timer_text_color},children:String(b.m).padStart(2,"0")}),e.jsx("span",{className:"font-bold",children:":"}),e.jsx("span",{className:"px-2 py-1 rounded font-mono font-bold text-sm",style:{backgroundColor:n.timer_bg_color,color:n.timer_text_color},children:String(b.s).padStart(2,"0")})]}),e.jsx("span",{className:"text-xs opacity-70",children:"HH : MM : SS"})]})]}),e.jsxs("div",{className:"bg-background rounded-b-2xl border border-t-0 p-3",children:[e.jsx(De,{className:"gap-3 pb-2",children:j.map(w=>e.jsx("div",{className:"flex-shrink-0 w-[calc((100vw-48px)/3)] min-w-[100px] max-w-[120px]",children:e.jsx(J,{product:w,onAddToCart:a,cartQuantity:p(w.id,null),onQuantityChange:(l,A)=>m(l,null,A)})},w.id))}),n.show_see_all&&e.jsxs("button",{onClick:()=>c(`/flash-deals/${n.id}`),className:"w-full text-center text-primary font-semibold text-sm py-2 mt-2 flex items-center justify-center gap-1 hover:underline",children:["See all ",e.jsx(W,{className:"h-4 w-4"})]})]})]},n.id)})})}function It({value:a,onChange:c,onFocus:p,onBlur:m,className:f=""}){const[v,C]=r.useState(["Milk","Bread","Eggs","Fruits","Vegetables"]),[i,g]=r.useState(0),[S,E]=r.useState(!1),[q,s]=r.useState(!1);r.useEffect(()=>{o()},[]);const o=async()=>{try{const{data:l}=await k.from("products").select("name").eq("is_active",!0).limit(20);if(l&&l.length>0){const h=l.map(u=>u.name).sort(()=>Math.random()-.5).slice(0,8);C(h)}}catch{V.debug("Could not fetch product names for animation")}};r.useEffect(()=>{if(q||a.length>0||v.length<=1)return;const l=setInterval(()=>{E(!0),setTimeout(()=>{g(A=>(A+1)%v.length),E(!1)},300)},3e3);return()=>clearInterval(l)},[q,a,v.length]);const n=r.useCallback(()=>{s(!0),p==null||p()},[p]),j=r.useCallback(()=>{s(!1),m==null||m()},[m]),b=v[i]||"products",w=!q&&a.length===0;return e.jsx("div",{className:`relative ${f}`,children:e.jsxs("div",{className:"relative flex items-center bg-muted/60 rounded-xl border border-border/50 overflow-hidden hover:border-primary/30 transition-colors",children:[e.jsx("div",{className:"pl-4 pr-2 flex items-center",children:e.jsx(Je,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("input",{type:"text",value:a,onChange:l=>c(l.target.value),onFocus:n,onBlur:j,className:"w-full py-3 pr-4 bg-transparent outline-none text-foreground placeholder-transparent",placeholder:"Search..."}),w&&e.jsxs("div",{className:"absolute left-12 top-1/2 -translate-y-1/2 pointer-events-none flex items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Search for "}),e.jsx("div",{className:"overflow-hidden h-6 flex items-center",children:e.jsx("div",{className:`transition-all duration-300 ease-in-out ${S?"transform -translate-y-full opacity-0":"transform translate-y-0 opacity-100"}`,children:e.jsxs("span",{className:"text-foreground font-medium",children:['"',b,'"']})})})]})]})})}function Dt({threshold:a=499,className:c}){const{freeDeliveryThreshold:p}=Ke(),{cartTotal:m}=K(),f=p||a,v=m>=f,C=Math.max(f-m,0),i=Math.min(m/f*100,100);return m===0?null:e.jsx("div",{className:oe("fixed bottom-20 left-1/2 -translate-x-1/2 z-40 transition-all duration-300 animate-in slide-in-from-bottom-4",c),children:e.jsxs("div",{className:oe("flex items-center gap-3 px-4 py-2.5 rounded-full shadow-lg backdrop-blur-sm",v?"bg-gradient-to-r from-green-600 to-emerald-500 text-white":"bg-gray-900/95 text-white"),children:[e.jsx("div",{className:oe("flex items-center justify-center w-8 h-8 rounded-full",v?"bg-white/20":"bg-primary/20"),children:v?e.jsx(wt,{className:"h-4 w-4 text-white"}):e.jsx(_t,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-sm",children:"Free delivery unlocked!"}),e.jsx(Ee,{className:"h-4 w-4 text-yellow-300 animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm",children:["Add ",e.jsxs("span",{className:"font-bold text-primary",children:["â‚¹",C.toFixed(0)]})," more for"]}),e.jsx("span",{className:"font-semibold text-sm text-green-400",children:"FREE delivery"})]})}),!v&&e.jsx("div",{className:"w-12 h-1.5 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-green-400 rounded-full transition-all duration-500",style:{width:`${i}%`}})})]})})}let X=null,se=0;const Tt=5*60*1e3;function Et(a=10){const[c,p]=r.useState([]),[m,f]=r.useState(!0),[v,C]=r.useState(null),i=r.useRef(!0),g=r.useCallback(async()=>{if(X&&Date.now()-se<Tt){p(X.slice(0,a)),f(!1);return}C(null);try{const{data:s,error:o}=await k.rpc("get_trending_products",{p_limit:a+5,p_days:7});if(!o&&s&&s.length>0){const w=s.map(l=>({id:l.product_id,name:l.name,price:l.price,mrp:l.mrp,image_url:l.image_url,unit:l.unit,stock_quantity:l.stock_quantity,category_id:null,discount_percent:null,trendScore:l.trend_score}));X=w,se=Date.now(),i.current&&(p(w.slice(0,a)),f(!1));return}const n=new Date(Date.now()-7*24*60*60*1e3),{data:j,error:b}=await k.from("order_items").select(`
                    product_id,
                    quantity,
                    created_at,
                    orders!inner(status)
                `).gte("created_at",n.toISOString()).eq("orders.status","delivered");if(b){const{data:w}=await k.from("order_items").select("product_id, quantity, created_at").gte("created_at",n.toISOString());if(!w||w.length===0){await E();return}await S(w);return}if(!j||j.length<5){await E();return}await S(j)}catch(s){V.error("Trending products error",{error:s}),i.current&&(C("Failed to load trending products"),p([]),f(!1))}},[a]),S=async s=>{const o=new Map,n=Date.now();s.forEach(h=>{const u=new Date(h.created_at).getTime(),T=(n-u)/(1e3*60*60*24),Q=Math.exp(-T/7),z=o.get(h.product_id)||{orderCount:0,quantity:0,score:0};o.set(h.product_id,{orderCount:z.orderCount+1,quantity:z.quantity+h.quantity,score:z.score+Q})});const j=Array.from(o.entries()).map(([h,u])=>({productId:h,finalScore:u.score*.7+Math.log1p(u.quantity)*.3,...u}));j.sort((h,u)=>u.finalScore-h.finalScore);const b=j.slice(0,a+5).map(h=>h.productId);if(b.length===0){await q();return}const{data:w}=await k.from("products").select("*").in("id",b).eq("is_active",!0).gt("stock_quantity",0);if(!w||w.length===0){await q();return}const l=new Map(w.map(h=>[h.id,h])),A=[];b.forEach(h=>{const u=l.get(h),T=j.find(Q=>Q.productId===h);u&&A.length<a&&A.push({...u,trendScore:T==null?void 0:T.finalScore,orderCount:T==null?void 0:T.orderCount})}),X=A,se=Date.now(),i.current&&(p(A),f(!1))},E=async()=>{const s=new Date(Date.now()-2592e6),{data:o}=await k.from("order_items").select("product_id, quantity, created_at").gte("created_at",s.toISOString());o&&o.length>0?await S(o):await q()},q=async()=>{const{data:s}=await k.from("products").select("*").eq("is_active",!0).gt("stock_quantity",0).order("created_at",{ascending:!1}).limit(a+5);if(s&&s.length>0){const o=Math.floor(Date.now()/864e5),j=Mt(s,o).slice(0,a).map(b=>({...b,trendScore:0,orderCount:0}));X=j,se=Date.now(),i.current&&p(j)}i.current&&f(!1)};return r.useEffect(()=>(i.current=!0,g(),()=>{i.current=!1}),[g]),{products:c,isLoading:m,error:v}}function Mt(a,c){const p=[...a];let m=c;for(let f=p.length-1;f>0;f--){m=m*1103515245+12345&2147483647;const v=m%(f+1);[p[f],p[v]]=[p[v],p[f]]}return p}function Ft({onAddToCart:a}){const c=G(),{getItemQuantity:p,updateQuantity:m}=K(),{products:f,isLoading:v,error:C}=Et(6);return v?e.jsxs("div",{className:"py-4 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(O,{className:"h-8 w-8 rounded-full"}),e.jsx(O,{className:"h-6 w-32"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Array.from({length:6}).map((i,g)=>e.jsx("div",{children:e.jsxs("div",{className:"rounded-2xl border-2 border-border/40 bg-card overflow-hidden",children:[e.jsx(O,{className:"aspect-square w-full"}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsx(O,{className:"h-3 w-3/4"}),e.jsx(O,{className:"h-4 w-12"})]})]})},g))}),e.jsx(O,{className:"h-10 w-full mt-3 rounded-lg"})]}):C||f.length===0?null:e.jsxs("div",{className:"py-4 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center shadow-lg",children:e.jsx(et,{className:"h-4 w-4 text-white"})}),e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-1",children:["Trending Now",e.jsx(Nt,{className:"h-4 w-4 text-orange-500 ml-1"})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.slice(0,6).map((i,g)=>e.jsxs("div",{className:"relative",children:[g<3&&e.jsx("div",{className:"absolute top-1 left-1 z-10 w-5 h-5 rounded-full bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center shadow-md text-white text-[10px] font-bold",children:g+1}),e.jsx(J,{product:{id:i.id,name:i.name,price:i.price,mrp:i.mrp??null,image_url:i.image_url,unit:i.unit,discount_percent:null,default_variant:null,stock_quantity:i.stock_quantity??void 0},onAddToCart:()=>a(i.id),cartQuantity:p(i.id,null),onQuantityChange:(S,E)=>m(S,null,E)})]},i.id))}),e.jsxs(F,{variant:"outline",className:"w-full mt-3 h-10 text-sm font-medium",onClick:()=>c("/shop?trending=true"),children:["See all trending products",e.jsx(W,{className:"h-4 w-4 ml-1"})]})]})}function Gt(){const{user:a,loading:c,signOut:p}=Ie(),{refreshCart:m,addToCart:f,getItemQuantity:v,updateQuantity:C,guestCartItems:i}=K(),g=G(),[S,E]=tt(),[q,s]=r.useState([]),o=S.get("category"),[n,j]=r.useState(o),[b,w]=r.useState([]),[l,A]=r.useState([]),h=S.get("search")||"",[u,T]=r.useState(h),[Q,z]=r.useState([]),[y,N]=r.useState(!1),[$,I]=r.useState(!0),[L,H]=r.useState(!1),[re,me]=r.useState(""),[ee,ae]=r.useState("saved"),[te,Me]=r.useState(""),[ne,Fe]=r.useState(""),[Oe,$e]=r.useState(""),[Be,Qe]=r.useState(""),[Ot,$t]=r.useState(""),[ze,ie]=r.useState(!1),[le,he]=r.useState(null),[Re,xe]=r.useState(!1),[fe,Le]=r.useState(null),{recommendedProducts:pe,trackView:Ve}=vt(),{isAtTop:He}=st();r.useEffect(()=>{const x=setTimeout(async()=>{if(u.trim().length<1){z([]),N(!1);return}const{data:d}=await k.from("products").select("id, name, price, mrp, image_url, unit, discount_percent, stock_quantity").ilike("name",`%${u.trim()}%`).eq("is_active",!0).gt("stock_quantity",0).limit(8);d&&d.length>0?(z(d.map(M=>({...M,stock_quantity:M.stock_quantity??0,unit:M.unit||"piece"}))),N(!0)):(z([]),N(!1))},100);return()=>clearTimeout(x)},[u]);const ge=r.useCallback(async()=>{const{data:t,error:x}=await k.from("categories").select("*").eq("is_active",!0).order("display_order");!x&&t&&s(t),I(!1)},[]),ce=r.useCallback(async()=>{let t=k.from("products").select("*").eq("is_active",!0);n&&(t=t.eq("category_id",n));const{data:x,error:d}=await t;if(!d&&x){const M=x.map(P=>P.id),{data:_}=await k.from("product_variants").select("*").in("product_id",M).eq("is_default",!0),D=x.map(P=>{const B=(_==null?void 0:_.find(Ze=>Ze.product_id===P.id))||null;return{...P,default_variant:B}});w(D.map(P=>({...P,stock_quantity:P.stock_quantity??0,unit:P.unit||"piece"})))}},[n]),U=r.useCallback(async()=>{if(!a)return;const{data:t,error:x}=await k.from("cart_items").select("*, products(*), product_variants(*)").eq("user_id",a.id);!x&&t&&A(t)},[a]),je=r.useCallback(async()=>{if(!a)return;const{data:t}=await k.from("profiles").select("address").eq("id",a.id).single();t!=null&&t.address?(me(t.address),ae("saved")):ae("new")},[a]);r.useEffect(()=>{const t=S.get("category");j(t)},[S]),r.useEffect(()=>{c||ce()},[n,c,ce]),r.useEffect(()=>{if(c)return;ge(),a&&(U(),je());const t=()=>ie(!0);return window.addEventListener("openCart",t),()=>window.removeEventListener("openCart",t)},[a,c,ge,U,je]);const Y=async t=>{await f(t,null)?a&&U():R.error("Failed to add to cart")},ye=async(t,x)=>{if(x<=0){await ve(t);return}const d=l.find(B=>B.id===t);if(!d)return;const{data:M,error:_}=await k.from("products").select("stock_quantity, name").eq("id",d.product_id).single();if(_||!M){R.error("Failed to check stock availability");return}const D=M.stock_quantity??0;if(x>D){if(R.error(`Only ${D} ${M.name} available`),D>0&&D!==d.quantity){const{error:B}=await k.from("cart_items").update({quantity:D}).eq("id",t);B||(U(),R.info(`Cart updated to maximum available (${D})`))}return}const{error:P}=await k.from("cart_items").update({quantity:x}).eq("id",t);P||U()},ve=async t=>{const{error:x}=await k.from("cart_items").delete().eq("id",t);x||(U(),R.success("Removed from cart"))},We=()=>{!a||l.length===0||(he(null),H(!0))},Ue=async()=>{if(!a)return;const t=le!==null;if(!t&&l.length===0){R.error("Your cart is empty");return}const x=ee==="saved"?re:te.trim();if(!x){R.error("Please provide a delivery address");return}try{ee==="new"&&te.trim()&&(await k.from("profiles").update({address:te.trim()}).eq("id",a.id),me(te.trim()));const d=t?[{product_id:le.id,quantity:1,variant_id:null,price:le.price}]:l.map(P=>{var B;return{product_id:P.product_id,quantity:P.quantity,variant_id:P.variant_id,price:((B=P.product_variants)==null?void 0:B.price)??P.products.price}}),{data:M,error:_}=await k.rpc("place_order_atomic",{p_user_id:a.id,p_delivery_address:x,p_cart_items:d,p_coupon_id:void 0,p_coupon_discount:0});if(_){V.error("Order placement error",{error:_}),R.error("Failed to place order. Please try again.");return}const D=M;if(!D.success){R.error(D.error||"Failed to place order");return}t||(A([]),m()),ce(),H(!1),ie(!1),he(null),Me(""),D.order_id&&(Le(D.order_id),xe(!0))}catch(d){V.error("Unexpected order placement error",{error:d}),R.error("An unexpected error occurred. Please try again.")}},we=b.filter(t=>t.name.toLowerCase().includes(u.toLowerCase())),Ye=l.reduce((t,x)=>t+x.products.price*x.quantity,0),Ge=i.reduce((t,x)=>{const d=b.find(M=>M.id===x.productId);return t+((d==null?void 0:d.price)||0)*x.quantity},0),be=a?Ye:Ge;return $?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl supports-[backdrop-filter]:bg-background/20 shadow-[0_10px_40px_rgba(15,23,42,0.35)]",children:e.jsx("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-6 w-6 rounded-md"}),e.jsx(O,{className:"h-6 w-32 rounded-md"})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx(O,{className:"h-10 w-full max-w-md mx-auto rounded-md"})}),e.jsx("div",{className:"container mx-auto px-4 pb-4",children:e.jsx("div",{className:"flex gap-2 overflow-hidden",children:[1,2,3,4,5].map(t=>e.jsx(O,{className:"h-9 w-24 rounded-full shrink-0"},t))})}),e.jsx("div",{className:"container mx-auto px-4 pb-8",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[1,2,3,4,5,6,7,8,9,10].map(t=>e.jsxs("div",{className:"rounded-2xl border-2 border-border/40 bg-card overflow-hidden",children:[e.jsx(O,{className:"aspect-square w-full"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx(O,{className:"h-4 w-3/4"}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{className:"h-5 w-16"}),e.jsx(O,{className:"h-3 w-10"})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(O,{className:"h-8 w-16 rounded-full"}),e.jsx(O,{className:"h-8 w-8 rounded-full"})]})]})]})]},t))})}),e.jsx(_e,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-20",children:[Re&&fe&&e.jsx(jt,{orderId:fe,onClose:()=>xe(!1)}),e.jsx("header",{className:`sticky top-0 z-40 border-b border-border/40 bg-background/95 backdrop-blur-xl supports-[backdrop-filter]:bg-background/80 shadow-sm transition-transform duration-300 ${He?"translate-y-0":"-translate-y-full"}`,children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/dist/logo.svg",alt:"PremaShop",className:"h-8 w-auto"}),e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"PremaShop"})]}),e.jsx("p",{className:"text-xs text-muted-foreground font-medium ml-8",children:"âš¡ Rapid Delivery in 14 mins"})]}),e.jsx(F,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full bg-primary/10 hover:bg-primary/20",onClick:()=>g(a?"/profile":"/auth"),"aria-label":"View Profile",children:e.jsx(rt,{className:"h-5 w-5 text-primary"})})]})})}),e.jsxs(mt,{open:ze,onOpenChange:ie,children:[e.jsx(ht,{asChild:!0,children:e.jsx("button",{id:"cart-trigger",className:"hidden"})}),e.jsxs(xt,{children:[e.jsx(ft,{children:e.jsx(pt,{children:"Your Cart"})}),e.jsx(gt,{className:"h-[calc(100vh-200px)] mt-4",children:l.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Your cart is empty"}):e.jsx("div",{className:"space-y-4",children:l.map(t=>e.jsx(Ne,{children:e.jsx(ke,{className:"p-4",children:e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:t.products.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["$",t.products.price," / ",t.products.unit]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(F,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:()=>ye(t.id,t.quantity-1),children:e.jsx(Ce,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center",children:t.quantity}),e.jsx(F,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:()=>ye(t.id,t.quantity+1),children:e.jsx(de,{className:"h-3 w-3"})}),e.jsx(F,{size:"icon",variant:"ghost",className:"h-7 w-7 ml-auto",onClick:()=>ve(t.id),children:e.jsx(bt,{className:"h-3 w-3"})})]})]})})})},t.id))})}),l.length>0&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-background border-t",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"font-bold text-lg",children:["$",be.toFixed(2)]})]}),e.jsx(F,{className:"w-full",onClick:We,children:"Place Order"})]})]})]}),e.jsx("div",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur-xl py-4",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"relative max-w-md mx-auto",children:[e.jsx(It,{value:u,onChange:t=>{T(t),t.trim().length>=2&&N(!0)},onFocus:()=>{u.trim().length>=2&&Q.length>0&&N(!0)},onBlur:()=>{setTimeout(()=>N(!1),200)}}),y&&Q.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-card border rounded-lg shadow-lg z-50 max-h-[300px] overflow-y-auto",children:Q.map(t=>e.jsxs("button",{className:"w-full flex items-center gap-3 p-3 hover:bg-muted transition-colors text-left",onClick:()=>{g(`/product/${t.id}`),N(!1)},children:[t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-10 h-10 rounded object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded bg-muted flex items-center justify-center",children:e.jsx(Se,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-primary font-semibold",children:["â‚¹",t.price]})]}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground shrink-0"})]},t.id))})]})})}),e.jsx("div",{className:"container mx-auto px-4 pb-4",children:e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:[e.jsx(F,{variant:n===null?"default":"outline",onClick:()=>{j(null),E({})},className:"rounded-full flex-shrink-0",children:"All"}),q.map(t=>e.jsx(F,{variant:n===t.id?"default":"outline",onClick:()=>{j(t.id),E({category:t.id})},className:"rounded-full flex-shrink-0 whitespace-nowrap",children:t.name},t.id))]})}),!u&&!n&&e.jsx(Pt,{}),!u&&!n&&e.jsx(At,{onAddToCart:Y}),!u&&!n&&e.jsx(Ct,{}),!u&&!n&&e.jsx(Ft,{onAddToCart:Y}),a&&pe.length>0&&!u&&!n&&e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 px-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg",children:e.jsx(Ee,{className:"h-4 w-4 text-white"})}),e.jsx("h2",{className:"text-lg font-bold",children:"For You"})]}),e.jsx("div",{className:"overflow-x-auto scrollbar-hide px-4 -mx-4",children:e.jsx("div",{className:"grid grid-rows-2 grid-flow-col gap-3 px-4 pb-2",style:{gridAutoColumns:"calc((100vw - 48px) / 3)"},children:pe.slice(0,12).map(t=>e.jsx("div",{className:"min-w-[100px] max-w-[120px]",children:e.jsx(J,{product:{id:t.id,name:t.name,price:t.price,mrp:t.mrp??null,image_url:t.image_url,unit:t.unit,discount_percent:t.discount_percent??null,default_variant:t.default_variant??null,stock_quantity:t.stock_quantity??void 0},onAddToCart:()=>{Ve(t.id),Y(t.id)},cartQuantity:v(t.id,null),onQuantityChange:(x,d)=>C(x,null,d)})},t.id))})})]}),!u&&!n&&q.filter(t=>t.shop_section_visible!==!1).map(t=>{const x=b.filter(d=>d.category_id===t.id);return x.length===0?null:e.jsxs("div",{className:"container mx-auto px-4 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:t.name}),e.jsxs("button",{onClick:()=>{j(t.id),E({category:t.id})},className:"text-sm text-primary font-medium hover:underline flex items-center gap-1",children:["See all",e.jsx(W,{className:"h-4 w-4"})]})]}),e.jsx(De,{className:"gap-3",children:x.slice(0,8).map(d=>e.jsx("div",{className:"flex-shrink-0 w-[calc((100vw-48px)/3)] min-w-[100px] max-w-[120px]",children:e.jsx(J,{product:{id:d.id,name:d.name,price:d.price,mrp:d.mrp??null,image_url:d.image_url,unit:d.unit,discount_percent:d.discount_percent,default_variant:d.default_variant,stock_quantity:d.stock_quantity},onAddToCart:()=>Y(d.id),cartQuantity:v(d.id,null),onQuantityChange:(M,_)=>C(M,null,_)})},d.id))})]},t.id)}),(u||n)&&e.jsx("div",{className:"container mx-auto px-4 pb-8",children:we.length===0?e.jsx(at,{title:u?"No products found":"No products in this category",description:u?`No results for "${u}"`:"Try selecting a different category"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:we.map(t=>{const x=t.stock_quantity<=0,d=t.stock_quantity>0&&t.stock_quantity<=5,M=t.stock_quantity>5&&t.stock_quantity<=10;return e.jsxs(Ne,{className:`overflow-hidden rounded-2xl border-2 bg-card/90 hover:shadow-xl transition-all relative ${x?"border-destructive/60 bg-destructive/5":d?"border-red-500/60 bg-red-50/50 dark:bg-red-950/20":M?"border-orange-400/60 bg-orange-50/50 dark:bg-orange-950/20":"border-border/40 hover:border-primary/40"}`,children:[(d||M)&&!x&&e.jsx("div",{className:`absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-bold ${d?"bg-red-500 text-white animate-pulse":"bg-orange-500 text-white"}`,children:d?`Only ${t.stock_quantity} left!`:`${t.stock_quantity} left`}),(()=>{const _=t.default_variant,D=(_==null?void 0:_.price)??t.price,P=(_==null?void 0:_.mrp)??t.mrp,B=P&&P>D?Math.round((P-D)/P*100):t.discount_percent||0;return B>0?e.jsxs("div",{className:"absolute top-2 left-2 z-10 px-2 py-1 rounded-md bg-gradient-to-r from-green-500 to-emerald-600 text-white text-xs font-bold shadow-lg",children:[B,"% OFF"]}):null})(),e.jsxs(ke,{className:"p-0",children:[e.jsx("div",{className:`aspect-square bg-muted flex items-center justify-center cursor-pointer ${x?"opacity-50":""}`,onClick:()=>g(`/product/${t.id}`),children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"}):e.jsx(Se,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm line-clamp-2 mb-1 cursor-pointer hover:text-primary transition-colors",onClick:()=>g(`/product/${t.id}`),children:t.name}),t.default_variant&&e.jsx("span",{className:"text-[10px] text-muted-foreground block mb-1",children:qe(t.default_variant)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:(()=>{const _=t.default_variant,D=(_==null?void 0:_.price)??t.price,P=(_==null?void 0:_.mrp)??t.mrp,B=_?qe(_):t.unit;return P&&P>D?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["â‚¹",D]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["â‚¹",P]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["/ ",B]})]})]}):t.discount_percent&&t.discount_percent>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["â‚¹",Math.round(t.price*(100-t.discount_percent)/100)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["â‚¹",t.price]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["/ ",t.unit]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["â‚¹",D]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["/ ",B]})]})})()}),(()=>{const _=v(t.id,null);return _>0?e.jsxs("div",{className:"flex items-center gap-0 rounded-full overflow-hidden border border-primary",children:[e.jsx(F,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none",onClick:()=>C(t.id,null,_-1),children:e.jsx(Ce,{className:"h-3 w-3"})}),e.jsx("span",{className:"px-2 font-bold text-sm min-w-[24px] text-center",children:_}),e.jsx(F,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none",onClick:()=>C(t.id,null,_+1),disabled:x,children:e.jsx(de,{className:"h-3 w-3"})})]}):e.jsx(F,{size:"icon",className:`h-9 w-9 rounded-full ${x?"opacity-50":""}`,onClick:()=>Y(t.id),disabled:x,children:e.jsx(de,{className:"h-4 w-4"})})})()]}),x&&e.jsx(nt,{variant:"destructive",className:"w-full mt-2 justify-center",children:"Out of Stock"}),d&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 font-medium mt-2 text-center",children:"ðŸ”¥ Hurry! Almost sold out"})]})]})]},t.id)})})}),!u&&!n&&e.jsx(St,{onAddToCart:Y}),!u&&!n&&e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx(qt,{categories:q,onCategorySelect:j})}),e.jsx(it,{open:L,onOpenChange:H,children:e.jsxs(lt,{className:"max-w-md",children:[e.jsx(ct,{children:e.jsx(ot,{children:"Select Delivery Address"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs(yt,{value:ee,onValueChange:t=>ae(t),children:[re&&e.jsxs("div",{className:"flex items-start space-x-3 p-4 border rounded-lg",children:[e.jsx(Ae,{value:"saved",id:"saved"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Z,{htmlFor:"saved",className:"font-medium cursor-pointer",children:"Use Saved Address"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:re})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-4 border rounded-lg",children:[e.jsx(Ae,{value:"new",id:"new"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Z,{htmlFor:"new",className:"font-medium cursor-pointer",children:"Enter New Address"}),ee==="new"&&e.jsxs("div",{className:"space-y-4 mt-3",children:[e.jsxs("div",{children:[e.jsx(Z,{className:"text-sm",children:"Apartment Complex"}),e.jsxs("select",{value:ne,onChange:t=>Fe(t.target.value),className:"w-full mt-1.5 p-2 border rounded-md bg-background text-sm",children:[e.jsx("option",{value:"",children:"Select your apartment..."}),e.jsx("option",{value:"VBHC Vaibhava",title:"VBHC Vaibhava, Chandapura-Anekal Road, Bangalore - 562106",children:"VBHC Vaibhava"}),e.jsx("option",{value:"Symphony",title:"Symphony, Chandapura-Anekal Road, Bangalore - 562106",children:"Symphony"})]}),ne&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["ðŸ“ ",ne,", Chandapura-Anekal Road, Bangalore - 562106"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(Z,{className:"text-sm",children:"Block/Tower"}),e.jsx(Pe,{placeholder:"e.g., 51",value:Oe,onChange:t=>$e(t.target.value),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(Z,{className:"text-sm",children:"Room Number"}),e.jsx(Pe,{placeholder:"e.g., 603",value:Be,onChange:t=>Qe(t.target.value),className:"mt-1.5"})]})]})]})]})]})]})}),e.jsxs(dt,{children:[e.jsx(F,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),e.jsx(F,{onClick:Ue,children:"Confirm Order"})]})]})}),e.jsx(ut,{}),e.jsx(Dt,{threshold:499,cartTotal:be}),e.jsx(_e,{})]})}export{Gt as default};
