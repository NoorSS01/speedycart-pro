import{ab as se,r as d,j as e,ac as B,ad as ae,a0 as te,a1 as re,a2 as ne,a3 as ie,B as P,ae as $,af as O,aa as oe,u as le,a as de,l as U,s as v,S as L,h as ce,C as q,c as F,G as me,T as ue,n as A}from"./index-BASgNFzI.js";import{A as z,W as xe}from"./AdminBottomNav-DtMwhqJL.js";import{C as pe}from"./circle-alert-DLXiMPOP.js";var R="Progress",T=100,[he,_e]=se(R),[fe,ge]=he(R),G=d.forwardRef((s,t)=>{const{__scopeProgress:c,value:n=null,max:r,getValueLabel:w=ve,...o}=s;(r||r===0)&&!V(r)&&console.error(je(`${r}`,"Progress"));const l=V(r)?r:T;n!==null&&!W(n,l)&&console.error(Ne(`${n}`,"Progress"));const i=W(n,l)?n:null,g=k(i)?w(i,l):void 0;return e.jsx(fe,{scope:c,value:i,max:l,children:e.jsx(B.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":k(i)?i:void 0,"aria-valuetext":g,role:"progressbar","data-state":Y(i,l),"data-value":i??void 0,"data-max":l,...o,ref:t})})});G.displayName=R;var X="ProgressIndicator",H=d.forwardRef((s,t)=>{const{__scopeProgress:c,...n}=s,r=ge(X,c);return e.jsx(B.div,{"data-state":Y(r.value,r.max),"data-value":r.value??void 0,"data-max":r.max,...n,ref:t})});H.displayName=X;function ve(s,t){return`${Math.round(s/t*100)}%`}function Y(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function k(s){return typeof s=="number"}function V(s){return k(s)&&!isNaN(s)&&s>0}function W(s,t){return k(s)&&!isNaN(s)&&s<=t&&s>=0}function je(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${T}\`.`}function Ne(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${T} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var J=G,ye=H;const K=d.forwardRef(({className:s,value:t,...c},n)=>e.jsx(J,{ref:n,className:ae("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...c,children:e.jsx(ye,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));K.displayName=J.displayName;function be({open:s,onOpenChange:t,upiId:c,payeeName:n,amount:r,onPaymentConfirmed:w}){const[o,l]=d.useState("initial"),[i,g]=d.useState(16),[x,j]=d.useState(0);d.useEffect(()=>{s&&(l("initial"),g(16),j(0))},[s]),d.useEffect(()=>{let p;return o==="waiting"&&i>0?p=setInterval(()=>{g(N=>{const D=N-.1;return D<0?0:D}),j(N=>N+100/(16*10))},100):o==="waiting"&&i<=0&&l("confirm"),()=>clearInterval(p)},[o,i]);const C=()=>`upi://pay?pa=${encodeURIComponent(c)}&pn=${encodeURIComponent(n)}&am=${r.toFixed(2)}&cu=INR&tn=${encodeURIComponent("SpeedyCart Payout")}`,E=()=>{const p=C();window.location.href=p,l("waiting")};return e.jsx(te,{open:s,onOpenChange:p=>{o==="waiting"&&p===!1||t(p)},children:e.jsxs(re,{className:"sm:max-w-md",children:[e.jsx(ne,{children:e.jsxs(ie,{children:["Pay ",n]})}),e.jsxs("div",{className:"py-6 flex flex-col items-center justify-center space-y-6 text-center",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-xl w-full",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Payable"}),e.jsxs("p",{className:"text-4xl font-bold text-primary",children:["₹",r.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 font-mono",children:c})]}),o==="initial"&&e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Click below to open your preferred UPI app. ",e.jsx("br",{}),"Please verify the UPI ID before paying."]}),e.jsxs(P,{size:"lg",className:"w-full text-lg h-12",onClick:E,children:[e.jsx($,{className:"mr-2 h-5 w-5"})," Pay Now"]})]}),o==="waiting"&&e.jsxs("div",{className:"w-full space-y-4 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"relative w-20 h-20 mx-auto flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-muted rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-t-primary rounded-full animate-spin"}),e.jsxs("span",{className:"font-bold text-xl",children:[Math.ceil(i),"s"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Waiting for Payment..."}),e.jsx("p",{className:"text-sm text-muted-foreground px-4",children:"Complete the payment in your UPI app. Do not verify anything yet. We will ask for confirmation shortly."})]}),e.jsx(K,{value:Math.min(x,100),className:"h-2 w-full"})]}),o==="confirm"&&e.jsxs("div",{className:"w-full space-y-4 animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(O,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Did you complete the payment?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The amount will be marked as paid and sent for approval."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full",children:[e.jsxs(P,{variant:"outline",size:"lg",onClick:()=>t(!1),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," No, I didn't"]}),e.jsxs(P,{size:"lg",className:"bg-green-600 hover:bg-green-700",onClick:w,children:[e.jsx(O,{className:"mr-2 h-4 w-4"})," Yes, I Paid"]})]})]})]})]})})}const Q="8310807978",we=`${Q}@ybl`,Ie=()=>{const{user:s,userRole:t,loading:c}=le(),n=de(),[r,w]=d.useState({deliveredOrders:0,totalDeveloperCommission:0,paidDeveloperCommission:0,pendingDeveloper:0}),[o,l]=d.useState([]),[i,g]=d.useState(!0),[x,j]=d.useState({open:!1,upiId:"",payeeName:"",amount:0,payeeId:null,type:"developer_commission"});d.useEffect(()=>{if(!c){if(!s){n("/auth");return}if(t!=="admin"&&t!=="super_admin"){n("/shop");return}C()}},[s,t,c,n]);const C=async()=>{g(!0);try{await Promise.all([E(),p()])}catch(a){U.error("Failed to load payment data",{error:a})}finally{g(!1)}},E=async()=>{const{data:a,error:u}=await v.from("orders").select("id").eq("status","delivered");if(u)throw u;const y=(a==null?void 0:a.length)||0,h=y*4,{data:f,error:m}=await v.from("payouts").select("amount").eq("type","developer_commission").neq("status","rejected");if(m)throw m;const b=(f==null?void 0:f.reduce((_,I)=>_+Number(I.amount),0))||0;w({deliveredOrders:y,totalDeveloperCommission:h,paidDeveloperCommission:b,pendingDeveloper:Math.max(0,h-b)})},p=async()=>{const{data:a,error:u}=await v.from("user_roles").select("user_id").eq("role","delivery");if(u||!a)return;const y=a.map(m=>m.user_id),{data:h}=await v.from("profiles").select("id, full_name, phone").in("id",y);if(!h)return;const f=[];for(const m of h){const{data:b}=await v.from("delivery_assignments").select("order_id, orders!inner(status)").eq("delivery_person_id",m.id).eq("orders.status","delivered"),_=(b==null?void 0:b.length)||0,I=_*5,{data:S}=await v.from("payouts").select("amount").eq("payee_id",m.id).eq("type","delivery_commission").neq("status","rejected"),M=(S==null?void 0:S.reduce((Z,ee)=>Z+Number(ee.amount),0))||0;f.push({id:m.id,full_name:m.full_name||"Delivery Partner",phone:m.phone||"",deliveredOrders:_,totalCommission:I,paidCommission:M,pendingAmount:Math.max(0,I-M)})}l(f)},N=(a,u,y,h,f)=>{if(h<=0){A.success("No pending payment!");return}const m=a===null?we:`${y}@upi`;j({open:!0,upiId:m,payeeName:u,amount:h,payeeId:a,type:f})},D=async()=>{try{const{error:a}=await v.from("payouts").insert({payer_id:s==null?void 0:s.id,payee_id:x.payeeId,amount:x.amount,status:"pending",type:x.type});if(a)throw a;A.success("Payment recorded! Waiting for approval."),j(u=>({...u,open:!1})),C()}catch(a){A.error("Failed to record payment"),U.error("Payment insert error",{error:a})}};return c||t===null||i?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(L,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2].map(a=>e.jsx(L,{className:"h-48 rounded-xl"},a))}),e.jsx(z,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(xe,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"Daily Payouts"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ce(new Date,"MMM dd, yyyy")})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider pl-1",children:"Platform Fees"}),e.jsxs(q,{className:"border-indigo-500/20 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-indigo-500 to-purple-600"}),e.jsxs(F,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-500/10 rounded-lg",children:e.jsx(me,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Developer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Commission (₹4/order)"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-indigo-600",children:["₹",r.pendingDeveloper.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-semibold",children:"Pending"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm bg-muted/40 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Earned"}),e.jsxs("p",{className:"font-semibold",children:["₹",r.totalDeveloperCommission]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Paid"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["₹",r.paidDeveloperCommission]})]})]}),e.jsxs(P,{className:"w-full bg-indigo-600 hover:bg-indigo-700",size:"lg",disabled:r.pendingDeveloper<=0,onClick:()=>N(null,"Developer",Q,r.pendingDeveloper,"developer_commission"),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Pay Remainder"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pl-1",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Delivery Partners"}),e.jsxs("span",{className:"text-xs bg-muted px-2 py-1 rounded-full",children:[o.length," Active"]})]}),o.map(a=>e.jsxs(q,{className:"border-rose-500/20 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-rose-400 to-orange-500"}),e.jsxs(F,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-rose-500/10 rounded-lg",children:e.jsx(ue,{className:"h-5 w-5 text-rose-600"})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("h3",{className:"font-bold text-lg truncate w-32 md:w-auto",children:a.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.phone})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-rose-600",children:["₹",a.pendingAmount.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-semibold",children:"Due Today"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm bg-muted/40 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Orders"}),e.jsx("p",{className:"font-semibold",children:a.deliveredOrders})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Paid So Far"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["₹",a.paidCommission]})]})]}),e.jsxs(P,{className:"w-full bg-rose-600 hover:bg-rose-700",size:"lg",disabled:a.pendingAmount<=0,onClick:()=>N(a.id,a.full_name,a.phone,a.pendingAmount,"delivery_commission"),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Pay Partner"]})]})]},a.id)),o.length===0&&e.jsxs("div",{className:"text-center py-8 bg-muted/20 rounded-xl",children:[e.jsx(pe,{className:"h-10 w-10 text-muted-foreground mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No active delivery partners found."})]})]})]}),e.jsx(z,{}),e.jsx(be,{open:x.open,onOpenChange:a=>j(u=>({...u,open:a})),upiId:x.upiId,payeeName:x.payeeName,amount:x.amount,onPaymentConfirmed:D})]})};export{Ie as default};
