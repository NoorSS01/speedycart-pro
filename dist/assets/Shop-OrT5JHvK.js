import{c as me,r,j as e,B as O,C as Y,s as C,l as V,u as De,a as J,b as K,P as X,Z as Xe,S as Je,d as Ke,e as de,f as $,T as et,g as tt,h as st,i as _e,U as rt,k as ke,m as Ce,M as Se,n as ue,o as qe,E as at,p as Pe,q as nt,D as it,t as lt,v as ot,w as ct,L as G,I as Ae,x as dt,F as ut,y as R}from"./index-DxtDyefn.js";import{S as mt,a as ht,b as xt,c as ft,d as pt}from"./sheet-CSIYxUuD.js";import{H as re,S as gt}from"./HorizontalScrollContainer-BhJqisC4.js";import{O as jt,R as yt,a as Ie}from"./OrderConfirmation-BzKyvCSv.js";import{C as Te}from"./chevron-left-4EX2BMqB.js";import{u as vt}from"./useRecommendations-BgdVzQzJ.js";import{P as bt}from"./party-popper-CA7TtbOI.js";import{S as Ee}from"./sparkles-CoOeEBHf.js";import{T as wt}from"./trash-2-CCx-cb9O.js";import"./index-Q_5-XCja.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=me("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=me("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=me("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);function Ct(){const[a,o]=r.useState([]),[g,u]=r.useState(0),f=async()=>{try{const{data:l,error:_}=await C.from("promotional_banners").select("*").eq("is_active",!0).order("display_order",{ascending:!0});l&&!_&&o(l)}catch(l){V.debug("Promotional banners not available",{error:l})}},v=r.useCallback(()=>{u(l=>(l+1)%Math.max(a.length,1))},[a.length]),p=r.useCallback(()=>{u(l=>(l-1+a.length)%Math.max(a.length,1))},[a.length]);return r.useEffect(()=>{f()},[]),r.useEffect(()=>{if(a.length<=1)return;const l=setInterval(v,5e3);return()=>clearInterval(l)},[a.length,v]),a.length===0?null:e.jsxs("div",{className:"relative overflow-hidden rounded-xl mx-4 my-4",children:[e.jsx("div",{className:"flex transition-transform duration-500 ease-in-out",style:{transform:`translateX(-${g*100}%)`},children:a.map(l=>e.jsx("div",{className:"min-w-full px-1",children:e.jsxs("div",{className:"rounded-xl p-4 min-h-[80px] flex flex-col justify-center",style:{backgroundColor:l.background_color,color:l.text_color},children:[e.jsx("h3",{className:"font-bold text-lg",children:l.title}),l.subtitle&&e.jsx("p",{className:"text-sm opacity-90",children:l.subtitle})]})},l.id))}),a.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 h-8 w-8 rounded-full bg-white/80 hover:bg-white",onClick:p,children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(O,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 rounded-full bg-white/80 hover:bg-white",onClick:v,children:e.jsx(Y,{className:"h-4 w-4"})})]}),a.length>1&&e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5",children:a.map((l,_)=>e.jsx("button",{className:`w-2 h-2 rounded-full transition-all ${_===g?"bg-white w-4":"bg-white/50"}`,onClick:()=>u(_)},_))})]})}function St({onAddToCart:a}){const{user:o}=De(),{getItemQuantity:g,updateQuantity:u}=J(),f=K(),[v,p]=r.useState([]),[l,_]=r.useState(!0),S=r.useRef(!0),M=r.useCallback(async()=>{if(!o){_(!1);return}try{const{data:q,error:s}=await C.rpc("get_buy_again_products",{p_user_id:o.id,p_limit:12});if(!s&&q&&q.length>0){const y=q.map(I=>({id:I.product_id,name:I.name,price:I.price,mrp:I.mrp,image_url:I.image_url,unit:I.unit,discount_percent:null,default_variant:null,purchaseCount:I.purchase_count,lastPurchasedAt:new Date(I.last_purchased_at),buyAgainScore:I.buy_again_score})),k=y.map(I=>I.id),{data:F}=await C.from("product_variants").select("*").in("product_id",k).eq("is_default",!0);F&&y.forEach(I=>{const L=F.find(H=>H.product_id===I.id);L&&(I.default_variant=L)}),S.current&&(p(y),_(!1));return}const{data:c}=await C.from("orders").select("id, created_at").eq("user_id",o.id).eq("status","delivered").order("created_at",{ascending:!1}).limit(50);if(!c||c.length===0){S.current&&(p([]),_(!1));return}const n=c.map(y=>y.id),j=new Map(c.map(y=>[y.id,new Date(y.created_at||Date.now())])),{data:w}=await C.from("order_items").select("product_id, order_id, quantity").in("order_id",n);if(!w||w.length===0){S.current&&(p([]),_(!1));return}const b=new Map,i=Date.now();w.forEach(y=>{const k=j.get(y.order_id)||new Date,F=b.get(y.product_id);F?b.set(y.product_id,{purchaseCount:F.purchaseCount+1,totalQuantity:F.totalQuantity+y.quantity,lastPurchased:k>F.lastPurchased?k:F.lastPurchased}):b.set(y.product_id,{purchaseCount:1,totalQuantity:y.quantity,lastPurchased:k})});const A=Math.max(...Array.from(b.values()).map(y=>y.purchaseCount),1),m=Array.from(b.entries()).map(([y,k])=>{const F=(i-k.lastPurchased.getTime())/864e5,I=Math.exp(-F/30),L=Math.min(k.purchaseCount/A,1),H=I*.6+L*.4;return{productId:y,...k,recencyScore:I,frequencyScore:L,finalScore:H}});m.sort((y,k)=>k.finalScore-y.finalScore);const h=m.slice(0,12).map(y=>y.productId);if(h.length===0){S.current&&(p([]),_(!1));return}const{data:T}=await C.from("products").select(`
                    id, name, price, mrp, image_url, unit, discount_percent,
                    product_variants!left(id, variant_name, variant_value, variant_unit, price, mrp, is_default)
                `).in("id",h).eq("is_active",!0).gt("stock_quantity",0);if(!T||T.length===0){S.current&&(p([]),_(!1));return}const Q=new Map(T.map(y=>[y.id,y])),z=[];m.forEach(y=>{const k=Q.get(y.productId);if(k&&z.length<10){const F=k.product_variants||[],I=F.find(L=>L.is_default)||F[0]||null;z.push({id:k.id,name:k.name,price:k.price,mrp:k.mrp,image_url:k.image_url,unit:k.unit||"piece",discount_percent:k.discount_percent,default_variant:I,purchaseCount:y.purchaseCount,lastPurchasedAt:y.lastPurchased,buyAgainScore:y.finalScore})}}),S.current&&p(z)}catch(q){V.error("BuyAgain fetch error",{error:q}),S.current&&p([])}finally{S.current&&_(!1)}},[o]);return r.useEffect(()=>(S.current=!0,o?M():_(!1),()=>{S.current=!1}),[o,M]),l||!o||v.length===0?null:e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 mb-3",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(kt,{className:"h-5 w-5 text-red-500 fill-red-500"}),"Buy Again"]}),e.jsxs("button",{onClick:()=>f("/orders"),className:"text-primary text-sm font-medium flex items-center gap-1 hover:underline",children:["View Orders ",e.jsx(Y,{className:"h-4 w-4"})]})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto px-4 pb-2 scrollbar-hide",style:{scrollbarWidth:"none"},children:v.map(q=>e.jsx("div",{className:"flex-shrink-0 w-[150px]",children:e.jsx(X,{product:q,onAddToCart:a,cartQuantity:g(q.id,null),onQuantityChange:(s,c)=>u(s,null,c)})},q.id))})]})}function qt({categories:a,onCategorySelect:o}){const g=K();return a.length===0?null:e.jsxs("div",{className:"py-4 px-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-3",children:"Shop by Category"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 gap-4",children:a.map(u=>e.jsxs("button",{className:"flex flex-col items-center gap-2 group",onClick:()=>{o(u.id),g(`/shop?category=${u.id}`)},children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full overflow-hidden bg-gradient-to-br from-primary/10 to-primary/5 border-2 border-transparent group-hover:border-primary transition-all shadow-sm group-hover:shadow-md",children:u.image_url?e.jsx("img",{src:u.image_url,alt:u.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/10",children:e.jsx("span",{className:"text-2xl",children:"ðŸ›’"})})}),e.jsx("span",{className:"text-xs text-center font-medium text-muted-foreground group-hover:text-primary transition-colors line-clamp-2 max-w-[70px]",children:u.name})]},u.id))})]})}function Pt(){const a=K(),[o,g]=r.useState([]),[u,f]=r.useState(0),[v,p]=r.useState(!0);r.useEffect(()=>{(async()=>{try{const{data:c,error:n}=await C.from("hero_banners").select("*").eq("is_active",!0).order("display_order",{ascending:!0});c&&!n&&g(c)}catch{V.debug("Hero banners not available")}p(!1)})()},[]);const l=r.useCallback(()=>{f(s=>(s+1)%Math.max(o.length,1))},[o.length]),_=r.useCallback(()=>{f(s=>(s-1+o.length)%Math.max(o.length,1))},[o.length]);if(r.useEffect(()=>{if(o.length<=1)return;const s=setInterval(l,5e3);return()=>clearInterval(s)},[o.length,l]),v||o.length===0)return null;const S=s=>{switch(s.background_type){case"gradient":return{background:s.background_value};case"image":return{backgroundImage:`url(${s.background_value})`,backgroundSize:"cover",backgroundPosition:"center"};case"color":return{backgroundColor:s.background_value};default:return{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}},M=(s,c)=>{s.stopPropagation(),c&&(c.startsWith("http")?window.open(c,"_blank"):a(c))},q=s=>{if(!(!s.click_type||s.click_type==="none"||!s.click_target))switch(s.click_type){case"category":a(`/shop?category=${s.click_target}`);break;case"product":a(`/product/${s.click_target}`);break;case"url":s.click_target.startsWith("http")?window.open(s.click_target,"_blank"):a(s.click_target);break}};return e.jsxs("div",{className:"relative mx-4 my-4 overflow-hidden rounded-2xl",children:[e.jsx("div",{className:"flex transition-transform duration-500 ease-out",style:{transform:`translateX(-${u*100}%)`},children:o.map(s=>e.jsxs("div",{className:`min-w-full relative ${s.click_type&&s.click_type!=="none"&&s.click_target?"cursor-pointer":""}`,style:{...S(s),minHeight:s.height||"200px",borderRadius:s.border_radius||"16px",color:s.text_color||"#ffffff"},onClick:()=>q(s),children:[e.jsxs("div",{className:`h-full flex flex-col justify-center p-6 ${s.image_position==="right"?"pr-24 md:pr-48":""}`,style:{textAlign:s.text_align},children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2 leading-tight",children:s.title}),s.subtitle&&e.jsx("p",{className:"text-base md:text-lg opacity-90 mb-2",children:s.subtitle}),s.description&&e.jsx("p",{className:"text-sm opacity-80 mb-4",children:s.description}),s.button_text&&e.jsx("div",{children:e.jsx(O,{onClick:c=>M(c,s.button_link),style:{backgroundColor:s.button_bg_color,color:s.button_text_color},className:"px-6 py-2 rounded-full font-semibold shadow-lg hover:opacity-90 transition-opacity",children:s.button_text})})]}),s.image_url&&s.image_position!=="background"&&e.jsx("img",{src:s.image_url,alt:"",className:`absolute ${s.image_position==="right"?"right-2 top-1/2 -translate-y-1/2 h-4/5 max-w-[40%]":s.image_position==="left"?"left-2 top-1/2 -translate-y-1/2 h-4/5 max-w-[40%]":"left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-4/5"} object-contain`})]},s.id))}),o.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:_,className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/80 hover:bg-white flex items-center justify-center shadow-md transition-colors",children:e.jsx(Te,{className:"h-5 w-5 text-gray-700"})}),e.jsx("button",{onClick:l,className:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/80 hover:bg-white flex items-center justify-center shadow-md transition-colors",children:e.jsx(Y,{className:"h-5 w-5 text-gray-700"})})]}),o.length>1&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2",children:o.map((s,c)=>e.jsx("button",{onClick:()=>f(c),className:`h-2 rounded-full transition-all ${c===u?"w-6 bg-white":"w-2 bg-white/50 hover:bg-white/70"}`},c))})]})}function At({onAddToCart:a}){const o=K(),{getItemQuantity:g,updateQuantity:u}=J(),[f,v]=r.useState([]),[p,l]=r.useState({}),[_,S]=r.useState({}),[M,q]=r.useState(!0),s=r.useCallback(async n=>{var j,w,b;try{let i=C.from("products").select(`
                    id, name, price, mrp, image_url, unit, discount_percent,
                    product_variants!left(price, mrp, variant_name, variant_value, variant_unit, is_default)
                `).eq("is_active",!0);switch(n.filter_type){case"discount":{const m=((j=n.filter_config)==null?void 0:j.min_discount)||0;i=i.gte("discount_percent",m);break}case"category":{const m=((w=n.filter_config)==null?void 0:w.category_ids)||[];m.length>0&&(i=i.in("category_id",m));break}case"manual":{const m=((b=n.filter_config)==null?void 0:b.product_ids)||[];m.length>0&&(i=i.in("id",m));break}}const{data:A}=await i.limit(n.max_products).order("discount_percent",{ascending:!1});if(A)return A.map(m=>{var h,T;return{...m,default_variant:((h=m.product_variants)==null?void 0:h.find(Q=>Q.is_default))||((T=m.product_variants)==null?void 0:T[0])||null}})}catch(i){V.error("Error fetching deal products",{error:i})}return[]},[]),c=r.useCallback(async()=>{try{const{data:n}=await C.from("flash_deals").select("*").eq("is_active",!0).lte("start_time",new Date().toISOString()).gte("end_time",new Date().toISOString()).order("display_order",{ascending:!0});if(n){const j=n;v(j);const w={};for(const b of j){const i=await s(b);w[b.id]=i}l(w)}}catch{V.debug("Flash deals not available")}q(!1)},[s]);return r.useEffect(()=>{c()},[c]),r.useEffect(()=>{const n=setInterval(()=>{const j={};f.forEach(w=>{const b=new Date(w.end_time).getTime(),i=Date.now(),A=b-i;if(A>0){const m=Math.floor(A/36e5),h=Math.floor(A%(1e3*60*60)/(1e3*60)),T=Math.floor(A%(1e3*60)/1e3);j[w.id]={h:m,m:h,s:T}}else j[w.id]={h:0,m:0,s:0}}),S(j)},1e3);return()=>clearInterval(n)},[f]),M||f.length===0?null:e.jsx("div",{className:"space-y-6",children:f.map(n=>{const j=p[n.id]||[],w=_[n.id]||{h:0,m:0,s:0};return j.length===0?null:e.jsxs("div",{className:"mx-4",children:[e.jsxs("div",{className:"rounded-t-2xl p-4",style:{backgroundColor:n.background_color,color:n.text_color},children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5 fill-current"}),e.jsx("span",{className:"font-bold text-lg",children:n.title}),n.badge_text&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-semibold",style:{backgroundColor:n.badge_color||void 0,color:"#ffffff"},children:n.badge_text})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:"Offer ends at"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"px-2 py-1 rounded font-mono font-bold text-sm",style:{backgroundColor:n.timer_bg_color,color:n.timer_text_color},children:String(w.h).padStart(2,"0")}),e.jsx("span",{className:"font-bold",children:":"}),e.jsx("span",{className:"px-2 py-1 rounded font-mono font-bold text-sm",style:{backgroundColor:n.timer_bg_color,color:n.timer_text_color},children:String(w.m).padStart(2,"0")}),e.jsx("span",{className:"font-bold",children:":"}),e.jsx("span",{className:"px-2 py-1 rounded font-mono font-bold text-sm",style:{backgroundColor:n.timer_bg_color,color:n.timer_text_color},children:String(w.s).padStart(2,"0")})]}),e.jsx("span",{className:"text-xs opacity-70",children:"HH : MM : SS"})]})]}),e.jsxs("div",{className:"bg-background rounded-b-2xl border border-t-0 p-3",children:[e.jsx(re,{className:"gap-3 pb-2",children:j.map(b=>e.jsx("div",{className:"flex-shrink-0 w-[calc((100vw-48px)/3)] min-w-[100px] max-w-[120px]",children:e.jsx(X,{product:b,onAddToCart:a,cartQuantity:g(b.id,null),onQuantityChange:(i,A)=>u(i,null,A)})},b.id))}),n.show_see_all&&e.jsxs("button",{onClick:()=>o(`/flash-deals/${n.id}`),className:"w-full text-center text-primary font-semibold text-sm py-2 mt-2 flex items-center justify-center gap-1 hover:underline",children:["See all ",e.jsx(Y,{className:"h-4 w-4"})]})]})]},n.id)})})}function It({value:a,onChange:o,onFocus:g,onBlur:u,className:f=""}){const[v,p]=r.useState(["Milk","Bread","Eggs","Fruits","Vegetables"]),[l,_]=r.useState(0),[S,M]=r.useState(!1),[q,s]=r.useState(!1);r.useEffect(()=>{c()},[]);const c=async()=>{try{const{data:i}=await C.from("products").select("name").eq("is_active",!0).limit(20);if(i&&i.length>0){const m=i.map(h=>h.name).sort(()=>Math.random()-.5).slice(0,8);p(m)}}catch{V.debug("Could not fetch product names for animation")}};r.useEffect(()=>{if(q||a.length>0||v.length<=1)return;const i=setInterval(()=>{M(!0),setTimeout(()=>{_(A=>(A+1)%v.length),M(!1)},300)},3e3);return()=>clearInterval(i)},[q,a,v.length]);const n=r.useCallback(()=>{s(!0),g==null||g()},[g]),j=r.useCallback(()=>{s(!1),u==null||u()},[u]),w=v[l]||"products",b=!q&&a.length===0;return e.jsx("div",{className:`relative ${f}`,children:e.jsxs("div",{className:"relative flex items-center bg-muted/60 rounded-xl border border-border/50 overflow-hidden hover:border-primary/30 transition-colors",children:[e.jsx("div",{className:"pl-4 pr-2 flex items-center",children:e.jsx(Je,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("input",{type:"text",value:a,onChange:i=>o(i.target.value),onFocus:n,onBlur:j,className:"w-full py-3 pr-4 bg-transparent outline-none text-foreground placeholder-transparent",placeholder:"Search..."}),b&&e.jsxs("div",{className:"absolute left-12 top-1/2 -translate-y-1/2 pointer-events-none flex items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Search for "}),e.jsx("div",{className:"overflow-hidden h-6 flex items-center",children:e.jsx("div",{className:`transition-all duration-300 ease-in-out ${S?"transform -translate-y-full opacity-0":"transform translate-y-0 opacity-100"}`,children:e.jsxs("span",{className:"text-foreground font-medium",children:['"',w,'"']})})})]})]})})}function Dt({threshold:a=499,className:o}){const{freeDeliveryThreshold:g}=Ke(),{cartTotal:u}=J(),f=g||a,v=u>=f,p=Math.max(f-u,0),l=Math.min(u/f*100,100);return u===0?null:e.jsx("div",{className:de("fixed bottom-20 left-1/2 -translate-x-1/2 z-40 transition-all duration-300 animate-in slide-in-from-bottom-4",o),children:e.jsxs("div",{className:de("flex items-center gap-3 px-4 py-2.5 rounded-full shadow-lg backdrop-blur-sm",v?"bg-gradient-to-r from-green-600 to-emerald-500 text-white":"bg-gray-900/95 text-white"),children:[e.jsx("div",{className:de("flex items-center justify-center w-8 h-8 rounded-full",v?"bg-white/20":"bg-primary/20"),children:v?e.jsx(bt,{className:"h-4 w-4 text-white"}):e.jsx(Nt,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-sm",children:"Free delivery unlocked!"}),e.jsx(Ee,{className:"h-4 w-4 text-yellow-300 animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm",children:["Add ",e.jsxs("span",{className:"font-bold text-primary",children:["â‚¹",p.toFixed(0)]})," more for"]}),e.jsx("span",{className:"font-semibold text-sm text-green-400",children:"FREE delivery"})]})}),!v&&e.jsx("div",{className:"w-12 h-1.5 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-green-400 rounded-full transition-all duration-500",style:{width:`${l}%`}})})]})})}let Z=null,se=0;const Tt=5*60*1e3;function Et(a=10){const[o,g]=r.useState([]),[u,f]=r.useState(!0),[v,p]=r.useState(null),l=r.useRef(!0),_=r.useCallback(async()=>{if(Z&&Date.now()-se<Tt){g(Z.slice(0,a)),f(!1);return}p(null);try{const{data:s,error:c}=await C.rpc("get_trending_products",{p_limit:a+5,p_days:7});if(!c&&s&&s.length>0){const b=s.map(i=>({id:i.product_id,name:i.name,price:i.price,mrp:i.mrp,image_url:i.image_url,unit:i.unit,stock_quantity:i.stock_quantity,category_id:null,discount_percent:null,trendScore:i.trend_score}));Z=b,se=Date.now(),l.current&&(g(b.slice(0,a)),f(!1));return}const n=new Date(Date.now()-7*24*60*60*1e3),{data:j,error:w}=await C.from("order_items").select(`
                    product_id,
                    quantity,
                    created_at,
                    orders!inner(status)
                `).gte("created_at",n.toISOString()).eq("orders.status","delivered");if(w){const{data:b}=await C.from("order_items").select("product_id, quantity, created_at").gte("created_at",n.toISOString());if(!b||b.length===0){await M();return}await S(b);return}if(!j||j.length<5){await M();return}await S(j)}catch(s){V.error("Trending products error",{error:s}),l.current&&(p("Failed to load trending products"),g([]),f(!1))}},[a]),S=async s=>{const c=new Map,n=Date.now();s.forEach(m=>{const h=new Date(m.created_at).getTime(),T=(n-h)/(1e3*60*60*24),Q=Math.exp(-T/7),z=c.get(m.product_id)||{orderCount:0,quantity:0,score:0};c.set(m.product_id,{orderCount:z.orderCount+1,quantity:z.quantity+m.quantity,score:z.score+Q})});const j=Array.from(c.entries()).map(([m,h])=>({productId:m,finalScore:h.score*.7+Math.log1p(h.quantity)*.3,...h}));j.sort((m,h)=>h.finalScore-m.finalScore);const w=j.slice(0,a+5).map(m=>m.productId);if(w.length===0){await q();return}const{data:b}=await C.from("products").select("*").in("id",w).eq("is_active",!0).gt("stock_quantity",0);if(!b||b.length===0){await q();return}const i=new Map(b.map(m=>[m.id,m])),A=[];w.forEach(m=>{const h=i.get(m),T=j.find(Q=>Q.productId===m);h&&A.length<a&&A.push({...h,trendScore:T==null?void 0:T.finalScore,orderCount:T==null?void 0:T.orderCount})}),Z=A,se=Date.now(),l.current&&(g(A),f(!1))},M=async()=>{const s=new Date(Date.now()-2592e6),{data:c}=await C.from("order_items").select("product_id, quantity, created_at").gte("created_at",s.toISOString());c&&c.length>0?await S(c):await q()},q=async()=>{const{data:s}=await C.from("products").select("*").eq("is_active",!0).gt("stock_quantity",0).order("created_at",{ascending:!1}).limit(a+5);if(s&&s.length>0){const c=Math.floor(Date.now()/864e5),j=Mt(s,c).slice(0,a).map(w=>({...w,trendScore:0,orderCount:0}));Z=j,se=Date.now(),l.current&&g(j)}l.current&&f(!1)};return r.useEffect(()=>(l.current=!0,_(),()=>{l.current=!1}),[_]),{products:o,isLoading:u,error:v}}function Mt(a,o){const g=[...a];let u=o;for(let f=g.length-1;f>0;f--){u=u*1103515245+12345&2147483647;const v=u%(f+1);[g[f],g[v]]=[g[v],g[f]]}return g}function Ft({onAddToCart:a}){const{getItemQuantity:o,updateQuantity:g}=J(),{products:u,isLoading:f,error:v}=Et(10);return f?e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 px-4",children:[e.jsx($,{className:"h-8 w-8 rounded-full"}),e.jsx($,{className:"h-6 w-32"})]}),e.jsx("div",{className:"flex gap-3 overflow-hidden px-4",children:[1,2,3,4].map(p=>e.jsx("div",{className:"flex-shrink-0 w-[150px]",children:e.jsxs("div",{className:"rounded-2xl border-2 border-border/40 bg-card overflow-hidden",children:[e.jsx($,{className:"aspect-square w-full"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx($,{className:"h-4 w-3/4"}),e.jsx($,{className:"h-5 w-16"})]})]})},p))})]}):v||u.length===0?null:e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 px-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center shadow-lg",children:e.jsx(et,{className:"h-4 w-4 text-white"})}),e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-1",children:["Trending Now",e.jsx(_t,{className:"h-4 w-4 text-orange-500 ml-1"})]})]}),e.jsx(re,{className:"gap-3",children:u.map((p,l)=>e.jsxs("div",{className:"flex-shrink-0 w-[150px] relative",children:[l<3&&e.jsx("div",{className:"absolute -top-1 -left-1 z-10 w-6 h-6 rounded-full bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center shadow-lg text-white text-xs font-bold",children:l+1}),e.jsx(X,{product:{...p,mrp:p.mrp??null,stock_quantity:p.stock_quantity??void 0,default_variant:null},onAddToCart:()=>a(p.id),cartQuantity:o(p.id,null),onQuantityChange:(_,S)=>g(_,null,S)})]},p.id))})]})}function Gt(){const{user:a,loading:o,signOut:g}=De(),{refreshCart:u,addToCart:f,getItemQuantity:v,updateQuantity:p,guestCartItems:l}=J(),_=K(),[S,M]=tt(),[q,s]=r.useState([]),c=S.get("category"),[n,j]=r.useState(c),[w,b]=r.useState([]),[i,A]=r.useState([]),m=S.get("search")||"",[h,T]=r.useState(m),[Q,z]=r.useState([]),[y,k]=r.useState(!1),[F,I]=r.useState(!0),[L,H]=r.useState(!1),[ae,he]=r.useState(""),[ee,ne]=r.useState("saved"),[te,Me]=r.useState(""),[ie,Fe]=r.useState(""),[Oe,$e]=r.useState(""),[Be,Qe]=r.useState(""),[Ot,$t]=r.useState(""),[ze,le]=r.useState(!1),[oe,xe]=r.useState(null),[Re,fe]=r.useState(!1),[pe,Le]=r.useState(null),{recommendedProducts:ge,trackView:Ve}=vt(),{isAtTop:He}=st();r.useEffect(()=>{const x=setTimeout(async()=>{if(h.trim().length<1){z([]),k(!1);return}const{data:d}=await C.from("products").select("id, name, price, mrp, image_url, unit, discount_percent, stock_quantity").ilike("name",`%${h.trim()}%`).eq("is_active",!0).gt("stock_quantity",0).limit(8);d&&d.length>0?(z(d.map(E=>({...E,stock_quantity:E.stock_quantity??0,unit:E.unit||"piece"}))),k(!0)):(z([]),k(!1))},100);return()=>clearTimeout(x)},[h]);const je=r.useCallback(async()=>{const{data:t,error:x}=await C.from("categories").select("*").eq("is_active",!0).order("display_order");!x&&t&&s(t),I(!1)},[]),ce=r.useCallback(async()=>{let t=C.from("products").select("*").eq("is_active",!0);n&&(t=t.eq("category_id",n));const{data:x,error:d}=await t;if(!d&&x){const E=x.map(P=>P.id),{data:N}=await C.from("product_variants").select("*").in("product_id",E).eq("is_default",!0),D=x.map(P=>{const B=(N==null?void 0:N.find(Ze=>Ze.product_id===P.id))||null;return{...P,default_variant:B}});b(D.map(P=>({...P,stock_quantity:P.stock_quantity??0,unit:P.unit||"piece"})))}},[n]),W=r.useCallback(async()=>{if(!a)return;const{data:t,error:x}=await C.from("cart_items").select("*, products(*), product_variants(*)").eq("user_id",a.id);!x&&t&&A(t)},[a]),ye=r.useCallback(async()=>{if(!a)return;const{data:t}=await C.from("profiles").select("address").eq("id",a.id).single();t!=null&&t.address?(he(t.address),ne("saved")):ne("new")},[a]);r.useEffect(()=>{const t=S.get("category");j(t)},[S]),r.useEffect(()=>{o||ce()},[n,o,ce]),r.useEffect(()=>{if(o)return;je(),a&&(W(),ye());const t=()=>le(!0);return window.addEventListener("openCart",t),()=>window.removeEventListener("openCart",t)},[a,o,je,W,ye]);const U=async t=>{await f(t,null)?(R.success("Added to cart"),a&&W()):R.error("Failed to add to cart")},ve=async(t,x)=>{if(x<=0){await be(t);return}const d=i.find(B=>B.id===t);if(!d)return;const{data:E,error:N}=await C.from("products").select("stock_quantity, name").eq("id",d.product_id).single();if(N||!E){R.error("Failed to check stock availability");return}const D=E.stock_quantity??0;if(x>D){if(R.error(`Only ${D} ${E.name} available`),D>0&&D!==d.quantity){const{error:B}=await C.from("cart_items").update({quantity:D}).eq("id",t);B||(W(),R.info(`Cart updated to maximum available (${D})`))}return}const{error:P}=await C.from("cart_items").update({quantity:x}).eq("id",t);P||W()},be=async t=>{const{error:x}=await C.from("cart_items").delete().eq("id",t);x||(W(),R.success("Removed from cart"))},We=()=>{!a||i.length===0||(xe(null),H(!0))},Ue=async()=>{if(!a)return;const t=oe!==null;if(!t&&i.length===0){R.error("Your cart is empty");return}const x=ee==="saved"?ae:te.trim();if(!x){R.error("Please provide a delivery address");return}try{ee==="new"&&te.trim()&&(await C.from("profiles").update({address:te.trim()}).eq("id",a.id),he(te.trim()));const d=t?[{product_id:oe.id,quantity:1,variant_id:null,price:oe.price}]:i.map(P=>{var B;return{product_id:P.product_id,quantity:P.quantity,variant_id:P.variant_id,price:((B=P.product_variants)==null?void 0:B.price)??P.products.price}}),{data:E,error:N}=await C.rpc("place_order_atomic",{p_user_id:a.id,p_delivery_address:x,p_cart_items:d,p_coupon_id:void 0,p_coupon_discount:0});if(N){V.error("Order placement error",{error:N}),R.error("Failed to place order. Please try again.");return}const D=E;if(!D.success){R.error(D.error||"Failed to place order");return}t||(A([]),u()),ce(),H(!1),le(!1),xe(null),Me(""),D.order_id&&(Le(D.order_id),fe(!0))}catch(d){V.error("Unexpected order placement error",{error:d}),R.error("An unexpected error occurred. Please try again.")}},we=w.filter(t=>t.name.toLowerCase().includes(h.toLowerCase())),Ye=i.reduce((t,x)=>t+x.products.price*x.quantity,0),Ge=l.reduce((t,x)=>{const d=w.find(E=>E.id===x.productId);return t+((d==null?void 0:d.price)||0)*x.quantity},0),Ne=a?Ye:Ge;return F?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl supports-[backdrop-filter]:bg-background/20 shadow-[0_10px_40px_rgba(15,23,42,0.35)]",children:e.jsx("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-6 w-6 rounded-md"}),e.jsx($,{className:"h-6 w-32 rounded-md"})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx($,{className:"h-10 w-full max-w-md mx-auto rounded-md"})}),e.jsx("div",{className:"container mx-auto px-4 pb-4",children:e.jsx("div",{className:"flex gap-2 overflow-hidden",children:[1,2,3,4,5].map(t=>e.jsx($,{className:"h-9 w-24 rounded-full shrink-0"},t))})}),e.jsx("div",{className:"container mx-auto px-4 pb-8",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[1,2,3,4,5,6,7,8,9,10].map(t=>e.jsxs("div",{className:"rounded-2xl border-2 border-border/40 bg-card overflow-hidden",children:[e.jsx($,{className:"aspect-square w-full"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx($,{className:"h-4 w-3/4"}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{className:"h-5 w-16"}),e.jsx($,{className:"h-3 w-10"})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx($,{className:"h-8 w-16 rounded-full"}),e.jsx($,{className:"h-8 w-8 rounded-full"})]})]})]})]},t))})}),e.jsx(_e,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-20",children:[Re&&pe&&e.jsx(jt,{orderId:pe,onClose:()=>fe(!1)}),e.jsx("header",{className:`sticky top-0 z-40 border-b border-border/40 bg-background/95 backdrop-blur-xl supports-[backdrop-filter]:bg-background/80 shadow-sm transition-transform duration-300 ${He?"translate-y-0":"-translate-y-full"}`,children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/dist/logo.svg",alt:"PremaShop",className:"h-8 w-auto"}),e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"PremaShop"})]}),e.jsx("p",{className:"text-xs text-muted-foreground font-medium ml-8",children:"âš¡ Rapid Delivery in 14 mins"})]}),e.jsx(O,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full bg-primary/10 hover:bg-primary/20",onClick:()=>_(a?"/profile":"/auth"),"aria-label":"View Profile",children:e.jsx(rt,{className:"h-5 w-5 text-primary"})})]})})}),e.jsxs(mt,{open:ze,onOpenChange:le,children:[e.jsx(ht,{asChild:!0,children:e.jsx("button",{id:"cart-trigger",className:"hidden"})}),e.jsxs(xt,{children:[e.jsx(ft,{children:e.jsx(pt,{children:"Your Cart"})}),e.jsx(gt,{className:"h-[calc(100vh-200px)] mt-4",children:i.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Your cart is empty"}):e.jsx("div",{className:"space-y-4",children:i.map(t=>e.jsx(ke,{children:e.jsx(Ce,{className:"p-4",children:e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:t.products.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["$",t.products.price," / ",t.products.unit]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(O,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:()=>ve(t.id,t.quantity-1),children:e.jsx(Se,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center",children:t.quantity}),e.jsx(O,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:()=>ve(t.id,t.quantity+1),children:e.jsx(ue,{className:"h-3 w-3"})}),e.jsx(O,{size:"icon",variant:"ghost",className:"h-7 w-7 ml-auto",onClick:()=>be(t.id),children:e.jsx(wt,{className:"h-3 w-3"})})]})]})})})},t.id))})}),i.length>0&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-background border-t",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"font-bold text-lg",children:["$",Ne.toFixed(2)]})]}),e.jsx(O,{className:"w-full",onClick:We,children:"Place Order"})]})]})]}),e.jsx("div",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur-xl py-4",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"relative max-w-md mx-auto",children:[e.jsx(It,{value:h,onChange:t=>{T(t),t.trim().length>=2&&k(!0)},onFocus:()=>{h.trim().length>=2&&Q.length>0&&k(!0)},onBlur:()=>{setTimeout(()=>k(!1),200)}}),y&&Q.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-card border rounded-lg shadow-lg z-50 max-h-[300px] overflow-y-auto",children:Q.map(t=>e.jsxs("button",{className:"w-full flex items-center gap-3 p-3 hover:bg-muted transition-colors text-left",onClick:()=>{_(`/product/${t.id}`),k(!1)},children:[t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-10 h-10 rounded object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded bg-muted flex items-center justify-center",children:e.jsx(qe,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-primary font-semibold",children:["â‚¹",t.price]})]}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground shrink-0"})]},t.id))})]})})}),e.jsx("div",{className:"container mx-auto px-4 pb-4",children:e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:[e.jsx(O,{variant:n===null?"default":"outline",onClick:()=>{j(null),M({})},className:"rounded-full flex-shrink-0",children:"All"}),q.map(t=>e.jsx(O,{variant:n===t.id?"default":"outline",onClick:()=>{j(t.id),M({category:t.id})},className:"rounded-full flex-shrink-0 whitespace-nowrap",children:t.name},t.id))]})}),!h&&!n&&e.jsx(Pt,{}),!h&&!n&&e.jsx(At,{onAddToCart:U}),!h&&!n&&e.jsx(Ct,{}),!h&&!n&&e.jsx(Ft,{onAddToCart:U}),a&&ge.length>0&&!h&&!n&&e.jsxs("div",{className:"container mx-auto px-4 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg",children:e.jsx(Ee,{className:"h-4 w-4 text-white"})}),e.jsx("h2",{className:"text-lg font-bold",children:"For You"})]}),e.jsx(re,{className:"gap-3",children:ge.slice(0,8).map(t=>e.jsx("div",{className:"flex-shrink-0 w-[150px]",children:e.jsx(X,{product:{...t,mrp:t.mrp??null,stock_quantity:t.stock_quantity??void 0},onAddToCart:()=>{Ve(t.id),U(t.id)},cartQuantity:v(t.id,null),onQuantityChange:(x,d)=>p(x,null,d)})},t.id))})]}),!h&&!n&&q.filter(t=>t.shop_section_visible!==!1).map(t=>{const x=w.filter(d=>d.category_id===t.id);return x.length===0?null:e.jsxs("div",{className:"container mx-auto px-4 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:t.name}),e.jsxs("button",{onClick:()=>{j(t.id),M({category:t.id})},className:"text-sm text-primary font-medium hover:underline flex items-center gap-1",children:["See all",e.jsx(Y,{className:"h-4 w-4"})]})]}),e.jsx(re,{className:"gap-3",children:x.slice(0,8).map(d=>e.jsx("div",{className:"flex-shrink-0 w-[calc((100vw-48px)/3)] min-w-[100px] max-w-[120px]",children:e.jsx(X,{product:{id:d.id,name:d.name,price:d.price,mrp:d.mrp??null,image_url:d.image_url,unit:d.unit,discount_percent:d.discount_percent,default_variant:d.default_variant,stock_quantity:d.stock_quantity},onAddToCart:()=>U(d.id),cartQuantity:v(d.id,null),onQuantityChange:(E,N)=>p(E,null,N)})},d.id))})]},t.id)}),e.jsx("div",{className:"container mx-auto px-4 pb-8",children:we.length===0?e.jsx(at,{title:h?"No products found":"No products in this category",description:h?`No results for "${h}"`:"Try selecting a different category"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:we.map(t=>{const x=t.stock_quantity<=0,d=t.stock_quantity>0&&t.stock_quantity<=5,E=t.stock_quantity>5&&t.stock_quantity<=10;return e.jsxs(ke,{className:`overflow-hidden rounded-2xl border-2 bg-card/90 hover:shadow-xl transition-all relative ${x?"border-destructive/60 bg-destructive/5":d?"border-red-500/60 bg-red-50/50 dark:bg-red-950/20":E?"border-orange-400/60 bg-orange-50/50 dark:bg-orange-950/20":"border-border/40 hover:border-primary/40"}`,children:[(d||E)&&!x&&e.jsx("div",{className:`absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-bold ${d?"bg-red-500 text-white animate-pulse":"bg-orange-500 text-white"}`,children:d?`Only ${t.stock_quantity} left!`:`${t.stock_quantity} left`}),(()=>{const N=t.default_variant,D=(N==null?void 0:N.price)??t.price,P=(N==null?void 0:N.mrp)??t.mrp,B=P&&P>D?Math.round((P-D)/P*100):t.discount_percent||0;return B>0?e.jsxs("div",{className:"absolute top-2 left-2 z-10 px-2 py-1 rounded-md bg-gradient-to-r from-green-500 to-emerald-600 text-white text-xs font-bold shadow-lg",children:[B,"% OFF"]}):null})(),e.jsxs(Ce,{className:"p-0",children:[e.jsx("div",{className:`aspect-square bg-muted flex items-center justify-center cursor-pointer ${x?"opacity-50":""}`,onClick:()=>_(`/product/${t.id}`),children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"}):e.jsx(qe,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm line-clamp-2 mb-1 cursor-pointer hover:text-primary transition-colors",onClick:()=>_(`/product/${t.id}`),children:t.name}),t.default_variant&&e.jsx("span",{className:"text-[10px] text-muted-foreground block mb-1",children:Pe(t.default_variant)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:(()=>{const N=t.default_variant,D=(N==null?void 0:N.price)??t.price,P=(N==null?void 0:N.mrp)??t.mrp,B=N?Pe(N):t.unit;return P&&P>D?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["â‚¹",D]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["â‚¹",P]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["/ ",B]})]})]}):t.discount_percent&&t.discount_percent>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["â‚¹",Math.round(t.price*(100-t.discount_percent)/100)]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["â‚¹",t.price]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["/ ",t.unit]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:["â‚¹",D]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["/ ",B]})]})})()}),(()=>{const N=v(t.id,null);return N>0?e.jsxs("div",{className:"flex items-center gap-0 rounded-full overflow-hidden border border-primary",children:[e.jsx(O,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none",onClick:()=>p(t.id,null,N-1),children:e.jsx(Se,{className:"h-3 w-3"})}),e.jsx("span",{className:"px-2 font-bold text-sm min-w-[24px] text-center",children:N}),e.jsx(O,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none",onClick:()=>p(t.id,null,N+1),disabled:x,children:e.jsx(ue,{className:"h-3 w-3"})})]}):e.jsx(O,{size:"icon",className:`h-9 w-9 rounded-full ${x?"opacity-50":""}`,onClick:()=>U(t.id),disabled:x,children:e.jsx(ue,{className:"h-4 w-4"})})})()]}),x&&e.jsx(nt,{variant:"destructive",className:"w-full mt-2 justify-center",children:"Out of Stock"}),d&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 font-medium mt-2 text-center",children:"ðŸ”¥ Hurry! Almost sold out"})]})]})]},t.id)})})}),!h&&!n&&e.jsx(St,{onAddToCart:U}),!h&&!n&&e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx(qt,{categories:q,onCategorySelect:j})}),e.jsx(it,{open:L,onOpenChange:H,children:e.jsxs(lt,{className:"max-w-md",children:[e.jsx(ot,{children:e.jsx(ct,{children:"Select Delivery Address"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs(yt,{value:ee,onValueChange:t=>ne(t),children:[ae&&e.jsxs("div",{className:"flex items-start space-x-3 p-4 border rounded-lg",children:[e.jsx(Ie,{value:"saved",id:"saved"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(G,{htmlFor:"saved",className:"font-medium cursor-pointer",children:"Use Saved Address"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:ae})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-4 border rounded-lg",children:[e.jsx(Ie,{value:"new",id:"new"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(G,{htmlFor:"new",className:"font-medium cursor-pointer",children:"Enter New Address"}),ee==="new"&&e.jsxs("div",{className:"space-y-4 mt-3",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-sm",children:"Apartment Complex"}),e.jsxs("select",{value:ie,onChange:t=>Fe(t.target.value),className:"w-full mt-1.5 p-2 border rounded-md bg-background text-sm",children:[e.jsx("option",{value:"",children:"Select your apartment..."}),e.jsx("option",{value:"VBHC Vaibhava",title:"VBHC Vaibhava, Chandapura-Anekal Road, Bangalore - 562106",children:"VBHC Vaibhava"}),e.jsx("option",{value:"Symphony",title:"Symphony, Chandapura-Anekal Road, Bangalore - 562106",children:"Symphony"})]}),ie&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["ðŸ“ ",ie,", Chandapura-Anekal Road, Bangalore - 562106"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-sm",children:"Block/Tower"}),e.jsx(Ae,{placeholder:"e.g., 51",value:Oe,onChange:t=>$e(t.target.value),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(G,{className:"text-sm",children:"Room Number"}),e.jsx(Ae,{placeholder:"e.g., 603",value:Be,onChange:t=>Qe(t.target.value),className:"mt-1.5"})]})]})]})]})]})]})}),e.jsxs(dt,{children:[e.jsx(O,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),e.jsx(O,{onClick:Ue,children:"Confirm Order"})]})]})}),e.jsx(ut,{}),e.jsx(Dt,{threshold:499,cartTotal:Ne}),e.jsx(_e,{})]})}export{Gt as default};
