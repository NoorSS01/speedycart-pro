import{r as i,j as e,ae as oe,af as G,ag as ne,a3 as ie,a4 as le,a5 as de,a6 as ce,B as C,ah as R,ai as L,ad as me,u as ue,a as xe,l as $,s as y,S as q,h as pe,C as z,c as V,G as fe,T as he,X as ge,n as A}from"./index-DuGsTUiO.js";import{A as W}from"./AdminBottomNav-BrCgukUx.js";import{W as ve}from"./wallet-BxhHC8Lj.js";var T="Progress",M=100,[ye]=oe(T),[Ne,je]=ye(T),H=i.forwardRef((s,r)=>{const{__scopeProgress:m,value:o=null,max:t,getValueLabel:j=be,...l}=s;(t||t===0)&&!X(t)&&console.error(we(`${t}`,"Progress"));const d=X(t)?t:M;o!==null&&!B(o,d)&&console.error(Pe(`${o}`,"Progress"));const n=B(o,d)?o:null,v=S(n)?j(n,d):void 0;return e.jsx(Ne,{scope:m,value:n,max:d,children:e.jsx(G.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":S(n)?n:void 0,"aria-valuetext":v,role:"progressbar","data-state":K(n,d),"data-value":n??void 0,"data-max":d,...l,ref:r})})});H.displayName=T;var Y="ProgressIndicator",J=i.forwardRef((s,r)=>{const{__scopeProgress:m,...o}=s,t=je(Y,m);return e.jsx(G.div,{"data-state":K(t.value,t.max),"data-value":t.value??void 0,"data-max":t.max,...o,ref:r})});J.displayName=Y;function be(s,r){return`${Math.round(s/r*100)}%`}function K(s,r){return s==null?"indeterminate":s===r?"complete":"loading"}function S(s){return typeof s=="number"}function X(s){return S(s)&&!isNaN(s)&&s>0}function B(s,r){return S(s)&&!isNaN(s)&&s<=r&&s>=0}function we(s,r){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${M}\`.`}function Pe(s,r){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${M} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Q=H,Ce=J;const Z=i.forwardRef(({className:s,value:r,...m},o)=>e.jsx(Q,{ref:o,className:ne("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...m,children:e.jsx(Ce,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));Z.displayName=Q.displayName;function De({open:s,onOpenChange:r,upiId:m,payeeName:o,amount:t,onPaymentConfirmed:j}){const[l,d]=i.useState("initial"),[n,v]=i.useState(16),[k,b]=i.useState(0);i.useEffect(()=>{s&&(d("initial"),v(16),b(0))},[s]),i.useEffect(()=>{let u;return l==="waiting"&&n>0?u=setInterval(()=>{v(P=>{const D=P-.1;return D<0?0:D}),b(P=>P+100/(16*10))},100):l==="waiting"&&n<=0&&d("confirm"),()=>clearInterval(u)},[l,n]);const p=()=>`upi://pay?pa=${encodeURIComponent(m)}&pn=${encodeURIComponent(o)}&am=${t.toFixed(2)}&cu=INR&tn=${encodeURIComponent("SpeedyCart Payout")}`,w=()=>{const u=p();window.location.href=u,d("waiting")};return e.jsx(ie,{open:s,onOpenChange:u=>{l==="waiting"&&u===!1||r(u)},children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsxs(ce,{children:["Pay ",o]})}),e.jsxs("div",{className:"py-6 flex flex-col items-center justify-center space-y-6 text-center",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-xl w-full",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Payable"}),e.jsxs("p",{className:"text-4xl font-bold text-primary",children:["₹",t.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 font-mono",children:m})]}),l==="initial"&&e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Click below to open your preferred UPI app. ",e.jsx("br",{}),"Please verify the UPI ID before paying."]}),e.jsxs(C,{size:"lg",className:"w-full text-lg h-12",onClick:w,children:[e.jsx(R,{className:"mr-2 h-5 w-5"})," Pay Now"]})]}),l==="waiting"&&e.jsxs("div",{className:"w-full space-y-4 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"relative w-20 h-20 mx-auto flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-muted rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-t-primary rounded-full animate-spin"}),e.jsxs("span",{className:"font-bold text-xl",children:[Math.ceil(n),"s"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Waiting for Payment..."}),e.jsx("p",{className:"text-sm text-muted-foreground px-4",children:"Complete the payment in your UPI app. Do not verify anything yet. We will ask for confirmation shortly."})]}),e.jsx(Z,{value:Math.min(k,100),className:"h-2 w-full"})]}),l==="confirm"&&e.jsxs("div",{className:"w-full space-y-4 animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(L,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Did you complete the payment?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The amount will be marked as paid and sent for approval."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full",children:[e.jsxs(C,{variant:"outline",size:"lg",onClick:()=>r(!1),children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," No, I didn't"]}),e.jsxs(C,{size:"lg",className:"bg-green-600 hover:bg-green-700",onClick:j,children:[e.jsx(L,{className:"mr-2 h-4 w-4"})," Yes, I Paid"]})]})]})]})]})})}const ee="8310807978",_e=`${ee}@ybl`,Ee=()=>{const{user:s,userRole:r,loading:m}=ue(),o=xe(),[t,j]=i.useState({deliveredOrders:0,totalDeveloperCommission:0,paidDeveloperCommission:0,pendingDeveloper:0}),[l,d]=i.useState([]),[n,v]=i.useState(!0),[k,b]=i.useState(!1),[p,w]=i.useState({open:!1,upiId:"",payeeName:"",amount:0,payeeId:null,type:"developer_commission"});i.useEffect(()=>{if(!m){if(!s){o("/auth");return}if(r!=="admin"&&r!=="super_admin"){o("/shop");return}u()}},[s,r,m,o]);const u=async()=>{v(!0);try{await Promise.all([P(),D()])}catch(a){$.error("Failed to load payment data",{error:a})}finally{v(!1)}},P=async()=>{const{data:a,error:x}=await y.from("orders").select("id").eq("status","delivered");if(x)throw x;const N=(a==null?void 0:a.length)||0,f=N*4,{data:h,error:c}=await y.from("payouts").select("amount, status").eq("type","developer_commission").eq("status","approved");c&&console.warn("Developer payout error",c);const g=(h==null?void 0:h.reduce((_,I)=>_+(Number(I.amount)||0),0))||0;j({deliveredOrders:N,totalDeveloperCommission:f,paidDeveloperCommission:g,pendingDeveloper:Math.max(0,f-g)})},D=async()=>{const{data:a,error:x}=await y.from("user_roles").select("user_id").eq("role","delivery");if(x||!a)return;const N=a.map(c=>c.user_id),{data:f}=await y.from("profiles").select("id, full_name, phone").in("id",N);if(!f)return;const h=[];for(const c of f)try{const{data:g}=await y.from("delivery_assignments").select("order_id, orders!inner(status)").eq("delivery_person_id",c.id).eq("orders.status","delivered"),_=(g==null?void 0:g.length)||0,I=_*5,{data:E,error:U}=await y.from("payouts").select("amount").eq("payee_id",c.id).eq("type","delivery_commission").eq("status","approved");U&&console.warn("Payout fetch error",U);const F=(E==null?void 0:E.reduce((re,te)=>re+(Number(te.amount)||0),0))||0,ae=Math.max(0,I-F);h.push({id:c.id,full_name:c.full_name||"Delivery Partner",phone:c.phone||"",deliveredOrders:_,totalCommission:I,paidCommission:F,pendingAmount:ae})}catch(g){$.error(`Failed to calc stats for ${c.id}`,{error:g})}d(h)},O=(a,x,N,f,h)=>{if(f<=0){A.success("No pending payment!");return}const c=a===null?_e:`${N}@upi`;w({open:!0,upiId:c,payeeName:x,amount:f,payeeId:a,type:h})},se=async()=>{if(!k){b(!0);try{const{error:a}=await y.from("payouts").insert({payer_id:s==null?void 0:s.id,payee_id:p.payeeId,amount:p.amount,status:"pending",type:p.type});if(a)throw a;A.success("Payment recorded! Waiting for approval."),w(x=>({...x,open:!1})),u()}catch(a){A.error("Failed to record payment"),$.error("Payment insert error",{error:a})}finally{b(!1)}}};return m||r===null||n?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(q,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2].map(a=>e.jsx(q,{className:"h-48 rounded-xl"},a))}),e.jsx(W,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(ve,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"Daily Payouts"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:pe(new Date,"MMM dd, yyyy")})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider pl-1",children:"Platform Fees"}),e.jsxs(z,{className:"border-indigo-500/20 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-indigo-500 to-purple-600"}),e.jsxs(V,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-500/10 rounded-lg",children:e.jsx(fe,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Developer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Commission (₹4/order)"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-indigo-600",children:["₹",t.pendingDeveloper.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-semibold",children:"Pending"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm bg-muted/40 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Earned"}),e.jsxs("p",{className:"font-semibold",children:["₹",t.totalDeveloperCommission]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Paid"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["₹",t.paidDeveloperCommission]})]})]}),e.jsxs(C,{className:"w-full bg-indigo-600 hover:bg-indigo-700",size:"lg",disabled:t.pendingDeveloper<=0,onClick:()=>O(null,"Developer",ee,t.pendingDeveloper,"developer_commission"),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Pay Remainder"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between pl-1",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Delivery Partners"}),e.jsxs("span",{className:"text-xs bg-muted px-2 py-1 rounded-full",children:[l.length," Active"]})]}),l.map(a=>e.jsxs(z,{className:"border-rose-500/20 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-rose-400 to-orange-500"}),e.jsxs(V,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-rose-500/10 rounded-lg",children:e.jsx(he,{className:"h-5 w-5 text-rose-600"})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("h3",{className:"font-bold text-lg truncate w-32 md:w-auto",children:a.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.phone})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-rose-600",children:["₹",a.pendingAmount.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-semibold",children:"Due Today"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm bg-muted/40 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Orders"}),e.jsx("p",{className:"font-semibold",children:a.deliveredOrders})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Paid So Far"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["₹",a.paidCommission]})]})]}),e.jsxs(C,{className:"w-full bg-rose-600 hover:bg-rose-700",size:"lg",disabled:a.pendingAmount<=0,onClick:()=>O(a.id,a.full_name,a.phone,a.pendingAmount,"delivery_commission"),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Pay Partner"]})]})]},a.id)),l.length===0&&e.jsxs("div",{className:"text-center py-8 bg-muted/20 rounded-xl",children:[e.jsx(ge,{className:"h-10 w-10 text-muted-foreground mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No active delivery partners found."})]})]})]}),e.jsx(W,{}),e.jsx(De,{open:p.open,onOpenChange:a=>w(x=>({...x,open:a})),upiId:p.upiId,payeeName:p.payeeName,amount:p.amount,onPaymentConfirmed:se})]})};export{Ee as default};
