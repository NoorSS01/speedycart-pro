const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CzqGsn4l.js","assets/index-B0oKH6EV.css"])))=>i.map(i=>d[i]);
import{c as Ee,r as c,j as e,D as Ve,t as ze,v as Ye,W as oe,w as Me,Y as ms,_ as xs,$ as le,x as Ge,B as x,a0 as Oe,J as ie,o as de,q as He,y as u,u as ps,a as hs,b as fs,a1 as gs,s as p,l as b,f as De,i as ae,A as Ie,a2 as Pe,a3 as js,k as V,m as re,p as Re,a4 as vs,O as bs,I as ne,X as Ns,a5 as $e,K as ys,N as ws,G as _s,L as R,a6 as Te}from"./index-CzqGsn4l.js";import{O as ks,R as Cs,a as Le}from"./OrderConfirmation-BQuHxUoV.js";import{S as Ss,H as As}from"./HorizontalScrollContainer-BX43HbnN.js";import{T as Ue}from"./trash-2-Gw59I6Fz.js";import"./index-Cpbua6Wm.js";import"./chevron-left-2S0FLKrO.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=Ee("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=Ee("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function qs({open:n,onClose:C,conflictItems:h,onAdjustQuantities:f,onRemoveUnavailable:d,onRetryCheckout:g,isLoading:D=!1}){const[y,j]=c.useState(null),v=h.filter(i=>i.conflict_type==="out_of_stock"||i.conflict_type==="product_inactive"||i.conflict_type==="not_found"||i.available===0),w=h.filter(i=>i.conflict_type==="insufficient_stock"&&i.available>0),S=w.length>0,I=v.length>0,$=async()=>{j("adjust");try{await f(),u.success("Cart quantities adjusted to available stock"),I||g()}catch{u.error("Failed to adjust quantities. Please try again.")}finally{j(null)}},z=async()=>{j("remove");try{await d(),u.success("Unavailable items removed from cart"),S||g()}catch{u.error("Failed to remove items. Please try again.")}finally{j(null)}},Y=async()=>{j("adjust");try{I&&await d(),S&&await f(),u.success("Cart updated successfully"),g()}catch{u.error("Failed to update cart. Please try again.")}finally{j(null)}},T=i=>{switch(i){case"out_of_stock":return"Out of Stock";case"insufficient_stock":return"Limited Stock";case"product_inactive":return"Unavailable";case"not_found":return"Not Found";case"variant_not_found":return"Variant Unavailable";case"invalid_quantity":return"Invalid Quantity";default:return"Issue"}},N=i=>i==="out_of_stock"||i==="product_inactive"||i==="not_found"?"destructive":"secondary";return e.jsx(Ve,{open:n,onOpenChange:i=>!i&&C(),children:e.jsxs(ze,{className:"max-w-md",children:[e.jsxs(Ye,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(oe,{className:"h-5 w-5"}),e.jsx(Me,{children:"Stock Issues Detected"})]}),e.jsx(ms,{children:"Some items in your cart have stock issues that need to be resolved before checkout."})]}),e.jsx(Ss,{className:"max-h-[300px] pr-4",children:e.jsxs("div",{className:"space-y-3",children:[v.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-destructive",children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsxs("span",{children:["Unavailable (",v.length,")"]})]}),v.map((i,q)=>e.jsx(Be,{item:i,getLabel:T,getBadgeVariant:N},`out-${q}`))]}),v.length>0&&w.length>0&&e.jsx(le,{className:"my-3"}),w.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-amber-600",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Limited Stock (",w.length,")"]})]}),w.map((i,q)=>e.jsx(Be,{item:i,getLabel:T,getBadgeVariant:N,showAdjustment:!0},`insuf-${q}`))]})]})}),e.jsx(le,{}),e.jsxs(Ge,{className:"flex-col gap-2 sm:flex-col",children:[e.jsx(x,{onClick:Y,disabled:D||y!==null,className:"w-full bg-gradient-to-r from-primary to-primary/90",children:y?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-4 w-4 mr-2 animate-spin"}),"Updating Cart..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Fix Issues & Continue",e.jsx(We,{className:"h-4 w-4 ml-2"})]})}),e.jsxs("div",{className:"flex gap-2 w-full",children:[I&&e.jsxs(x,{variant:"outline",onClick:z,disabled:D||y!==null,className:"flex-1 text-destructive border-destructive/50 hover:bg-destructive/10",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Remove Only"]}),S&&e.jsxs(x,{variant:"outline",onClick:$,disabled:D||y!==null,className:"flex-1",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Adjust Only"]})]}),e.jsx(x,{variant:"ghost",onClick:C,disabled:y!==null,className:"w-full",children:"Return to Cart"})]})]})})}function Be({item:n,getLabel:C,getBadgeVariant:h,showAdjustment:f=!1}){return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50 border border-border/50",children:[e.jsx("div",{className:"w-10 h-10 rounded-md bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(de,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:n.product_name}),n.variant_name&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:n.variant_name})]}),e.jsx(He,{variant:h(n.conflict_type),className:"flex-shrink-0 text-[10px]",children:C(n.conflict_type)})]}),f?e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Requested: ",n.requested]}),e.jsx(We,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-amber-600 font-medium",children:["Available: ",n.available]})]}):e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Qty: ",n.requested," â€¢ This item is no longer available"]})]})]})}function Ts(){const{user:n,loading:C}=ps(),{refreshCart:h}=hs(),f=fs(),[d,g]=c.useState([]),[D,y]=c.useState(!0),[j,v]=c.useState(""),[w,S]=c.useState(!1),[I,$]=c.useState(!1),[z,Y]=c.useState(""),[T,N]=c.useState(!1),[i,q]=c.useState(""),[L,Ke]=c.useState("saved"),[Qe,Fs]=c.useState(""),[M,ue]=c.useState(!1),[_,Je]=c.useState(""),[F,Xe]=c.useState(""),[O,Ze]=c.useState(""),[G,es]=c.useState([]),[A,H]=c.useState(null),[U,W]=c.useState(0),[ss,K]=c.useState(!1),[ts,Q]=c.useState([]),[as,me]=c.useState(""),xe=c.useRef(null),[rs,ns]=c.useState(!0),[pe,he]=c.useState(!0),fe=c.useRef(0);c.useEffect(()=>{const s=xe.current;if(!s)return;const t=new IntersectionObserver(([r])=>{ns(r.isIntersecting)},{threshold:.1});return t.observe(s),()=>t.disconnect()},[d.length]),c.useEffect(()=>{const s=()=>{const t=window.scrollY,r=t>fe.current?"down":"up";r==="down"&&t>100&&he(!1),(r==="up"||t<50)&&he(!0),fe.current=t};return window.addEventListener("scroll",s,{passive:!0}),()=>window.removeEventListener("scroll",s)},[]);const P=c.useCallback(async()=>{if(!n){const o=gs().items.map((a,l)=>{var m,Ce,Se,Ae,qe,Fe;return{id:`guest-${l}`,product_id:a.productId,quantity:a.quantity,variant_id:a.variantId,products:{id:a.productId,name:((m=a.productData)==null?void 0:m.name)||"Product",price:((Ce=a.productData)==null?void 0:Ce.price)||0,mrp:((Se=a.productData)==null?void 0:Se.mrp)||null,image_url:((Ae=a.productData)==null?void 0:Ae.image_url)||null,stock_quantity:((qe=a.productData)==null?void 0:qe.stock_quantity)||0,unit:((Fe=a.productData)==null?void 0:Fe.unit)||"unit"},product_variants:a.variantData?{id:a.variantId||"",variant_name:a.variantData.variant_name,variant_value:a.variantData.variant_value,variant_unit:a.variantData.variant_unit,price:a.variantData.price,mrp:a.variantData.mrp}:null}});g(o),y(!1);return}const{data:s,error:t}=await p.from("cart_items").select(`
        *,
        products (*, categories (id, name)),
        product_variants (*)
      `).eq("user_id",n.id);!t&&s&&g(s),y(!1)},[n]),ge=c.useCallback(async()=>{if(!n)return;const{data:s}=await p.from("profiles").select("address").eq("id",n.id).single();s!=null&&s.address&&q(s.address)},[n]),je=c.useCallback(async()=>{if(n)try{const{data:s}=await p.from("coupons").select("*").eq("is_active",!0).or(`valid_until.is.null,valid_until.gte.${new Date().toISOString()}`);if(s){const{data:t}=await p.from("coupon_usage").select("coupon_id").eq("user_id",n.id),r=new Set((t||[]).map(a=>a.coupon_id)),o=s.filter(a=>!r.has(a.id)||a.is_stackable);es(o)}}catch(s){b.error("Failed to fetch coupons",{error:s})}},[n]);c.useEffect(()=>{C||(P(),n&&(ge(),je()))},[n,C,P,ge,je]);const ve=async s=>{if(!n)return;const t=d.reduce((r,o)=>{var l;const a=((l=o.product_variants)==null?void 0:l.price)??o.products.price;return r+a*o.quantity},0);try{const{data:r,error:o}=await p.rpc("validate_and_apply_coupon",{p_user_id:n.id,p_coupon_code:s.code,p_subtotal:t});if(o){b.error("Coupon validation error",{error:o}),u.error("Failed to validate coupon. Please try again.");return}const a=r;if(!a.valid){u.error(a.error||"Coupon is not valid");return}H(s),W(a.discount||0),v(a.code||s.code),S(!0),u.success(`${a.code} applied! You save â‚¹${(a.discount||0).toFixed(0)}`)}catch(r){b.error("Coupon application error",{error:r}),u.error("Failed to apply coupon. Please try again.")}},cs=()=>{H(null),W(0),v(""),S(!1)},be=async(s,t)=>{if(t<1){await Ne(s);return}const r=d.find(a=>a.id===s);if(r&&t>r.products.stock_quantity){u.error(`Only ${r.products.stock_quantity} available`);return}if(s.startsWith("guest-")||!n){if(r){const{updateGuestCartQuantity:a}=await Te(async()=>{const{updateGuestCartQuantity:l}=await import("./index-CzqGsn4l.js").then(m=>m.b9);return{updateGuestCartQuantity:l}},__vite__mapDeps([0,1]));a(r.product_id,r.variant_id,t),g(l=>l.map(m=>m.id===s?{...m,quantity:t}:m)),h()}return}const{error:o}=await p.from("cart_items").update({quantity:t}).eq("id",s);o||g(a=>a.map(l=>l.id===s?{...l,quantity:t}:l))},Ne=async s=>{const t=d.find(o=>o.id===s);if(s.startsWith("guest-")||!n){if(t){const{removeFromGuestCart:o}=await Te(async()=>{const{removeFromGuestCart:a}=await import("./index-CzqGsn4l.js").then(l=>l.b9);return{removeFromGuestCart:a}},__vite__mapDeps([0,1]));o(t.product_id,t.variant_id),g(a=>a.filter(l=>l.id!==s)),h(),u.success("Item removed")}return}const{error:r}=await p.from("cart_items").delete().eq("id",s);r||(g(o=>o.filter(a=>a.id!==s)),h(),u.success("Item removed"))},os=()=>{const s=j.toUpperCase().trim(),t=G.find(r=>r.code.toUpperCase()===s);t?ve(t):u.error("Invalid or expired promo code")},ye=async()=>{if(d.length===0){u.error("Your cart is empty");return}if(!n){u("Please sign in to complete your order",{description:"Your cart items will be saved",action:{label:"Sign In",onClick:()=>f("/auth")}});return}try{const{data:t}=await p.from("admin_settings").select("*").eq("id","00000000-0000-0000-0000-000000000001").single(),r=t==null?void 0:t.shop_status,o=t==null?void 0:t.closed_message;if(r==="closed"){u.error(o||"We are currently closed. Please try again later.",{duration:5e3});return}}catch(t){b.warn("Could not check shop status",{error:t})}if(d.filter(t=>t.products.stock_quantity<t.quantity).length>0){u.error("Some items are out of stock");return}N(!0)},ls=async()=>{if(!n)return;let s="";if(L==="saved")s=i;else if(_&&_!=="Other"){const t=[];F&&t.push(`Block ${F}`),O&&t.push(`Room ${O}`),t.push(_),t.push("Chandapura-Anekal Road, Bangalore - 562106"),s=t.join(", ")}else s=Qe;if(!s.trim()){u.error("Please enter a delivery address");return}ue(!0);try{const t=d.map(l=>{var m;return{product_id:l.product_id,variant_id:l.variant_id||null,quantity:l.quantity,price:((m=l.product_variants)==null?void 0:m.price)||l.products.price}}),{data:r,error:o}=await p.rpc("place_order_atomic",{p_user_id:n.id,p_delivery_address:s,p_cart_items:t,p_coupon_id:(A==null?void 0:A.id)||void 0,p_coupon_discount:U||0});if(o){b.error("Order placement RPC error",{error:o}),u.error("Failed to place order. Please try again.");return}const a=r;if(!a.success){if(a.error_code==="STOCK_CONFLICT"&&a.conflict_items&&a.conflict_items.length>0){me(s),Q(a.conflict_items),N(!1),K(!0);return}u.error(a.error||"Failed to place order"),(a.product_id||a.error_code==="STOCK_CONFLICT")&&P();return}L==="new"&&s&&(await p.from("profiles").update({address:s}).eq("id",n.id),q(s)),Y(a.order_id||""),N(!1),g([]),h(),H(null),W(0),S(!1),v(""),$(!0)}catch(t){b.error("Order placement error",{error:t instanceof Error?t.message:String(t)}),u.error("Failed to place order. Please try again.")}finally{ue(!1)}},is=async()=>{if(n)try{const{data:s,error:t}=await p.rpc("adjust_cart_to_stock",{p_user_id:n.id});if(t)throw b.error("Failed to adjust cart quantities",{error:t}),t;s.success&&(await P(),h())}catch(s){throw b.error("Adjust quantities error",{error:s}),s}},ds=async()=>{if(n)try{const{data:s,error:t}=await p.rpc("remove_unavailable_cart_items",{p_user_id:n.id});if(t)throw b.error("Failed to remove unavailable items",{error:t}),t;s.success&&(await P(),h())}catch(s){throw b.error("Remove unavailable error",{error:s}),s}},us=()=>{K(!1),Q([]),as&&N(!0)},J=s=>{var t;return((t=s.product_variants)==null?void 0:t.price)??s.products.price},we=s=>{var t;return((t=s.product_variants)==null?void 0:t.mrp)??s.products.mrp??s.products.price},X=d.length>0&&d.every(s=>{var r;return(((r=s.products.name)==null?void 0:r.toLowerCase())||"").includes("water")}),_e=d.reduce((s,t)=>s+we(t)*t.quantity,0),B=d.reduce((s,t)=>s+J(t)*t.quantity,0),Z=_e-B,E=U,ee=35,se=B>200||X?0:ee,te=B>200||X?ee:0,k=Z+E+te,ke=B-E+se;return D?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5 pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl supports-[backdrop-filter]:bg-background/20",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-3",children:[e.jsx(De,{className:"h-9 w-9"}),e.jsx(De,{className:"h-6 w-32"})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[[1,2,3].map(s=>e.jsx("div",{className:"h-24 w-full rounded-xl bg-muted/80 animate-pulse"},s)),e.jsx("div",{className:"h-48 w-full rounded-xl bg-muted/80 animate-pulse"})]}),e.jsx(ae,{})]}):n?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5 pb-44",children:[I&&e.jsx(ks,{orderId:z,onClose:()=>$(!1)}),e.jsxs("div",{className:`sticky z-40 transition-all duration-300 ${pe?"top-0":"-top-32"}`,children:[e.jsx("header",{className:"border-b border-border/40 bg-background/40 backdrop-blur-xl supports-[backdrop-filter]:bg-background/20 shadow-sm",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>f("/shop"),children:e.jsx(Ie,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary to-primary/80 flex items-center justify-center",children:e.jsx(ie,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"Your Cart"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.length," items"]})]})]})]})}),d.length>0&&k>0&&e.jsx("div",{className:"bg-gradient-to-r from-green-600 via-emerald-600 to-green-600 text-white py-2.5 text-center shadow-md",children:e.jsxs("p",{className:"text-sm font-bold",children:["ðŸŽ‰ You save â‚¹",k.toFixed(0)]})})]}),!pe&&d.length>0&&k>0&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-green-600 via-emerald-600 to-green-600 text-white py-2.5 text-center shadow-md transition-all duration-300",children:e.jsxs("p",{className:"text-sm font-bold",children:["ðŸŽ‰ You save â‚¹",k.toFixed(0)]})}),e.jsxs("main",{className:"container mx-auto px-4 py-4 space-y-4 max-w-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-green-500/10 border border-green-500/20",children:[e.jsx(js,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-700 dark:text-green-400",children:"Estimated delivery: 15-30 mins"}),e.jsx("p",{className:"text-xs text-green-600/70",children:"Free delivery on orders above â‚¹200"})]})]}),d.length===0&&e.jsxs(V,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ie,{className:"h-16 w-16 text-muted-foreground/30 mb-4"}),e.jsx("h2",{className:"text-lg font-semibold text-muted-foreground",children:"Your cart is empty"}),e.jsx("p",{className:"text-sm text-muted-foreground/70 mb-4",children:"Browse our products and add items"}),e.jsxs(x,{onClick:()=>f("/shop"),children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Shop Now"]})]}),d.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:["Cart (",d.length,")"]}),d.map(s=>{const t=s.products.stock_quantity<=5&&s.products.stock_quantity>0,r=s.products.stock_quantity<=0;return e.jsx(V,{className:`overflow-hidden ${r?"opacity-60 border-destructive/50":""}`,children:e.jsx(re,{className:"p-3",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden bg-muted flex-shrink-0",children:s.products.image_url?e.jsx("img",{src:s.products.image_url,alt:s.products.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(de,{className:"h-8 w-8 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm truncate cursor-pointer hover:text-primary",onClick:()=>f(`/product/${s.product_id}`),children:s.products.name}),s.product_variants&&e.jsx("span",{className:"text-xs bg-muted px-1.5 py-0.5 rounded text-muted-foreground",children:Re(s.product_variants)}),(()=>{const o=J(s),a=we(s),l=a>o?Math.round((a-o)/a*100):0,m=s.product_variants?Re(s.product_variants):s.products.unit;return l>0?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs text-green-600 font-semibold",children:[l,"% OFF"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["â‚¹",o," / ",m]}),e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["â‚¹",a]})]}):e.jsxs("p",{className:"text-xs text-muted-foreground",children:["â‚¹",o," / ",m]})})()]}),e.jsxs("p",{className:"font-bold text-primary whitespace-nowrap",children:["â‚¹",(J(s)*s.quantity).toFixed(0)]})]}),t&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(oe,{className:"h-3 w-3 text-amber-500"}),e.jsxs("span",{className:"text-xs text-amber-600",children:["Only ",s.products.stock_quantity," left"]})]}),r&&e.jsx(He,{variant:"destructive",className:"text-xs mt-1",children:"Out of Stock"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx(vs,{quantity:s.quantity,maxQuantity:s.products.stock_quantity,onIncrement:()=>be(s.id,s.quantity+1),onDecrement:()=>be(s.id,s.quantity-1),variant:"full",disabled:r}),e.jsx("div",{className:"flex gap-1",children:e.jsx(x,{size:"icon",variant:"ghost",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>Ne(s.id),children:e.jsx(Ue,{className:"h-4 w-4"})})})]})]})]})})},s.id)})]}),d.length>0&&e.jsx(V,{children:e.jsxs(re,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Promo Code"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(ne,{placeholder:"Enter code",value:j,onChange:s=>v(s.target.value),className:"flex-1",disabled:w}),w?e.jsxs(x,{onClick:cs,variant:"outline",children:[e.jsx(Ns,{className:"h-4 w-4 mr-1"}),"Remove"]}):e.jsx(x,{onClick:os,disabled:!j.trim(),children:"Apply"})]}),A&&e.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-green-500/10 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:A.code})]}),e.jsxs("span",{className:"text-sm font-bold text-green-600",children:["-â‚¹",U.toFixed(0)]})]}),e.jsx("p",{className:"text-xs text-green-600/80 mt-1",children:A.description})]}),G.length>0&&!A&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Available for you:"}),e.jsx(As,{className:"gap-2",showButtons:!0,children:G.map(s=>{const t=d.reduce((o,a)=>{var m;const l=((m=a.product_variants)==null?void 0:m.price)??a.products.price;return o+l*a.quantity},0),r=s.minimum_order<=t;return e.jsxs("button",{onClick:()=>r&&ve(s),disabled:!r,className:`flex-shrink-0 px-4 py-2.5 rounded-xl border-2 transition-all duration-200 ${r?"border-green-500 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-950/40 dark:to-emerald-950/40 hover:from-green-100 hover:to-emerald-100 dark:hover:from-green-900/50 dark:hover:to-emerald-900/50 cursor-pointer shadow-md hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]":"border-gray-200 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 opacity-50 cursor-not-allowed"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:`h-4 w-4 ${r?"text-green-600":"text-gray-400"}`}),e.jsx("span",{className:`text-sm font-bold ${r?"text-green-700 dark:text-green-400":"text-gray-500"}`,children:s.code})]}),e.jsxs("p",{className:`text-xs mt-0.5 text-left whitespace-nowrap ${r?"text-green-600/80":"text-gray-400"}`,children:[s.discount_type==="percentage"?`${s.discount_value}% off`:`â‚¹${s.discount_value} off`,s.minimum_order>0&&` â€¢ Min â‚¹${s.minimum_order}`]})]},s.id)})})]})]})}),d.length>0&&e.jsxs(V,{className:"border-primary/20",children:[e.jsx(ys,{className:"pb-2",children:e.jsx(ws,{className:"text-base",children:"Order Summary"})}),e.jsxs(re,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal (MRP)"}),e.jsxs("span",{children:["â‚¹",_e.toFixed(0)]})]}),Z>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"ðŸŽ‰ Product Discount"}),e.jsxs("span",{children:["-â‚¹",Z.toFixed(0)]})]}),E>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"ðŸŽŸï¸ Coupon Discount"}),e.jsxs("span",{children:["-â‚¹",E.toFixed(0)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery"}),se===0?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"line-through text-muted-foreground",children:["â‚¹",ee]}),e.jsx("span",{className:"text-green-600 font-semibold",children:"FREE"})]}):e.jsxs("span",{children:["â‚¹",se]})]}),te>0&&e.jsxs("div",{className:"flex justify-between text-xs text-green-600",children:[e.jsxs("span",{children:["ðŸšš ",X?"Free delivery on Water":"Free delivery on orders over â‚¹200"]}),e.jsxs("span",{children:["-â‚¹",te.toFixed(0)]})]}),e.jsx(le,{}),k>0&&e.jsxs("div",{className:"flex justify-between text-sm font-semibold text-green-600 bg-green-50 dark:bg-green-950/30 p-2 rounded-lg",children:[e.jsx("span",{children:"ðŸ’° Total Savings"}),e.jsxs("span",{children:["â‚¹",k.toFixed(0)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["â‚¹",ke.toFixed(0)]})]}),e.jsxs(x,{ref:xe,className:"w-full h-12 text-base font-semibold mt-2",onClick:ye,children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),"Proceed to Checkout"]}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground flex items-center justify-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),"100% secure checkout"]})]})]})]}),d.length>0&&e.jsx("div",{className:`fixed bottom-16 left-0 right-0 z-30 border-t bg-background/95 backdrop-blur-xl shadow-[0_-4px_20px_rgba(0,0,0,0.1)] transition-all duration-300 ${rs?"opacity-0 translate-y-full pointer-events-none":"opacity-100 translate-y-0"}`,children:e.jsx("div",{className:"container mx-auto px-4 py-3 max-w-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Amount"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:["â‚¹",ke.toFixed(0)]}),k>0&&e.jsxs("p",{className:"text-xs text-green-600 font-medium",children:["You save â‚¹",k.toFixed(0),"!"]})]}),e.jsxs(x,{className:"h-12 px-8 text-base font-semibold",onClick:ye,children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),"Checkout"]})]})})}),e.jsx(Ve,{open:T,onOpenChange:N,children:e.jsxs(ze,{className:"max-w-md",children:[e.jsx(Ye,{children:e.jsxs(Me,{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-5 w-5 text-primary"}),"Delivery Address"]})}),e.jsxs(Cs,{value:L,onValueChange:s=>Ke(s),children:[i&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg border",children:[e.jsx(Le,{value:"saved",id:"saved",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(R,{htmlFor:"saved",className:"font-medium cursor-pointer",children:"Saved Address"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg border",children:[e.jsx(Le,{value:"new",id:"new",className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(R,{htmlFor:"new",className:"font-medium cursor-pointer",children:"New Address"}),L==="new"&&e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm",children:"Apartment Complex"}),e.jsxs("select",{value:_,onChange:s=>Je(s.target.value),className:"w-full mt-1.5 p-2.5 border rounded-md bg-background text-sm",children:[e.jsx("option",{value:"",children:"Select your apartment..."}),e.jsx("option",{value:"VBHC Vaibhava",children:"VBHC Vaibhava"}),e.jsx("option",{value:"Symphony",children:"Symphony"})]}),_&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["ðŸ“ ",_,", Chandapura-Anekal Road, Bangalore - 562106"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm",children:"Block/Tower"}),e.jsx(ne,{placeholder:"e.g., 51",value:F,onChange:s=>Xe(s.target.value),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm",children:"Room Number"}),e.jsx(ne,{placeholder:"e.g., 603",value:O,onChange:s=>Ze(s.target.value),className:"mt-1.5"})]})]}),_&&(F||O)&&e.jsxs("div",{className:"p-2 bg-muted/50 rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium",children:"Delivery to:"}),e.jsxs("p",{className:"text-muted-foreground",children:[F&&`Block ${F}`,O&&`, Room ${O}`,e.jsx("br",{}),_,", Chandapura-Anekal Road, Bangalore - 562106"]})]})]})]})]})]}),e.jsxs(Ge,{children:[e.jsx(x,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(x,{onClick:ls,disabled:M,children:M?"Placing Order...":"Confirm Order"})]})]})}),e.jsx(qs,{open:ss,onClose:()=>{K(!1),Q([]),me("")},conflictItems:ts,onAdjustQuantities:is,onRemoveUnavailable:ds,onRetryCheckout:us,isLoading:M}),e.jsx(ae,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5 flex flex-col",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>f("/shop"),children:e.jsx(Ie,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-bold",children:"Your Cart"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mb-6",children:e.jsx(Pe,{className:"h-10 w-10 text-muted-foreground"})}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Sign in to view your cart"}),e.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Please sign in to access your cart and complete your purchase"}),e.jsxs(x,{size:"lg",onClick:()=>f("/auth"),className:"px-8",children:[e.jsx(Pe,{className:"h-5 w-5 mr-2"}),"Sign In"]})]}),e.jsx(ae,{})]})}export{Ts as default};
