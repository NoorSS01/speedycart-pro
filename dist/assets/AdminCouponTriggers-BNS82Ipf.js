import{q as U,u as K,a as Q,r as d,s as u,l as X,j as e,S as y,B as c,A as Y,Z as x,Q as S,C as A,c as I,i as _,K as F,$ as J,a0 as ee,a1 as se,a2 as ae,a3 as ie,H as t,I as r,a5 as E,a6 as L,a7 as P,a8 as z,a9 as j,a4 as ne,z as te,V as re,n as o}from"./index-BASgNFzI.js";import{A as ce}from"./AdminBottomNav-DtMwhqJL.js";import{P as oe}from"./pencil-JA67TztW.js";import{D as de,C as le}from"./dollar-sign-CqV00g-Q.js";import{U as ue}from"./user-plus-BeCBgL95.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=U("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=U("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),h=[{value:"new_user",label:"New User",icon:ue,description:"First signup or first order"},{value:"inactivity",label:"Inactivity",icon:te,description:"User hasn't ordered in X days"},{value:"cart_abandonment",label:"Cart Abandonment",icon:re,description:"Added items but didn't checkout"},{value:"loyalty",label:"Loyalty Reward",icon:me,description:"Reward frequent shoppers"},{value:"scheduled",label:"Scheduled",icon:le,description:"Time-based promotions"}];function ye(){var D;const{user:f,userRole:N,loading:b}=K(),g=Q(),[C,q]=d.useState([]),[O,V]=d.useState(!0),[M,l]=d.useState(!1),[m,w]=d.useState(null),[i,n]=d.useState({name:"",description:"",trigger_type:"new_user",discount_type:"percentage",discount_value:10,min_order_amount:0,max_discount:50,coupon_code_prefix:"AUTO",coupon_valid_days:7,max_uses_per_user:1,is_active:!0,days_inactive:7,min_orders:5,min_total_spend:1e3}),T=N==="admin"||N==="super_admin";d.useEffect(()=>{if(!b){if(!f||!T){g("/");return}p()}},[f,b,T,g]);const p=async()=>{try{const{data:s}=await u.from("coupon_triggers").select("*").order("priority",{ascending:!1});s&&q(s)}catch(s){X.error("Failed to fetch coupon triggers",{error:s})}V(!1)},k=()=>{w(null),n({name:"",description:"",trigger_type:"new_user",discount_type:"percentage",discount_value:10,min_order_amount:0,max_discount:50,coupon_code_prefix:"AUTO",coupon_valid_days:7,max_uses_per_user:1,is_active:!0,days_inactive:7,min_orders:5,min_total_spend:1e3}),l(!0)},R=s=>{w(s);const a=s.conditions||{};n({name:s.name,description:s.description||"",trigger_type:s.trigger_type,discount_type:s.discount_type,discount_value:s.discount_value,min_order_amount:s.min_order_amount,max_discount:s.max_discount||50,coupon_code_prefix:s.coupon_code_prefix,coupon_valid_days:s.coupon_valid_days,max_uses_per_user:s.max_uses_per_user,is_active:s.is_active,days_inactive:a.days_inactive||7,min_orders:a.min_orders||5,min_total_spend:a.min_total_spend||1e3}),l(!0)},B=()=>{const s={};switch(i.trigger_type){case"inactivity":s.days_inactive=i.days_inactive;break;case"loyalty":s.min_orders=i.min_orders,s.min_total_spend=i.min_total_spend;break;case"cart_abandonment":s.hours_abandoned=24;break}return s},$=async()=>{if(!i.name.trim()){o.error("Name is required");return}try{const s={name:i.name,description:i.description||null,trigger_type:i.trigger_type,conditions:B(),discount_type:i.discount_type,discount_value:i.discount_value,min_order_amount:i.min_order_amount,max_discount:i.discount_type==="percentage"?i.max_discount:null,coupon_code_prefix:i.coupon_code_prefix.toUpperCase(),coupon_valid_days:i.coupon_valid_days,max_uses_per_user:i.max_uses_per_user,is_active:i.is_active,updated_at:new Date().toISOString()};m?(await u.from("coupon_triggers").update(s).eq("id",m.id),o.success("Trigger updated")):(await u.from("coupon_triggers").insert(s),o.success("Trigger created")),l(!1),p()}catch{o.error("Failed to save trigger")}},G=async s=>{if(confirm("Delete this coupon trigger?"))try{await u.from("coupon_triggers").delete().eq("id",s),o.success("Trigger deleted"),p()}catch{o.error("Failed to delete")}},H=async s=>{try{await u.from("coupon_triggers").update({is_active:!s.is_active}).eq("id",s.id),p()}catch{o.error("Failed to update")}},W=s=>{const a=h.find(v=>v.value===s);return a?a.icon:x},Z=s=>{const a=h.find(v=>v.value===s);return a?a.label:s};return O?e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-3",children:[e.jsx(y,{className:"h-8 w-8"}),e.jsx(y,{className:"h-6 w-40"})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3].map(s=>e.jsx(y,{className:"h-24 rounded-xl"},s))})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>g("/admin"),children:e.jsx(Y,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5 text-primary"}),e.jsx("h1",{className:"text-lg font-bold",children:"Coupon Triggers"})]})]}),e.jsxs(c,{onClick:k,size:"sm",children:[e.jsx(S,{className:"h-4 w-4 mr-1"})," Add Trigger"]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 rounded-xl p-4 border border-primary/20",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4 text-primary"}),"Automatic Coupon Triggers"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Create rules to automatically give coupons to users based on their behavior - like welcoming new users, re-engaging inactive customers, or rewarding loyalty."})]})}),e.jsx("div",{className:"container mx-auto px-4 py-2 space-y-4",children:C.length===0?e.jsx(A,{children:e.jsxs(I,{className:"py-12 text-center",children:[e.jsx(x,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No coupon triggers yet"}),e.jsxs(c,{onClick:k,className:"mt-4",children:[e.jsx(S,{className:"h-4 w-4 mr-2"})," Create First Trigger"]})]})}):C.map(s=>{const a=W(s.trigger_type);return e.jsx(A,{className:s.is_active?"":"opacity-60",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(a,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx(_,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.description||Z(s.trigger_type)}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsx(_,{variant:"outline",children:s.discount_type==="percentage"?`${s.discount_value}% off`:`₹${s.discount_value} off`}),s.min_order_amount>0&&e.jsxs(_,{variant:"outline",children:["Min ₹",s.min_order_amount]}),e.jsxs(_,{variant:"outline",children:["Valid ",s.coupon_valid_days," days"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{checked:s.is_active,onCheckedChange:()=>H(s)}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>R(s),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>G(s.id),children:e.jsx(J,{className:"h-4 w-4 text-destructive"})})]})]})})},s.id)})}),e.jsx(ee,{open:M,onOpenChange:l,children:e.jsxs(se,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(ae,{children:e.jsx(ie,{children:m?"Edit Coupon Trigger":"Create Coupon Trigger"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Trigger Name *"}),e.jsx(r,{value:i.name,onChange:s=>n(a=>({...a,name:s.target.value})),placeholder:"e.g., Welcome Discount"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Description"}),e.jsx(r,{value:i.description,onChange:s=>n(a=>({...a,description:s.target.value})),placeholder:"e.g., 10% off for new users"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Trigger Type"}),e.jsxs(E,{value:i.trigger_type,onValueChange:s=>n(a=>({...a,trigger_type:s})),children:[e.jsx(L,{children:e.jsx(P,{})}),e.jsx(z,{children:h.map(s=>e.jsx(j,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{children:s.label})]})},s.value))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(D=h.find(s=>s.value===i.trigger_type))==null?void 0:D.description})]}),i.trigger_type==="inactivity"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Days Inactive"}),e.jsx(r,{type:"number",value:i.days_inactive,onChange:s=>n(a=>({...a,days_inactive:parseInt(s.target.value)||7})),min:1}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Trigger if user hasn't ordered in this many days"})]}),i.trigger_type==="loyalty"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Minimum Orders"}),e.jsx(r,{type:"number",value:i.min_orders,onChange:s=>n(a=>({...a,min_orders:parseInt(s.target.value)||5})),min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Minimum Total Spend (₹)"}),e.jsx(r,{type:"number",value:i.min_total_spend,onChange:s=>n(a=>({...a,min_total_spend:parseInt(s.target.value)||0})),min:0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Discount Type"}),e.jsxs(E,{value:i.discount_type,onValueChange:s=>n(a=>({...a,discount_type:s})),children:[e.jsx(L,{children:e.jsx(P,{})}),e.jsxs(z,{children:[e.jsx(j,{value:"percentage",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Percentage"]})}),e.jsx(j,{value:"fixed",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Fixed Amount"]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{children:["Discount Value ",i.discount_type==="percentage"?"(%)":"(₹)"]}),e.jsx(r,{type:"number",value:i.discount_value,onChange:s=>n(a=>({...a,discount_value:parseFloat(s.target.value)||0})),min:0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Min Order Amount (₹)"}),e.jsx(r,{type:"number",value:i.min_order_amount,onChange:s=>n(a=>({...a,min_order_amount:parseFloat(s.target.value)||0})),min:0})]}),i.discount_type==="percentage"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Max Discount Cap (₹)"}),e.jsx(r,{type:"number",value:i.max_discount,onChange:s=>n(a=>({...a,max_discount:parseFloat(s.target.value)||0})),min:0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Code Prefix"}),e.jsx(r,{value:i.coupon_code_prefix,onChange:s=>n(a=>({...a,coupon_code_prefix:s.target.value.toUpperCase()})),placeholder:"WELCOME",maxLength:10})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Valid Days"}),e.jsx(r,{type:"number",value:i.coupon_valid_days,onChange:s=>n(a=>({...a,coupon_valid_days:parseInt(s.target.value)||7})),min:1})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"active",checked:i.is_active,onCheckedChange:s=>n(a=>({...a,is_active:s}))}),e.jsx(t,{htmlFor:"active",children:"Active"})]})]}),e.jsxs(ne,{children:[e.jsx(c,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(c,{onClick:$,children:m?"Save Changes":"Create Trigger"})]})]})}),e.jsx(ce,{})]})}export{ye as default};
