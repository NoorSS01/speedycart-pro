import{u as z,a as F,r as c,j as e,S as N,C as w,D as P,E as D,F as B,c as k,B as o,aa as C,T as G,s as f,m as p}from"./index-CWmUW0Oc.js";import{A as _,W as H}from"./AdminBottomNav-BKUm4YDC.js";import"./boxes-b2j2-WXi.js";const E="8310807978",V=`${E}@ybl`,J=()=>{const{user:j,userRole:n,loading:h}=z(),m=F(),[r,S]=c.useState({deliveredOrders:0,commissionDeveloper:0,commissionDelivery:0}),[a,O]=c.useState(null),[A,I]=c.useState(!0),[R,x]=c.useState(!1),[$,u]=c.useState(!1);c.useEffect(()=>{if(h)return;if(!j){m("/auth");return}if(n===null)return;if(n!=="admin"&&n!=="super_admin"){switch(n){case"delivery":m("/delivery");break;default:m("/shop");break}return}(async()=>{try{await Promise.all([U(),L()])}finally{I(!1)}})()},[j,n,h,m]);const U=async()=>{const{data:s,error:l}=await f.from("orders").select("status, total_amount");if(l){console.error("Error fetching payout stats",l),p.error("Failed to load payout details");return}if(s){const t=s.filter(T=>T.status==="delivered").length,d=t*4,i=t*5;S({deliveredOrders:t,commissionDeveloper:d,commissionDelivery:i})}},L=async()=>{const{data:s,error:l}=await f.from("user_roles").select("user_id").eq("role","delivery");if(l||!s||s.length===0)return;const t=s.map(i=>i.user_id),{data:d}=await f.from("profiles").select("id, full_name, phone").in("id",t);if(d&&d.length>0){const i=d[0];O({full_name:i.full_name,phone:i.phone})}},y=(s,l,t)=>`upi://pay?pa=${encodeURIComponent(s)}&pn=${encodeURIComponent(l)}&am=${t.toFixed(2)}&cu=INR&tn=${encodeURIComponent("PremasShop payout")}`,v=s=>{window.location.href=s},g=()=>{if(r.commissionDeveloper<=0){p.message("No payout pending for developer");return}const s=y(V,"Developer",r.commissionDeveloper);v(s)},b=()=>{if(r.commissionDelivery<=0){p.message("No payout pending for delivery partners");return}if(!a||!a.phone){p.error("No delivery partner phone available");return}const s=`${a.phone}@upi`,l=a.full_name||"Delivery Partner",t=y(s,l,r.commissionDelivery);v(t)};return h||n===null||A?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(N,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2].map(s=>e.jsx(N,{className:"h-48 rounded-xl"},s))}),e.jsx(_,{})]}):n!=="admin"&&n!=="super_admin"?null:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(H,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"Pending Payments"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage commission payouts"})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[e.jsxs(w,{children:[e.jsx(P,{className:"pb-2",children:e.jsxs(D,{className:"text-base flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-indigo-500"}),"Developer Commission"]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount to Pay"}),e.jsxs("p",{className:"text-3xl font-bold",children:["₹",r.commissionDeveloper]})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsxs("p",{children:[r.deliveredOrders," orders"]}),e.jsx("p",{children:"₹4/order"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Pay to: ",E]}),e.jsxs(o,{className:"w-full",onClick:()=>x(!0),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Pay Now"]})]})]}),e.jsxs(w,{children:[e.jsx(P,{className:"pb-2",children:e.jsxs(D,{className:"text-base flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-rose-500"}),"Delivery Partner Commission"]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount to Pay"}),e.jsxs("p",{className:"text-3xl font-bold",children:["₹",r.commissionDelivery]})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsxs("p",{children:[r.deliveredOrders," orders"]}),e.jsx("p",{children:"₹5/order"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:a!=null&&a.phone?`Pay to: ${a.full_name||"Partner"} (${a.phone})`:"No delivery partner found"}),e.jsxs(o,{className:"w-full",onClick:()=>u(!0),disabled:!(a!=null&&a.phone),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Pay Now"]})]})]})]}),R&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-background rounded-2xl p-6 w-full max-w-sm space-y-4 shadow-2xl border",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Pay Developer"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Amount: ₹",r.commissionDeveloper]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{className:"flex-1",onClick:()=>{g(),x(!1)},children:"GPay"}),e.jsx(o,{className:"flex-1",variant:"outline",onClick:()=>{g(),x(!1)},children:"PhonePe"})]}),e.jsx(o,{variant:"ghost",className:"w-full",onClick:()=>x(!1),children:"Cancel"})]})}),$&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-background rounded-2xl p-6 w-full max-w-sm space-y-4 shadow-2xl border",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Pay Delivery Partner"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Amount: ₹",r.commissionDelivery]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{className:"flex-1",onClick:()=>{b(),u(!1)},children:"GPay"}),e.jsx(o,{className:"flex-1",variant:"outline",onClick:()=>{b(),u(!1)},children:"PhonePe"})]}),e.jsx(o,{variant:"ghost",className:"w-full",onClick:()=>u(!1),children:"Cancel"})]})}),e.jsx(_,{})]})};export{J as default};
