import{u as A,a as $,r as a,s as h,n as _,j as e,S as g,Y as E,I as F,P as q,C as I,c as M,i as f,B as j,_ as O,Q as D}from"./index-DW4BMzOc.js";import{A as C,B as Q}from"./AdminBottomNav-CUbuezxo.js";import{S as U}from"./square-pen-JlCCJjvZ.js";import{R as Y}from"./refresh-cw-D1_Y7Z1u.js";function V(){const{user:b,userRole:n,loading:m}=A(),l=$(),[d,N]=a.useState([]),[G,P]=a.useState([]),[k,L]=a.useState(""),[i,x]=a.useState("all"),[u,p]=a.useState(new Set),[B,y]=a.useState(!0);a.useEffect(()=>{if(!m){if(!b){l("/auth");return}if(n!==null){if(n!=="admin"&&n!=="super_admin"){switch(n){case"delivery":l("/delivery");break;default:l("/shop");break}return}v()}}},[b,n,m,l]);const v=async()=>{y(!0);try{const[t,s]=await Promise.all([h.from("products").select("*").order("stock_quantity",{ascending:!0}),h.from("categories").select("id, name").order("name")]);t.data&&N(t.data),s.data&&P(s.data)}catch{_.error("Failed to load products")}finally{y(!1)}},w=async(t,s)=>{if(s<0)return;p(o=>new Set(o).add(t)),N(o=>o.map(r=>r.id===t?{...r,stock_quantity:s}:r));const{error:c}=await h.from("products").update({stock_quantity:s}).eq("id",t);c&&(_.error("Failed to update stock"),v()),p(o=>{const r=new Set(o);return r.delete(t),r})},S=d.filter(t=>{const s=t.name.toLowerCase().includes(k.toLowerCase());let c=!0;return i==="low"&&(c=t.stock_quantity>0&&t.stock_quantity<=10),i==="out"&&(c=t.stock_quantity===0),s&&c}),R=d.filter(t=>t.stock_quantity>0&&t.stock_quantity<=10).length,z=d.filter(t=>t.stock_quantity===0).length;return m||n===null?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(g,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3,4].map(t=>e.jsx(g,{className:"h-24 rounded-xl"},t))}),e.jsx(C,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center shadow-lg",children:e.jsx(Q,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"Stock Management"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage product inventory"})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>x("all"),className:`p-3 rounded-xl text-center transition-all ${i==="all"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsx("p",{className:"text-lg font-bold",children:d.length}),e.jsx("p",{className:"text-xs",children:"All"})]}),e.jsxs("button",{onClick:()=>x("low"),className:`p-3 rounded-xl text-center transition-all ${i==="low"?"bg-amber-500 text-white":"bg-amber-50 text-amber-700"}`,children:[e.jsx("p",{className:"text-lg font-bold",children:R}),e.jsx("p",{className:"text-xs",children:"Low Stock"})]}),e.jsxs("button",{onClick:()=>x("out"),className:`p-3 rounded-xl text-center transition-all ${i==="out"?"bg-red-500 text-white":"bg-red-50 text-red-700"}`,children:[e.jsx("p",{className:"text-lg font-bold",children:z}),e.jsx("p",{className:"text-xs",children:"Out"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Search products...",value:k,onChange:t=>L(t.target.value),className:"pl-9"})]}),B?[1,2,3,4].map(t=>e.jsx(g,{className:"h-20 rounded-xl"},t)):S.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No products found"})]}):S.map(t=>e.jsx(I,{className:"overflow-hidden",children:e.jsx(M,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg bg-muted flex items-center justify-center overflow-hidden shrink-0",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"}):e.jsx(q,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:t.stock_quantity===0?e.jsx(f,{variant:"destructive",className:"text-[10px]",children:"Out of Stock"}):t.stock_quantity<=10?e.jsxs(f,{className:"bg-amber-500 text-[10px]",children:["Low: ",t.stock_quantity]}):e.jsxs(f,{variant:"outline",className:"text-[10px] text-emerald-600 border-emerald-300",children:["In Stock: ",t.stock_quantity]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>l(`/admin/add-product?id=${t.id}`),title:"Edit Product",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{size:"icon",variant:"outline",className:"h-8 w-8 rounded-full",onClick:()=>w(t.id,t.stock_quantity-1),disabled:t.stock_quantity<=0||u.has(t.id),children:e.jsx(O,{className:"w-3 h-3"})}),e.jsx("span",{className:`w-10 text-center font-bold text-sm ${t.stock_quantity===0?"text-red-500":t.stock_quantity<=10?"text-amber-500":"text-emerald-600"}`,children:u.has(t.id)?e.jsx(Y,{className:"w-4 h-4 animate-spin mx-auto"}):t.stock_quantity}),e.jsx(j,{size:"icon",variant:"outline",className:"h-8 w-8 rounded-full",onClick:()=>w(t.id,t.stock_quantity+1),disabled:u.has(t.id),children:e.jsx(D,{className:"w-3 h-3"})})]})]})]})})},t.id))]}),e.jsx(C,{})]})}export{V as default};
