import{u as P,a as S,r as c,s as v,j as e,S as d,B as l,A as R,h as D,i as N,y as z,C as o,c as m,U as B,a9 as b,ag as y,m as w}from"./index-CWmUW0Oc.js";import{A as E}from"./AdminBottomNav-BKUm4YDC.js";import{P as _}from"./power-BmAvBKYD.js";import"./boxes-b2j2-WXi.js";function O(){const{user:t,userRole:x,loading:h}=P(),i=S(),[u,k]=c.useState([]),[A,C]=c.useState(!0),p=x==="admin"||x==="super_admin";c.useEffect(()=>{if(!h){if(!t||!p){i("/");return}j()}},[t,h,p,i]);const j=async()=>{try{const s=new Date().toISOString().split("T")[0],{data:a}=await v.from("delivery_activations").select(`
                    id, delivery_partner_id, activation_date, status, created_at,
                    profiles:delivery_partner_id(full_name, phone)
                `).eq("activation_date",s).order("created_at",{ascending:!1});a&&k(a)}catch(s){console.error("Error fetching requests:",s)}C(!1)},f=async(s,a)=>{try{await v.from("delivery_activations").update({status:a,admin_id:t==null?void 0:t.id,updated_at:new Date().toISOString()}).eq("id",s),w.success(`Request ${a}`),j()}catch{w.error("Failed to update request")}};if(A)return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-3",children:[e.jsx(d,{className:"h-8 w-8"}),e.jsx(d,{className:"h-6 w-48"})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3].map(s=>e.jsx(d,{className:"h-24 rounded-xl"},s))})]});const r=u.filter(s=>s.status==="pending"),g=u.filter(s=>s.status!=="pending");return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>i("/admin"),children:e.jsx(R,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"Delivery Activations"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Today - ",D(new Date,"PPP")]})]})]}),e.jsxs(N,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),r.length," pending"]})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[r.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-amber-500"}),"Pending Requests"]}),e.jsx("div",{className:"space-y-3",children:r.map(s=>{var a,n;return e.jsx(o,{className:"border-amber-500/50",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-500/10 flex items-center justify-center",children:e.jsx(B,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:((a=s.profiles)==null?void 0:a.full_name)||"Delivery Partner"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((n=s.profiles)==null?void 0:n.phone)||"No phone"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",className:"text-red-500 border-red-500 hover:bg-red-500 hover:text-white",onClick:()=>f(s.id,"rejected"),children:e.jsx(b,{className:"h-4 w-4"})}),e.jsxs(l,{size:"sm",className:"bg-green-500 hover:bg-green-600",onClick:()=>f(s.id,"approved"),children:[e.jsx(y,{className:"h-4 w-4 mr-1"}),"Approve"]})]})]})})},s.id)})})]}),r.length===0&&e.jsx(o,{children:e.jsxs(m,{className:"py-12 text-center",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending activation requests"})]})}),g.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold mb-3 text-sm text-muted-foreground",children:"Processed Today"}),e.jsx("div",{className:"space-y-2",children:g.map(s=>{var a;return e.jsx(o,{className:"opacity-75",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s.status==="approved"?"bg-green-500":"bg-red-500"}`,children:s.status==="approved"?e.jsx(y,{className:"h-4 w-4 text-white"}):e.jsx(b,{className:"h-4 w-4 text-white"})}),e.jsx("span",{className:"text-sm",children:((a=s.profiles)==null?void 0:a.full_name)||"Partner"})]}),e.jsx(N,{variant:s.status==="approved"?"default":"destructive",children:s.status})]})})},s.id)})})]})]}),e.jsx(E,{})]})}export{O as default};
