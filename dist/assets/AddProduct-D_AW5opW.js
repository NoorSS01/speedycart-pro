import{p as ce,u as ne,a as de,an as oe,r as h,s as o,m as N,j as e,S as j,C as q,D as E,c as V,B as _,A as me,O as A,E as Q,P as J,G as c,I as m,a4 as z,a5 as T,a6 as D,a7 as M,a8 as U,_ as W,ac as ue,ao as pe}from"./index-CWmUW0Oc.js";import{A as X}from"./AdminBottomNav-BKUm4YDC.js";import{S as xe}from"./square-pen-ePWdBnNP.js";import"./boxes-b2j2-WXi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=ce("ImagePlus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]),Y=[{value:"piece",label:"Piece"},{value:"pieces",label:"Pieces"},{value:"kg",label:"Kilogram (kg)"},{value:"g",label:"Gram (g)"},{value:"ltr",label:"Litre (ltr)"},{value:"ml",label:"Millilitre (ml)"},{value:"pack",label:"Pack"},{value:"box",label:"Box"},{value:"dozen",label:"Dozen"},{value:"pair",label:"Pair"},{value:"unit",label:"Unit"},{value:"serving",label:"Serving"}];function Ne(){const{user:O,userRole:v,loading:S}=ne(),b=de(),[Z]=oe(),f=Z.get("id"),d=!!f,[ee,ae]=h.useState([]),[L,k]=h.useState(!1),[se,R]=h.useState(!1),[r,u]=h.useState({name:"",description:"",price:"",mrp:"",stock_quantity:"",unit:"piece",category_id:"",image_url:""}),[x,w]=h.useState([]),[p,F]=h.useState([]),[I,B]=h.useState("");h.useEffect(()=>{if(!S){if(!O){b("/auth");return}if(v!==null){if(v!=="admin"&&v!=="super_admin"){b("/shop");return}re(),d&&f&&te(f)}}},[O,v,S,b,d,f]);const re=async()=>{const{data:a}=await o.from("categories").select("id, name").order("name");a&&ae(a)},te=async a=>{var i,g,P;R(!0);const{data:s,error:t}=await o.from("products").select("*").eq("id",a).single();if(t||!s){N.error("Failed to load product"),b("/admin");return}u({name:s.name||"",description:s.description||"",price:((i=s.price)==null?void 0:i.toString())||"",mrp:((g=s.mrp)==null?void 0:g.toString())||"",stock_quantity:((P=s.stock_quantity)==null?void 0:P.toString())||"",unit:s.unit||"piece",category_id:s.category_id||"",image_url:s.image_url||""});const{data:l}=await o.from("product_variants").select("*").eq("product_id",a).order("display_order");l&&l.length>0&&w(l.map(n=>{var C,$,K;return{id:n.id,variant_name:n.variant_name,variant_value:((C=n.variant_value)==null?void 0:C.toString())||"",variant_unit:n.variant_unit,price:(($=n.price)==null?void 0:$.toString())||"",mrp:((K=n.mrp)==null?void 0:K.toString())||"",is_default:n.is_default||!1}}));try{const{data:n}=await o.from("product_images").select("image_url").eq("product_id",a).order("display_order");n&&n.length>0&&F(n.map(C=>C.image_url))}catch{console.log("Product images table may not exist yet")}R(!1)},le=async()=>{if(!r.name||!r.price||!r.category_id){N.error("Please fill all required fields");return}k(!0);const a={name:r.name,description:r.description||null,price:parseFloat(r.price),mrp:r.mrp?parseFloat(r.mrp):null,stock_quantity:parseInt(r.stock_quantity)||0,unit:r.unit,category_id:r.category_id,image_url:r.image_url||null,is_active:!0};let s=f;if(d&&f){const{error:t}=await o.from("products").update(a).eq("id",f);if(t){N.error("Failed to update product"),k(!1);return}}else{const{data:t,error:l}=await o.from("products").insert(a).select("id").single();if(l||!t){N.error("Failed to create product"),k(!1);return}s=t.id}if(s&&x.length>0){await o.from("product_variants").delete().eq("product_id",s);const t=x.map((i,g)=>({product_id:s,variant_name:i.variant_name,variant_value:parseFloat(i.variant_value)||1,variant_unit:i.variant_unit,price:parseFloat(i.price)||0,mrp:i.mrp?parseFloat(i.mrp):null,is_default:i.is_default,display_order:g})),{error:l}=await o.from("product_variants").insert(t);l&&(console.error("Variant error:",l),N.error("Product saved but some variants failed"))}if(s&&p.length>0){console.log("Saving additional images:",p.length,"images for product:",s);const{error:t}=await o.from("product_images").delete().eq("product_id",s);t&&console.error("Error deleting existing images:",t);const l=p.map((P,n)=>({product_id:s,image_url:P,display_order:n+1,is_primary:!1}));console.log("Inserting images:",l);const{error:i,data:g}=await o.from("product_images").insert(l).select();i?(console.error("Image insert error:",i),N.error("Product saved but some images failed: "+i.message)):console.log("Images saved successfully:",g)}else console.log("No additional images to save. additionalImages:",p);N.success(d?"Product updated successfully!":"Product created successfully!"),b("/admin"),k(!1)},G=()=>{w([...x,{variant_name:"",variant_value:"1",variant_unit:"kg",price:"",mrp:"",is_default:x.length===0}])},y=(a,s,t)=>{const l=[...x];l[a]={...l[a],[s]:t},s==="is_default"&&t===!0&&l.forEach((i,g)=>{g!==a&&(i.is_default=!1)}),w(l)},ie=a=>{const s=x.filter((t,l)=>l!==a);s.length>0&&!s.some(t=>t.is_default)&&(s[0].is_default=!0),w(s)},H=r.mrp&&r.price?Math.round((parseFloat(r.mrp)-parseFloat(r.price))/parseFloat(r.mrp)*100):0;return S||v===null||se?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl supports-[backdrop-filter]:bg-background/20 shadow-[0_10px_40px_rgba(15,23,42,0.35)]",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-9 w-9 rounded-md"}),e.jsx(j,{className:"h-10 w-10 rounded-xl"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-6 w-32"}),e.jsx(j,{className:"h-3 w-24"})]})]})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsxs(q,{children:[e.jsx(E,{children:e.jsx(j,{className:"h-6 w-40"})}),e.jsxs(V,{className:"space-y-5",children:[[1,2,3,4,5,6].map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-4 w-24"}),e.jsx(j,{className:"h-12 w-full"})]},a)),e.jsx(j,{className:"h-12 w-full"})]})]})}),e.jsx(X,{})]}):v!=="admin"&&v!=="super_admin"?null:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl supports-[backdrop-filter]:bg-background/20 shadow-[0_10px_40px_rgba(15,23,42,0.35)]",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>b("/admin"),children:e.jsx(me,{className:"h-5 w-5"})}),e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shadow-lg ${d?"bg-gradient-to-br from-blue-500 to-blue-600":"bg-gradient-to-br from-green-500 to-emerald-600"}`,children:d?e.jsx(xe,{className:"h-5 w-5 text-white"}):e.jsx(A,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:d?"Edit Product":"Add Product"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d?"Update product details":"Create new product"})]})]})})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 max-w-2xl space-y-6",children:[e.jsxs(q,{className:"border-primary/20 shadow-xl bg-card/80 backdrop-blur-sm",children:[e.jsx(E,{className:"pb-4",children:e.jsxs(Q,{className:"flex items-center gap-2 text-lg",children:[e.jsx(J,{className:"h-5 w-5 text-primary"}),"Product Details"]})}),e.jsxs(V,{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"name",className:"text-sm font-medium",children:["Product Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(m,{id:"name",value:r.name,onChange:a=>u({...r,name:a.target.value}),placeholder:"Enter product name",className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"category",className:"text-sm font-medium",children:["Category ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(z,{value:r.category_id,onValueChange:a=>u({...r,category_id:a}),children:[e.jsx(T,{className:"h-12",children:e.jsx(D,{placeholder:"Select category"})}),e.jsx(M,{children:ee.map(a=>e.jsx(U,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"mrp",className:"text-sm font-medium",children:["MRP (â‚¹) ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Original Price)"})]}),e.jsx(m,{id:"mrp",type:"number",value:r.mrp,onChange:a=>u({...r,mrp:a.target.value}),placeholder:"0",className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"price",className:"text-sm font-medium",children:["Selling Price (â‚¹) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(m,{id:"price",type:"number",value:r.price,onChange:a=>u({...r,price:a.target.value}),placeholder:"0",className:"h-12"})]})]}),H>0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsxs("span",{className:"text-green-700 dark:text-green-400 font-semibold",children:["ðŸ’° ",H,"% OFF"]}),e.jsx("span",{className:"text-sm text-green-600 dark:text-green-500",children:"Auto-calculated from MRP & Selling Price"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"stock",className:"text-sm font-medium",children:"Stock Qty"}),e.jsx(m,{id:"stock",type:"number",value:r.stock_quantity,onChange:a=>u({...r,stock_quantity:a.target.value}),placeholder:"0",className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"unit",className:"text-sm font-medium",children:"Unit"}),e.jsxs(z,{value:r.unit,onValueChange:a=>u({...r,unit:a}),children:[e.jsx(T,{className:"h-12",children:e.jsx(D,{})}),e.jsx(M,{children:Y.map(a=>e.jsx(U,{value:a.value,children:a.label},a.value))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Product Images"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-xs text-muted-foreground",children:"Primary Image (Main display)"}),e.jsx(m,{id:"image",value:r.image_url,onChange:a=>u({...r,image_url:a.target.value}),placeholder:"https://example.com/primary-image.jpg",className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-xs text-muted-foreground",children:"Additional Images (Gallery)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{value:I,onChange:a=>B(a.target.value),placeholder:"https://example.com/additional-image.jpg",className:"h-12 flex-1"}),e.jsx(_,{type:"button",variant:"outline",className:"h-12",onClick:()=>{I.trim()&&(F([...p,I.trim()]),B(""))},children:e.jsx(A,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3",children:[r.image_url&&e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border-2 border-primary",children:[e.jsx("img",{src:r.image_url,alt:"Primary",className:"w-full h-full object-cover",onError:a=>{a.currentTarget.style.display="none"}}),e.jsx("span",{className:"absolute top-1 left-1 bg-primary text-primary-foreground text-[10px] px-1.5 py-0.5 rounded",children:"Primary"})]}),p.map((a,s)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border group",children:[e.jsx("img",{src:a,alt:`Image ${s+2}`,className:"w-full h-full object-cover",onError:t=>{t.currentTarget.style.display="none"}}),e.jsx("button",{type:"button",onClick:()=>F(p.filter((t,l)=>l!==s)),className:"absolute top-1 right-1 bg-destructive text-destructive-foreground p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(W,{className:"h-3 w-3"})})]},s))]}),(r.image_url||p.length>0)&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[1+p.length," image(s) added"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",className:"text-sm font-medium",children:"Description"}),e.jsx(ue,{id:"description",value:r.description,onChange:a=>u({...r,description:a.target.value}),placeholder:"Product description...",rows:3,className:"resize-none"})]})]})]}),e.jsxs(q,{className:"border-blue-200 dark:border-blue-800 shadow-xl bg-card/80 backdrop-blur-sm",children:[e.jsxs(E,{className:"pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Q,{className:"flex items-center gap-2 text-lg",children:["ðŸ“¦ Product Variants",e.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"(Optional)"})]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:G,children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Add Variant"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add different sizes/quantities like 500g, 1kg, 1 dozen, 6 pieces..."})]}),e.jsx(V,{className:"space-y-4",children:x.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No variants added. Product will use the base price above."}),e.jsx(_,{variant:"link",onClick:G,className:"mt-2",children:"+ Add your first variant"})]}):x.map((a,s)=>e.jsxs("div",{className:"p-4 border border-border/50 rounded-lg bg-muted/30 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.is_default,onChange:t=>y(s,"is_default",t.target.checked),className:"h-4 w-4 rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Default"})]}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>ie(s),children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Display Name"}),e.jsx(m,{value:a.variant_name,onChange:t=>y(s,"variant_name",t.target.value),placeholder:"e.g. 500g, 1 kg",className:"h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Value"}),e.jsx(m,{type:"number",value:a.variant_value,onChange:t=>y(s,"variant_value",t.target.value),placeholder:"0.5",className:"h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Unit"}),e.jsxs(z,{value:a.variant_unit,onValueChange:t=>y(s,"variant_unit",t),children:[e.jsx(T,{className:"h-10",children:e.jsx(D,{})}),e.jsx(M,{children:Y.map(t=>e.jsx(U,{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"MRP (â‚¹)"}),e.jsx(m,{type:"number",value:a.mrp,onChange:t=>y(s,"mrp",t.target.value),placeholder:"Original price",className:"h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Selling Price (â‚¹) *"}),e.jsx(m,{type:"number",value:a.price,onChange:t=>y(s,"price",t.target.value),placeholder:"Selling price",className:"h-10"})]})]})]},s))})]}),e.jsx(_,{onClick:le,disabled:L,className:"w-full h-14 text-base font-semibold shadow-lg",size:"lg",children:L?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-5 w-5 mr-2 animate-spin"}),d?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),d?"Update Product":"Create Product"]})})]}),e.jsx(X,{})]})}export{Ne as default};
