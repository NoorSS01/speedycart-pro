import{u as Z,b as H,r as a,s as l,y as A,j as e,h as k,S as J,I as K,o as B,k as Q,m as V,q as y,B as u,M as W,$ as X,n as Y,C as ee}from"./index-UMlJGGnY.js";import{A as F}from"./AdminBottomNav-PEGZOFHl.js";import{B as te}from"./wallet-CiFsDb3c.js";import{S as se}from"./square-pen-Dj9Hheyy.js";import{C as ae}from"./chevron-left-C90EL12Y.js";import"./sheet-C2Qfebkd.js";const v=50;function ue(){const{user:w,userRole:i,loading:h}=Z(),c=H(),[S,q]=a.useState([]),[re,O]=a.useState([]),[o,T]=a.useState(""),[r,f]=a.useState("all"),[g,C]=a.useState(new Set),[j,_]=a.useState(!0),[d,b]=a.useState(1),[P,I]=a.useState(0),[E,D]=a.useState(0),[R,G]=a.useState(0);a.useEffect(()=>{if(!h){if(!w){c("/auth");return}if(i!==null){if(i!=="admin"&&i!=="super_admin"){switch(i){case"delivery":c("/delivery");break;default:c("/shop");break}return}N()}}},[w,i,h,c,d,r]);const N=async()=>{_(!0);try{const[t,m,p,n]=await Promise.all([l.from("products").select("id",{count:"exact",head:!0}),l.from("products").select("id",{count:"exact",head:!0}).gt("stock_quantity",0).lte("stock_quantity",10),l.from("products").select("id",{count:"exact",head:!0}).eq("stock_quantity",0),l.from("categories").select("id, name").order("name")]);I(t.count||0),D(m.count||0),G(p.count||0),n.data&&O(n.data);let s=l.from("products").select("*");r==="low"?s=s.gt("stock_quantity",0).lte("stock_quantity",10):r==="out"&&(s=s.eq("stock_quantity",0)),o.trim()&&(s=s.ilike("name",`%${o}%`));const L=(d-1)*v,U=L+v-1,{data:M,error:$}=await s.order("stock_quantity",{ascending:!0}).range(L,U);if(M&&q(M),$)throw $}catch{A.error("Failed to load products")}finally{_(!1)}};a.useEffect(()=>{b(1)},[o,r]),a.useEffect(()=>{const t=setTimeout(()=>{N()},300);return()=>clearTimeout(t)},[o]);const z=async(t,m)=>{if(m<0)return;C(n=>new Set(n).add(t)),q(n=>n.map(s=>s.id===t?{...s,stock_quantity:m}:s));const{error:p}=await l.from("products").update({stock_quantity:m}).eq("id",t);p&&(A.error("Failed to update stock"),N()),C(n=>{const s=new Set(n);return s.delete(t),s})},x=Math.ceil((r==="low"?E:r==="out"?R:P)/v);return h||i===null?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(k,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3,4].map(t=>e.jsx(k,{className:"h-24 rounded-xl"},t))}),e.jsx(F,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center shadow-lg",children:e.jsx(te,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"Stock Management"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage product inventory"})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>f("all"),className:`p-3 rounded-xl text-center transition-all ${r==="all"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsx("p",{className:"text-lg font-bold",children:P}),e.jsx("p",{className:"text-xs",children:"All"})]}),e.jsxs("button",{onClick:()=>f("low"),className:`p-3 rounded-xl text-center transition-all ${r==="low"?"bg-amber-500 text-white":"bg-amber-50 text-amber-700"}`,children:[e.jsx("p",{className:"text-lg font-bold",children:E}),e.jsx("p",{className:"text-xs",children:"Low Stock"})]}),e.jsxs("button",{onClick:()=>f("out"),className:`p-3 rounded-xl text-center transition-all ${r==="out"?"bg-red-500 text-white":"bg-red-50 text-red-700"}`,children:[e.jsx("p",{className:"text-lg font-bold",children:R}),e.jsx("p",{className:"text-xs",children:"Out"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(K,{placeholder:"Search products...",value:o,onChange:t=>T(t.target.value),className:"pl-9"})]}),j?[1,2,3,4].map(t=>e.jsx(k,{className:"h-20 rounded-xl"},t)):S.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(B,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No products found"})]}):S.map(t=>e.jsx(Q,{className:"overflow-hidden",children:e.jsx(V,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg bg-muted flex items-center justify-center overflow-hidden shrink-0",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"}):e.jsx(B,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:t.stock_quantity===0?e.jsx(y,{variant:"destructive",className:"text-[10px]",children:"Out of Stock"}):t.stock_quantity<=10?e.jsxs(y,{className:"bg-amber-500 text-[10px]",children:["Low: ",t.stock_quantity]}):e.jsxs(y,{variant:"outline",className:"text-[10px] text-emerald-600 border-emerald-300",children:["In Stock: ",t.stock_quantity]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>c(`/admin/add-product?id=${t.id}`),title:"Edit Product",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{size:"icon",variant:"outline",className:"h-8 w-8 rounded-full",onClick:()=>z(t.id,t.stock_quantity-1),disabled:t.stock_quantity<=0||g.has(t.id),children:e.jsx(W,{className:"w-3 h-3"})}),e.jsx("span",{className:`w-10 text-center font-bold text-sm ${t.stock_quantity===0?"text-red-500":t.stock_quantity<=10?"text-amber-500":"text-emerald-600"}`,children:g.has(t.id)?e.jsx(X,{className:"w-4 h-4 animate-spin mx-auto"}):t.stock_quantity}),e.jsx(u,{size:"icon",variant:"outline",className:"h-8 w-8 rounded-full",onClick:()=>z(t.id,t.stock_quantity+1),disabled:g.has(t.id),children:e.jsx(Y,{className:"w-3 h-3"})})]})]})]})})},t.id)),x>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>b(t=>Math.max(1,t-1)),disabled:d===1||j,children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",d," of ",x]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>b(t=>Math.min(x,t+1)),disabled:d===x||j,children:["Next",e.jsx(ee,{className:"w-4 h-4 ml-1"})]})]})]}),e.jsx(F,{})]})}export{ue as default};
