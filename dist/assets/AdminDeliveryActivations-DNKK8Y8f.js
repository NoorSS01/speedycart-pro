import{u as F,a as O,r as p,s as v,l as C,j as e,S as j,B as l,A as T,h as $,i as A,z as L,C as x,c as h,U,ac as I,ah as g,E as M,F as H,n as P}from"./index-DVRpR8yI.js";import{A as X}from"./AdminBottomNav-tAHoeiS3.js";import{P as q}from"./power-DdiBX_uO.js";import"./wallet-R6EuwzlW.js";function V(){const{user:c,userRole:N,loading:b}=F(),u=O(),[y,w]=p.useState([]),[z,f]=p.useState(!0),[i,o]=p.useState({open:!1,requestId:null,hours:8}),_=N==="admin"||N==="super_admin";p.useEffect(()=>{if(!b){if(!c||!_){u("/");return}k()}},[c,b,_,u]);const k=async()=>{try{const s=new Date().toISOString().split("T")[0],{data:a,error:r}=await v.from("delivery_activations").select("id, delivery_partner_id, activation_date, status, created_at").eq("activation_date",s).order("created_at",{ascending:!1});if(r){C.error("Failed to fetch activations",{error:r}),f(!1);return}if(!a||a.length===0){w([]),f(!1);return}const n=[...new Set(a.map(t=>t.delivery_partner_id))],{data:d}=await v.from("profiles").select("id, full_name, phone").in("id",n),E=new Map((d||[]).map(t=>[t.id,{full_name:t.full_name,phone:t.phone}])),B=a.map(t=>({id:t.id,delivery_partner_id:t.delivery_partner_id,activation_date:t.activation_date,status:t.status||"pending",created_at:t.created_at||new Date().toISOString(),profiles:E.get(t.delivery_partner_id)||null}));w(B)}catch(s){C.error("Failed to fetch delivery activation requests",{error:s})}f(!1)},D=async(s,a,r)=>{try{const n={status:a,admin_id:c==null?void 0:c.id,updated_at:new Date().toISOString()};if(a==="approved"&&r){const d=new Date;d.setHours(d.getHours()+r),n.approved_until=d.toISOString(),n.duration_hours=r}await v.from("delivery_activations").update(n).eq("id",s),P.success(`Request ${a}${a==="approved"?` for ${r}h`:""}`),o({open:!1,requestId:null,hours:8}),k()}catch{P.error("Failed to update request")}},R=s=>{o({open:!0,requestId:s,hours:8})};if(z)return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center gap-3",children:[e.jsx(j,{className:"h-8 w-8"}),e.jsx(j,{className:"h-6 w-48"})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3].map(s=>e.jsx(j,{className:"h-24 rounded-xl"},s))})]});const m=y.filter(s=>s.status==="pending"),S=y.filter(s=>s.status!=="pending");return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b bg-background/95 backdrop-blur",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>u("/admin"),children:e.jsx(T,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"Delivery Activations"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Today - ",$(new Date,"PPP")]})]})]}),e.jsxs(A,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),m.length," pending"]})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[m.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-amber-500"}),"Pending Requests"]}),e.jsx("div",{className:"space-y-3",children:m.map(s=>{var a,r;return e.jsx(x,{className:"border-amber-500/50",children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-500/10 flex items-center justify-center",children:e.jsx(U,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:((a=s.profiles)==null?void 0:a.full_name)||"Delivery Partner"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((r=s.profiles)==null?void 0:r.phone)||"No phone"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",className:"text-red-500 border-red-500 hover:bg-red-500 hover:text-white",onClick:()=>D(s.id,"rejected"),children:e.jsx(I,{className:"h-4 w-4"})}),e.jsxs(l,{size:"sm",className:"bg-green-500 hover:bg-green-600",onClick:()=>R(s.id),children:[e.jsx(g,{className:"h-4 w-4 mr-1"}),"Approve"]})]})]})})},s.id)})})]}),m.length===0&&e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(q,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending activation requests"})]})}),S.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold mb-3 text-sm text-muted-foreground",children:"Processed Today"}),e.jsx("div",{className:"space-y-2",children:S.map(s=>{var a;return e.jsx(x,{className:"opacity-75",children:e.jsx(h,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s.status==="approved"?"bg-green-500":"bg-red-500"}`,children:s.status==="approved"?e.jsx(g,{className:"h-4 w-4 text-white"}):e.jsx(I,{className:"h-4 w-4 text-white"})}),e.jsx("span",{className:"text-sm",children:((a=s.profiles)==null?void 0:a.full_name)||"Partner"})]}),e.jsx(A,{variant:s.status==="approved"?"default":"destructive",children:s.status})]})})},s.id)})})]})]}),i.open&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:e.jsxs(x,{className:"w-full max-w-sm",children:[e.jsx(M,{children:e.jsx(H,{className:"text-lg",children:"Set Activation Duration"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"How long should this activation be valid?"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[4,6,8,10,12,16,20,24].map(s=>e.jsxs(l,{variant:i.hours===s?"default":"outline",size:"sm",onClick:()=>o(a=>({...a,hours:s})),children:[s,"h"]},s))}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(l,{variant:"outline",className:"flex-1",onClick:()=>o({open:!1,requestId:null,hours:8}),children:"Cancel"}),e.jsxs(l,{className:"flex-1 bg-green-500 hover:bg-green-600",onClick:()=>i.requestId&&D(i.requestId,"approved",i.hours),children:[e.jsx(g,{className:"h-4 w-4 mr-1"}),"Approve for ",i.hours,"h"]})]})]})]})}),e.jsx(X,{})]})}export{V as default};
