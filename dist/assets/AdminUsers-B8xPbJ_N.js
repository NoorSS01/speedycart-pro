import{u as z,a as B,r as t,s as h,m as a,j as e,S as g,B as j,A as E,Q as M,C as l,c as d,D as k,E as U,I as F,a4 as L,a5 as V,a6 as P,a7 as q,a8 as p,h as H,i as Q,_ as $,U as G,T as J,V as K}from"./index-CWmUW0Oc.js";import{A as R}from"./AdminBottomNav-BKUm4YDC.js";import{U as O}from"./user-plus-ZI56hNOs.js";import"./boxes-b2j2-WXi.js";function ee(){const{user:b,userRole:n,loading:o}=z(),c=B(),[r,A]=t.useState([]),[C,N]=t.useState(!0),[x,f]=t.useState(""),[v,S]=t.useState("user"),[_,y]=t.useState(!1);t.useEffect(()=>{if(!o){if(!b){c("/auth");return}if(n!=="admin"&&n!=="super_admin"){c("/shop");return}m()}},[b,n,o,c]);const m=async()=>{N(!0);const{data:s,error:u}=await h.from("user_roles").select("*").order("created_at",{ascending:!1});u?a.error("Failed to load user roles"):A(s||[]),N(!1)},I=async()=>{if(!x.trim()){a.error("Please enter a user ID");return}y(!0);const{error:s}=await h.from("user_roles").insert({user_id:x.trim(),role:v});s?s.code==="23505"?a.error("User already has this role"):a.error("Failed to add role: "+s.message):(a.success("Role added successfully"),f(""),m()),y(!1)},D=async s=>{const{error:u}=await h.from("user_roles").delete().eq("id",s);u?a.error("Failed to delete role"):(a.success("Role removed"),m())},T=s=>{switch(s){case"admin":case"super_admin":return e.jsx(K,{className:"w-4 h-4"});case"delivery":return e.jsx(J,{className:"w-4 h-4"});default:return e.jsx(G,{className:"w-4 h-4"})}},w=s=>{switch(s){case"super_admin":return"bg-purple-500";case"admin":return"bg-blue-500";case"delivery":return"bg-emerald-500";default:return"bg-gray-500"}},i={total:r.length,admins:r.filter(s=>s.role==="admin"||s.role==="super_admin").length,delivery:r.filter(s=>s.role==="delivery").length,users:r.filter(s=>s.role==="user").length};return o||n===null?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(g,{className:"h-8 w-48"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6 space-y-4",children:[1,2,3].map(s=>e.jsx(g,{className:"h-20 rounded-xl"},s))}),e.jsx(R,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/10 via-background to-accent/10 pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/40 bg-background/40 backdrop-blur-xl shadow-lg",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>c("/admin"),children:e.jsx(E,{className:"h-5 w-5"})}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center shadow-lg",children:e.jsx(M,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"User Management"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.total," users with roles"]})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(l,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-100",children:e.jsxs(d,{className:"p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:i.admins}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Admins"})]})}),e.jsx(l,{className:"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-100",children:e.jsxs(d,{className:"p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:i.delivery}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivery"})]})}),e.jsx(l,{className:"bg-gray-50 dark:bg-gray-900/20 border-gray-100",children:e.jsxs(d,{className:"p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:i.users}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Users"})]})})]}),e.jsxs(l,{children:[e.jsx(k,{className:"pb-2",children:e.jsxs(U,{className:"text-base flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Add Role"]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsx(F,{placeholder:"User ID (UUID)",value:x,onChange:s=>f(s.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{value:v,onValueChange:s=>S(s),children:[e.jsx(V,{className:"flex-1",children:e.jsx(P,{})}),e.jsxs(q,{children:[e.jsx(p,{value:"user",children:"User"}),e.jsx(p,{value:"admin",children:"Admin"}),e.jsx(p,{value:"delivery",children:"Delivery"})]})]}),e.jsx(j,{onClick:I,disabled:_,children:"Add"})]})]})]}),e.jsxs(l,{children:[e.jsx(k,{className:"pb-2",children:e.jsx(U,{className:"text-base",children:"All Roles"})}),e.jsx(d,{className:"space-y-2",children:C?[1,2,3].map(s=>e.jsx(g,{className:"h-14 rounded-lg"},s)):r.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No roles assigned"}):r.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${w(s.role)} bg-opacity-20`,children:T(s.role)}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-mono",children:[s.user_id.slice(0,8),"..."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:H(new Date(s.created_at),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:w(s.role),children:s.role}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>D(s.id),children:e.jsx($,{className:"w-4 h-4"})})]})]},s.id))})]})]}),e.jsx(R,{})]})}export{ee as default};
