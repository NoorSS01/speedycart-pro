# Security Headers
<IfModule mod_headers.c>
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

RewriteEngine On
RewriteBase /

# CRITICAL: Prevent caching of service worker and manifest for PWA updates
<FilesMatch "(sw-custom\.js|manifest\.json|manifest-.*\.json)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Also prevent caching of HTML files
<FilesMatch "\.html$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# IMPORTANT: Redirect /dist and /dist/ to root for old PWA installations
# This fixes the 404 error when PWA was installed with old manifest
RewriteRule ^dist/?$ / [R=301,L]

# Serve static assets from /dist/ directly (JS, CSS, images, etc.)
RewriteCond %{REQUEST_URI} ^/dist/
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# For the root path, serve /dist/index.html
RewriteRule ^$ /dist/index.html [L]

# For all other client-side routes, serve /dist/index.html (SPA fallback)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ /dist/index.html [L]
